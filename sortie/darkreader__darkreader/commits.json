{"e7bb82c0e12f26e8813b2549506303f709674139":{"changes":{"src\/config\/fix_inversion.json":"MODIFY"},"diff":{"src\/config\/fix_inversion.json":[{"add":["245","            \"url\": \"immutables.github.io\",","246","            \"invert\": \".illustration, .documentation .highlight\"","247","        },","248","        {"],"delete":[]}]}},"51021fb72b137e8a38391fc77c564ec61749754c":{"changes":{"src\/inject\/dynamic-theme\/modify-css.ts":"MODIFY","src\/inject\/dynamic-theme\/index.ts":"MODIFY"},"diff":{"src\/inject\/dynamic-theme\/modify-css.ts":[{"add":["4","import {modifyBackgroundColor, modifyBorderColor, modifyForegroundColor, modifyGradientColor, modifyShadowColor, clearColorModificationCache} from '..\/..\/generators\/modify-colors';","118","\/\/ TODO: Move CSS fixes to config.","119","const commonOverride = (theme: FilterConfig) => {","120","    return [","121","        `.jfk-bubble { background-color: ${modifyBackgroundColor({r: 255, g: 255, b: 255}, theme)} !important; }`,","122","    ].join('\\n');","123","};","124","const websiteOverride: {[host: string]: (string | ((theme: FilterConfig) => string))} = {","125","    'arstechnica.com': (theme) => theme.mode === 1 ? [","126","        '.listing, .video-thumbnail { background-blend-mode: initial !important; }',","127","        '.article-single figure img { mix-blend-mode: initial !important; }',","128","    ].join('\\n') : '',","129","    'www.ebay.co.uk': 'html, body { background-image: none !important; }',","130","    'www.ebay.com': 'html, body { background-image: none !important; }',","131","    'www.ebay.de': 'html, body { background-image: none !important; }',","132","    'www.youtube.com': (theme) => `#textarea { color: ${modifyForegroundColor({r: 0, g: 0, b: 0}, theme)} !important; }`,","133","};","134","","135","export function getSiteOverride(host: string, theme: FilterConfig) {","136","    const common = commonOverride(theme);","137","    let special = '';","138","    if (websiteOverride.hasOwnProperty(host)) {","139","        const override = websiteOverride[host];","140","        if (typeof override === 'function') {","141","            special = override(theme);","142","        } else {","143","            special = override;","144","        }","145","    }","146","    return `${common}${special ? `\\n${special}` : ''}`;","147","}","148",""],"delete":["4","import {modifyBackgroundColor, modifyBorderColor, modifyForegroundColor, modifyGradientColor, modifyShadowColor, clearColorModificationCache} from '..\/..\/generators\/modify-colors'"]}],"src\/inject\/dynamic-theme\/index.ts":[{"add":["2","import {getModifiedUserAgentStyle, getModifiedFallbackStyle, getSiteOverride, cleanModificationCache} from '.\/modify-css';","87","    overrideStyle.textContent = getSiteOverride(location.host, filter);"],"delete":["2","import {getModifiedUserAgentStyle, getModifiedFallbackStyle, cleanModificationCache} from '.\/modify-css';","87","    \/\/ TODO: Move CSS fixes to config.","88","    overrideStyle.textContent = {","89","        'www.ebay.com': 'html, body { background-image: none !important; }',","90","        'www.youtube.com': filter.mode === 1 ? '#textarea { color: white !important; }' : '',","91","    }[location.host] || '';"]}]}},"e9c12d62d03643a017273ff01df78f5f56d019a7":{"changes":{"src\/inject\/dynamic-theme\/modify-css.ts":"MODIFY","src\/inject\/dynamic-theme\/index.ts":"MODIFY"},"diff":{"src\/inject\/dynamic-theme\/modify-css.ts":[{"add":["229","            const absoluteValue = `url(\"${url}\")`;","230","","244","                        awaitingForImageLoading.get(url).forEach((resolve) => resolve(absoluteValue));","245","                        return absoluteValue;","249","                const bgImageValue = getBgImageValue(imageDetails, filter) || absoluteValue;"],"delete":["242","                        awaitingForImageLoading.get(url).forEach((resolve) => resolve(urlValue));","243","                        return urlValue;","247","                const bgImageValue = getBgImageValue(imageDetails, filter) || urlValue;"]}],"src\/inject\/dynamic-theme\/index.ts":[{"add":["83","    let manager: StyleManager = null;","84","","86","        if (!manager) {","87","            return;","88","        }","110","    manager = await manageStyle(element, {update, loadingStart, loadingEnd});"],"delete":["105","    const manager = await manageStyle(element, {update, loadingStart, loadingEnd});"]}]}},"f20fd9a87d1fb3ee66be1507c2181a3d87683963":{"changes":{"src\/inject\/dynamic-theme\/inline-style.ts":"MODIFY"},"diff":{"src\/inject\/dynamic-theme\/inline-style.ts":[{"add":["6","const INLINE_STYLE_SELECTOR = '[style], [bgcolor]';","14","    const elements = Array.from(document.querySelectorAll(INLINE_STYLE_SELECTOR));","41","            const createdInlineStyles = expand(Array.from(m.addedNodes), INLINE_STYLE_SELECTOR);","42","            const removedInlineStyles = expand(Array.from(m.removedNodes), INLINE_STYLE_SELECTOR);","52","                if (m.attributeName === 'style' || m.attributeName === 'bgcolor') {","67","    observer.observe(document, {childList: true, subtree: true, attributes: true, attributeFilter: ['style', 'bgcolor', STORE_ATTR]});","92","    if (element.hasAttribute('bgcolor')) {","93","        let value = element.getAttribute('bgcolor');","94","        if (value.match(\/^[0-9a-f]{3}$\/i) || value.match(\/^[0-9a-f]{6}$\/i)) {","95","            value = `#${value}`;","96","        }","97","        const mod = getModifiableCSSDeclaration('background-color', value, null, null);","98","        if (mod) {","99","            modDecs.push(mod);","100","        }","101","    }"],"delete":["13","    const elements = Array.from(document.querySelectorAll('[style]'));","40","            const createdInlineStyles = expand(Array.from(m.addedNodes), '[style]');","41","            const removedInlineStyles = expand(Array.from(m.removedNodes), '[style]');","51","                if (m.attributeName === 'style') {","66","    observer.observe(document, {childList: true, subtree: true, attributes: true, attributeFilter: ['style', STORE_ATTR]});"]}]}},"b0861acf8f8870fb6caae3d7d42d1eb88fec6a46":{"changes":{"src\/background\/extension.ts":"MODIFY"},"diff":{"src\/background\/extension.ts":[{"add":["75","        if (chrome.permissions.onRemoved) {","76","            chrome.permissions.onRemoved.addListener((permissions) => {","80","                if (!permissions.permissions.includes('contextMenus')) {","81","                    this.registeredContextMenus = false;","82","                }","83","            });","84","        }"],"delete":["75","        chrome.permissions.onRemoved.addListener((permissions) => {","79","            if (!permissions.permissions.includes('contextMenus')) {","80","                this.registeredContextMenus = false;","81","            }","82","        });"]}]}},"fab1e7b33aa3703f44d33f74d0e47604a6636290":{"changes":{"src\/inject\/dynamic-theme\/style-manager.ts":"MODIFY","src\/inject\/dynamic-theme\/watch.ts":"MODIFY"},"diff":{"src\/inject\/dynamic-theme\/style-manager.ts":[{"add":["33","    ? 'html \/deep\/ link[rel*=\"stylesheet\" i]:not([disabled]), html \/deep\/ style'","34","    : 'html link[rel*=\"stylesheet\" i]:not([disabled]), html style';","41","            (","42","                element instanceof HTMLLinkElement &&","43","                element.rel &&","44","                element.rel.toLowerCase().includes('stylesheet') &&","45","                !element.disabled","46","            )"],"delete":["33","    ? 'html \/deep\/ link[rel*=\"stylesheet\" i], html \/deep\/ style'","34","    : 'html link[rel*=\"stylesheet\" i], html style';","41","            (element instanceof HTMLLinkElement && element.rel && element.rel.toLowerCase().includes('stylesheet'))"]}],"src\/inject\/dynamic-theme\/watch.ts":[{"add":["83","    const mutationObserverOptions = {childList: true, subtree: true, attributes: true, attributeFilter: ['rel', 'disabled']};"],"delete":["83","    const mutationObserverOptions = {childList: true, subtree: true, attributes: true, attributeFilter: ['rel']};"]}]}},"6ce34e3f2eadee6b4c068bc77d7a90d212d736a5":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["908","html:not(.style-scope) {","909","    --primary-text-color: ${#212121};","910","    --primary-background-color: ${#ffffff};","911","    --disabled-text-color: ${#9b9b9b};","912","    --divider-color: ${#dbdbdb};","913","    --error-color: ${#dd2c00};","914","    --primary-color: ${#3f51b5};","915","    --accent-color: ${#ff4081};","916","    --text-primary-color: #ffffff;","917","    --google-red-500: #db4437;","918","    --google-blue-500: #4285f4;","919","    --google-green-500: #0f9d58;","920","    --google-yellow-500: #f4b400;","921","    --paper-pink-900: #880e4f;","922","    --paper-yellow-a100: #ffff8d;","923","    --paper-grey-300: #e0e0e0;","924","    --paper-grey-500: #9e9e9e;","925","    --yt-live-chat-action-panel-background-color: ${hsla(0, 0%, 93.3%, .4)};","926","    --yt-live-chat-action-panel-background-color-transparent: ${hsla(0, 0%, 97%, .8)};","927","    --yt-live-chat-primary-text-color: ${hsl(0, 0%, 6.7%)};","928","    --yt-live-chat-secondary-text-color: ${hsla(0, 0%, 6.7%, .6)};","929","    --yt-live-chat-tertiary-text-color: ${hsla(0, 0%, 6.7%, .4)};","930","    --yt-live-chat-disabled-icon-button-color: ${hsla(0, 0%, 6.7%, .2)};","931","    --yt-live-chat-picker-button-color: ${hsla(0, 0%, 6.7%, .4)};","932","    --yt-live-chat-text-input-field-suggestion-background-color: ${hsl(0, 0%, 100%)};","933","    --yt-live-chat-text-input-field-suggestion-background-color-hover: ${#eee};","934","    --yt-live-chat-text-input-field-suggestion-text-color: ${#666};","935","    --yt-live-chat-text-input-field-suggestion-text-color-hover: ${#333};","936","    --yt-emoji-picker-search-background-color: ${hsla(0, 0%, 100%, .6)};","937","    --yt-emoji-picker-search-color: ${hsla(0, 0%, 6.7%, .8)};","938","    --yt-emoji-picker-search-placeholder-color: ${hsla(0, 0%, 6.7%, .6)};","939","    --ytd-searchbox-border-color: ${hsla(0, 0%, 53.3%, .2)};","940","    --ytd-searchbox-legacy-border-color: ${#ccc};","941","    --ytd-searchbox-legacy-border-shadow-color: ${#eee};","942","    --ytd-searchbox-legacy-button-color: ${#f8f8f8};","943","    --ytd-searchbox-legacy-button-border-color: ${#d3d3d3};","944","    --ytd-searchbox-legacy-button-focus-color: ${#e9e9e9};","945","    --ytd-searchbox-legacy-button-hover-color: ${#f0f0f0};","946","    --ytd-searchbox-legacy-button-hover-border-color: ${#c6c6c6};","947","    --ytd-searchbox-legacy-button-icon-color: ${#333};","948","    --ytd-moderation-panel-background: ${hsla(0, 0%, 93.3%, .6)};","949","    --ytd-moderation-panel-hover: ${hsla(0, 0%, 93.3%, .8)};","950","    --ytd-moderation-panel-comment-text: ${hsl(0, 0%, 6.7%)};","951","    --ytd-moderation-panel-comment-metadata-text: ${hsla(0, 0%, 6.7%, .6)};","952","    --ytd-moderation-icon-color: ${hsla(0, 0%, 6.7%, .6)};","953","    --ytd-moderation-icon-hover-color: ${hsl(0, 0%, 6.7%)};","954","    --ytd-comment-text-color: ${hsl(0, 0%, 6.7%)};","955","    --ytd-watch-card-secondary-text-color: ${hsl(0, 0%, 53.3%)};","956","    --ytd-watch-card-album-header-background: ${hsl(0, 0%, 100%)};","957","    --ytd-backstage-metadata-text-color: ${hsl(0, 0%, 53.3%)};","958","    --ytd-backstage-video-link-background-color: ${hsla(0, 0%, 93.3%, .4)};","959","    --ytd-backstage-image-alert-color: ${hsla(0, 0%, 6.7%, .6)};","960","    --ytd-backstage-cancel-background-color: ${hsl(0, 0%, 100%)};","961","    --ytd-backstage-cancel-color: ${hsla(0, 0%, 6.7%, .4)};","962","    --ytd-backstage-attachment-background-color: ${hsl(0, 0%, 100%)};","963","    --ytd-backstage-creationbox-background-color: ${hsl(0, 0%, 98%)};","964","    --ytd-backstage-creationbox-background-color-focus: ${hsl(0, 0%, 96%)};","965","    --ytd-backstage-creationbox-inactive-color: ${hsla(0, 0%, 0%, .26)};","966","    --ytd-backstage-creationbox-text-color: ${hsla(0, 0%, 0%, .54)};","967","    --ytd-backstage-creationbox-input-text-color: ${hsla(0, 0%, 0%, .87)};","968","    --ytd-backstage-creationbox-disabled-button-color: ${hsla(0, 0%, 0%, .04)};","969","    --ytd-backstage-creationbox-disabled-button-text-color: ${hsl(0, 0%, 100%)};","970","    --ytd-backstage-attachment-icon-hover-color: ${hsla(0, 0%, 0%, .74)};","971","    --ytd-sponsorships-background-color-focus: ${hsla(0, 0%, 93.3%, .4)};","972","    --ytd-badge-disabled-color: ${hsla(0, 0%, 53.3%, .4)};","973","    --ytd-collection-badge-color: ${hsla(0, 0%, 6.7%, .8)};","974","    --ytd-owner-badge-color: ${hsla(0, 0%, 6.7%, .4)};","975","    --ytd-simple-badge-color: ${hsla(0, 0%, 6.7%, .6)};","976","    --ytd-shopping-product-info: ${hsla(0, 0%, 6.7%, .8)};","977","    --ytd-transcript-cue-hover-background-color: ${hsl(0, 0%, 93.3%)};","978","    --ytd-transcript-toolbar-background-color: ${hsl(0, 0%, 93.3%)};","979","    --ytd-transcript-toolbar-text: ${hsl(0, 0%, 6.7%)};","980","    --ytd-video-publish-date-color: ${hsla(0, 0%, 6.7%, .6)};","981","    --ytd-vat-notice-text: ${hsla(0, 0%, 6.7%, .6)};","982","    --ytd-offer-background-color: ${hsla(0, 0%, 93.3%, .4)};","983","    --ytd-video-game-watch-card-logo-color: ${hsl(0, 0%, 6.7%)};","984","    --ytd-watch-split-pane-sidebar-background-color: ${hsl(0, 0%, 98%)};","985","    --yt-swatch-icon-color: ${hsla(0, 0%, 6.7%, .4)};","986","    --yt-swatch-primary: ${hsl(0, 0%, 100%)};","987","    --yt-swatch-primary-darker: ${rgb(230, 230, 230)};","988","    --yt-swatch-text: ${hsla(0, 0%, 6.7%, .4)};","989","    --yt-swatch-input-text: ${hsl(0, 0%, 6.7%)};","990","    --yt-swatch-textbox-bg: ${rgb(255, 255, 255)};","991","    --yt-spec-brand-background-solid: ${#FFFFFF};","992","    --yt-spec-brand-background-primary: ${rgba(255, 255, 255, 0.98)};","993","    --yt-spec-brand-background-secondary: ${rgba(255, 255, 255, 0.95)};","994","    --yt-spec-feed-background-a: ${#F9F9F9};","995","    --yt-spec-feed-background-b: ${#F3F3F3};","996","    --yt-spec-feed-background-c: ${#EDEDED};","997","    --yt-spec-error-background: ${#1F1F1F};","998","    --yt-spec-text-primary: ${#0A0A0A};","999","    --yt-spec-text-primary-inverse: ${#FFFFFF};","1000","    --yt-spec-text-secondary: ${#606060};","1001","    --yt-spec-text-disabled: ${#909090};","1002","    --yt-spec-call-to-action: ${#065FD4};","1003","    --yt-spec-icon-active-other: ${#606060};","1004","    --yt-spec-icon-inactive: ${#909090};","1005","    --yt-spec-icon-disabled: ${#CCCCCC};","1006","    --yt-spec-badge-chip-background: ${rgba(0, 0, 0, 0.05)};","1007","    --yt-spec-suggested-action: ${#F2F8FF};","1008","    --yt-spec-button-chip-background-hover: ${rgba(0, 0, 0, 0.10)};","1009","    --yt-spec-touch-response: ${#000000};","1010","    --yt-spec-filled-button-text: ${#FFFFFF};","1011","    --yt-spec-call-to-action-inverse: ${#3EA6FF};","1012","    --yt-spec-brand-icon-active: ${#FF0000};","1013","    --yt-spec-brand-icon-inactive: ${#606060};","1014","    --yt-spec-brand-button-background: ${#CC0000};","1015","    --yt-spec-brand-link-text: ${#CC0000};","1016","    --yt-spec-filled-button-focus-outline: ${rgba(0, 0, 0, 0.60)};","1017","    --yt-spec-call-to-action-button-focus-outline: ${rgba(6, 95, 212, 0.30)};","1018","    --yt-spec-brand-text-button-focus-outline: ${rgba(204, 0, 0, 0.30)};","1019","    --yt-spec-inactive-text-button-focus-outline: ${#CCCCCC};","1020","    --yt-spec-brand-subscribe-button-background: ${#FF0000};","1021","    --yt-spec-wordmark-text: ${#282828};","1022","    --yt-spec-10-percent-layer: ${rgba(0, 0, 0, 0.10)};","1023","    --yt-spec-selected-nav-text: ${#CC0000};","1024","    --yt-spec-themed-blue: ${#065FD4};","1025","    --yt-spec-themed-green: ${#107516};","1026","    --yt-std-body-300: ${hsla(0, 0%, 0%, .54)};","1027","    --yt-std-surface-200: ${hsl(0, 0%, 98%)};","1028","    --yt-std-surface-300: ${hsl(0, 0%, 96%)};","1029","    --yt-std-surface-400: ${hsl(0, 0%, 93%)};","1030","    --yt-primary-color: ${hsl(0, 0%, 6.7%)};","1031","    --yt-primary-text-color: ${hsl(0, 0%, 6.7%)};","1032","    --yt-hovered-text-color: ${hsla(0, 0%, 6.7%, .8)};","1033","    --yt-secondary-text-color: ${hsla(0, 0%, 6.7%, .8)};","1034","    --yt-tertiary-text-color: ${hsla(0, 0%, 6.7%, .6)};","1035","    --yt-placeholder-text-color: ${hsla(0, 0%, 6.7%, .6)};","1036","    --yt-border-color: ${hsl(0, 0%, 93.3%)};","1037","    --yt-commentbox-border-inactive: ${hsl(0, 0%, 93.3%)};","1038","    --yt-commentbox-border-active: ${hsla(0, 0%, 6.7%, .6)};","1039","    --yt-primary-disabled-button-text-color: ${hsl(0, 0%, 100%)};","1040","    --yt-paper-button-ink-color: ${hsl(0, 0%, 53.3%)};","1041","    --yt-icon-color: ${hsla(0, 0%, 6.7%, .4)};","1042","    --yt-icon-hover-color: ${hsla(0, 0%, 6.7%, .8)};","1043","    --yt-icon-disabled-color: ${hsla(0, 0%, 6.7%, .6)};","1044","    --yt-icon-active-color: ${hsl(0, 0%, 6.7%)};","1045","    --yt-expand-color: ${hsla(0, 0%, 6.7%, .6)};","1046","    --yt-placeholder-text: ${hsla(0, 0%, 6.7%, .6)};","1047","    --yt-playlist-background-header: ${hsl(0, 0%, 93.3%)};","1048","    --yt-playlist-background-item: ${hsla(0, 0%, 93.3%, .6)};","1049","    --yt-playlist-title-text: ${hsl(0, 0%, 6.7%)};","1050","    --yt-playlist-message-text: ${hsla(0, 0%, 6.7%, .6)};","1051","    --yt-playlist-message-text-hover: ${hsl(0, 0%, 6.7%)};","1052","    --yt-button-active-color: ${hsl(0, 0%, 6.7%)};","1053","    --yt-copyright-text: ${hsla(0, 0%, 6.7%, .6)};","1054","    --yt-guide-entry-text-color: ${hsla(0, 0%, 6.7%, .8)};","1055","    --yt-thumbnail-placeholder-color: ${hsl(0, 0%, 89%)};","1056","    --yt-featured-channel-title-text-color: ${hsla(0, 0%, 0%, .54)};","1057","    --yt-formatted-string-deemphasize-color: ${hsl(0, 0%, 53.3%)};","1058","    --yt-alert-background: ${hsla(0, 0%, 93.3%, .4)};","1059","    --yt-video-secondary-info-description-background: ${hsla(0, 0%, 93.3%, .6)};","1060","    --yt-material-searchbox-inactive: ${hsla(0, 0%, 93.3%, .6)};","1061","    --yt-material-searchbox-active: ${hsl(0, 0%, 100%)};","1062","    --yt-material-searchbox-inactive-shadow: ${hsla(0, 0%, 53.3%, .2)};","1063","    --yt-material-searchbox-active-shadow: ${hsla(0, 0%, 0%, .26)};","1064","    --yt-material-searchbox-inset: ${hsla(0, 0%, 0%, .04)};","1065","    --yt-simple-menu-header-background: ${hsl(0, 0%, 93.3%)};","1066","    --yt-item-section-header-color: ${hsla(0, 0%, 6.7%, .6)};","1067","    --yt-menu-hover-backgound-color: ${hsl(0, 0%, 93.3%)};","1068","    --yt-menu-focus-background-color: ${hsla(0, 0%, 6.7%, .2)};","1069","    --yt-chat-bubble-other-border-color: ${#CCCCCC};","1070","    --yt-chat-bubble-other-background-color: ${#F9F9F9};","1071","    --yt-chat-bubble-self-border-color: ${#CCCCCC};","1072","    --yt-chat-bubble-self-background-color: ${#EDEDED};","1073","    --yt-app-background: ${hsl(0, 0%, 100%)};","1074","    --yt-main-app-background: ${hsl(0, 0%, 98%)};","1075","    --yt-main-app-background-tmp: ${hsl(0, 0%, 100%)};","1076","    --yt-guide-background: ${hsl(0, 0%, 96%)};","1077","    --yt-dialog-background: ${hsl(0, 0%, 100%)};","1078","    --yt-searchbox-background: ${hsl(0, 0%, 100%)};","1079","    --yt-channel-header-background: ${hsl(0, 0%, 98%)};","1080","    --yt-sidebar-background: ${hsl(0, 0%, 98%)};","1081","    --yt-transcript-background: ${hsl(0, 0%, 100%)};","1082","}"],"delete":["904","INVERT","905","#checkmark","906",".ytp-volume-slider-handle","907",".toggle-bar.style-scope.paper-toggle-button","908",".align-by-text.style-scope.ytd-comment-replies-renderer","909","g#youtube-red-paths","910",".deemphasize.style-scope.yt-formatted-string","911","#like-bar","912","","914","#textarea, paper-button {","915","    color: ${black} !important;","916","}","917",".style-scope.ytd-video-primary-info-renderer {","918","    color: ${black} !important;","919","}"]}]}},"c4e10f66c0f330e32fc6161c28ded17d2a27526e":{"changes":{"src\/inject\/dynamic-theme\/style-manager.ts":"MODIFY"},"diff":{"src\/inject\/dynamic-theme\/style-manager.ts":[{"add":["136","            let [cssRules, accessError] = getRulesAndError();","137","            if (accessError) {","138","                \/\/ NOTE: In Firefox, when link is loading,","139","                \/\/ sheet is not null, but cssRules error is thrown","140","                logWarn(accessError);","141","            }","142","","143","            if (cssRules == null || accessError) {","157","","158","            [cssRules, accessError] = getRulesAndError();","159","            if (accessError) {","160","                \/\/ CORS error, cssRules are not accessible","161","                \/\/ for cross-origin resources","162","                logWarn(accessError);","164","","165","            if (cssRules != null) {","166","                return cssRules;","167","            }","168","","460","    function getRulesAndError(): [CSSRuleList, Error] {","461","        try {","462","            if (element.sheet == null) {","463","                return [null, null];","464","            }","465","            return [element.sheet.cssRules, null];","466","        } catch (err) {","467","            return [null, err];","468","        }","469","    }","470","","474","        const [cssRules, err] = getRulesAndError();","475","        if (err) {","479","        return cssRules;"],"delete":["100","        if (element.sheet == null) {","101","            return null;","102","        }","103","        if (element instanceof HTMLLinkElement) {","104","            try {","105","                return element.sheet.cssRules;","106","            } catch (err) {","107","                logWarn(err);","108","                return null;","109","            }","110","        }","147","            if (element.sheet == null) {","161","            try {","162","                if (element.sheet.cssRules != null) {","163","                    return element.sheet.cssRules;","164","                }","165","            } catch (err) {","166","                logWarn(err);","462","        try {","463","            if (element.sheet == null) {","464","                return null;","465","            }","466","            return element.sheet.cssRules;","467","        } catch (err) {"]}]}},"d3526e3586c972f737aa5413312fd5e8f54051d0":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["29","INLINE","30",".mw-parser-output *","31",""],"delete":[]}]}},"79bd3daa939b2d3005aee88091b6c0cbc91b3cf8":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["8817","button[aria-pressed=\"true\"] > yt-icon,","8818","[id$=\"-replies\"].ytd-comment-replies-renderer > .ytd-button-renderer > paper-button,","8819","[id$=\"-replies\"].ytd-comment-replies-renderer > .ytd-button-renderer > paper-button  > yt-icon {"],"delete":["8817","button[aria-pressed=\"true\"] > yt-icon {"]}]}},"dcbd8474f2cf6b46109212ca2b851585e6bb3448":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["2646","linuxgrandma.blogspot.com","2647","","2648","CSS","2649","body {","2650","    background-image: none !important;","2651","    background-color: var(--darkreader-neutral-background) !important;","2652","}","2653","","2654","================================","2655",""],"delete":[]}]}},"4c8048a25d0497549ba4a4080af7f2e4aa9aaa89":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["20",".MuiTypography-body1,","21",".nfe-quote-text {"],"delete":["20",".MuiTypography-body1 {"]}]}},"dcb8b808e0b09ede9b89ce8cb2ca1fd6111485ac":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["6",".vimvixen-hint {","7","    background-color: ${#ffd76e} !important;","8","    border-color: ${#c59d00} !important;","9","    color: ${#302505} !important;","10","}"],"delete":[]}]}},"8a165cad21ba5d2d63f7ea1bb43fe023787bdc70":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["2475","magic.freizeitspieler.de","2476","","2477","INVERT","2478","img[src=\"pics\/MtG-Freizeitspieler.gif\"]","2479","","2480","CSS","2481","body {","2482","    background-image: none !important","2483","}","2484","","2485","================================","2486",""],"delete":[]}]}},"8006cb7f9dcb168fc5da4a56335d9a850cfece1b":{"changes":{"src\/background\/extension.ts":"MODIFY","src\/background\/config-manager.ts":"MODIFY","src\/background\/devtools.ts":"MODIFY"},"diff":{"src\/background\/extension.ts":[{"add":["19","const AUTO_TIME_CHECK_INTERVAL = getDuration({seconds: 10});","20","const CONFIG_SYNC_INTERVAL = getDuration({minutes: 15});","77","        this.startConfigSync();","185","    private startConfigSync() {","186","        this.config.load({local: false});","187","        setInterval(() => {","188","            this.config.load({local: false});","189","        }, CONFIG_SYNC_INTERVAL);","190","    }","191","","206","        }, AUTO_TIME_CHECK_INTERVAL);"],"delete":["19","const AUTO_TIME_CHECK_INTERVAL_MS = getDuration({seconds: 10});","76","        this.config.load({local: false});","198","        }, AUTO_TIME_CHECK_INTERVAL_MS);"]}],"src\/background\/config-manager.ts":[{"add":["34","    raw = {","35","        darkSites: null,","36","        dynamicThemeFixes: null,","37","        inversionFixes: null,","38","        staticThemes: null,","39","    };","40","","41","    overrides = {","42","        darkSites: null,","43","        dynamicThemeFixes: null,","44","        inversionFixes: null,","45","        staticThemes: null,","46","    };","47","","48","    private async loadConfig({","49","        name,","50","        local,","51","        localURL,","52","        remoteURL,","53","        success,","54","    }) {","55","        let $config: string;","56","        const loadLocal = async () => await readText({url: localURL});","57","        if (local) {","58","            $config = await loadLocal();","59","        } else {","60","            try {","61","                $config = await readText({","62","                    url: remoteURL,","63","                    timeout: REMOTE_TIMEOUT_MS","64","                });","65","            } catch (err) {","66","                console.error(`${name} remote load error`, err);","67","                $config = await loadLocal();","68","            }","69","        }","70","        success($config);","73","    private async loadDarkSites({local}) {","74","        await this.loadConfig({","75","            name: 'Dark Sites',","76","            local,","77","            localURL: CONFIG_URLs.darkSites.local,","78","            remoteURL: CONFIG_URLs.darkSites.remote,","79","            success: ($sites) => {","80","                this.raw.darkSites = $sites;","81","                this.handleDarkSites();","82","            },","83","        });","84","    }","86","    private async loadDynamicThemeFixes({local}) {","87","        await this.loadConfig({","88","            name: 'Dynamic Theme Fixes',","89","            local,","90","            localURL: CONFIG_URLs.dynamicThemeFixes.local,","91","            remoteURL: CONFIG_URLs.dynamicThemeFixes.remote,","92","            success: ($fixes) => {","93","                this.raw.dynamicThemeFixes = $fixes;","94","                this.handleDynamicThemeFixes();","95","            },","96","        });","97","    }","99","    private async loadInversionFixes({local}) {","100","        await this.loadConfig({","101","            name: 'Inversion Fixes',","102","            local,","103","            localURL: CONFIG_URLs.inversionFixes.local,","104","            remoteURL: CONFIG_URLs.inversionFixes.remote,","105","            success: ($fixes) => {","106","                this.raw.inversionFixes = $fixes;","107","                this.handleInversionFixes();","108","            },","109","        });","110","    }","112","    private async loadStaticThemes({local}) {","113","        await this.loadConfig({","114","            name: 'Static Themes',","115","            local,","116","            localURL: CONFIG_URLs.staticThemes.local,","117","            remoteURL: CONFIG_URLs.staticThemes.remote,","118","            success: ($themes) => {","119","                this.raw.staticThemes = $themes;","120","                this.handleStaticThemes();","121","            },","122","        });","123","    }","125","    async load(config: {local: boolean}) {","127","            this.loadDarkSites(config),","128","            this.loadDynamicThemeFixes(config),","129","            this.loadInversionFixes(config),","130","            this.loadStaticThemes(config),","134","    private handleDarkSites() {","135","        const $sites = this.overrides.darkSites || this.raw.darkSites;","136","        this.DARK_SITES = parseArray($sites);","137","    }","138","","139","    handleDynamicThemeFixes() {","140","        const $fixes = this.overrides.dynamicThemeFixes || this.raw.dynamicThemeFixes;","144","    handleInversionFixes() {","145","        const $fixes = this.overrides.inversionFixes || this.raw.inversionFixes;","149","    handleStaticThemes() {","150","        const $themes = this.overrides.staticThemes || this.raw.staticThemes;"],"delete":["27","const RELOAD_INTERVAL_MS = getDuration({minutes: 15});","32","    RAW_DYNAMIC_THEME_FIXES?: string;","34","    RAW_INVERSION_FIXES?: string;","36","    RAW_STATIC_THEMES?: string;","38","    constructor() {","39","        setInterval(() => this.load(), RELOAD_INTERVAL_MS);","42","    async load({local} = {local: false}) {","43","        const loadDarkSites = async () => {","44","            let $sites: string;","45","            const loadLocal = async () => $sites = await readText({url: CONFIG_URLs.darkSites.local});","46","            if (local) {","47","                await loadLocal();","48","            } else {","49","                try {","50","                    $sites = await readText({","51","                        url: CONFIG_URLs.darkSites.remote,","52","                        timeout: REMOTE_TIMEOUT_MS","53","                    });","54","                } catch (err) {","55","                    console.error('Dark Sites remote load error', err);","56","                    await loadLocal();","57","                }","58","            }","59","            const sites = parseArray($sites);","60","            this.handleDarkSites(sites)","61","        };","63","        const loadDynamicThemeFixes = async () => {","64","            let $fixes: string;","65","            const loadLocal = async () => $fixes = await readText({url: CONFIG_URLs.dynamicThemeFixes.local});","66","            if (local) {","67","                await loadLocal();","68","            } else {","69","                try {","70","                    $fixes = await readText({","71","                        url: CONFIG_URLs.dynamicThemeFixes.remote,","72","                        timeout: REMOTE_TIMEOUT_MS","73","                    });","74","                } catch (err) {","75","                    console.error('Dynamic Theme Fixes remote load error', err);","76","                    await loadLocal();","77","                }","78","            }","79","            this.RAW_DYNAMIC_THEME_FIXES = $fixes;","80","            this.handleDynamicThemeFixes($fixes);","81","        };","83","        const loadInversionFixes = async () => {","84","            let $fixes: string;","85","            const loadLocal = async () => $fixes = await readText({url: CONFIG_URLs.inversionFixes.local});","86","            if (local) {","87","                await loadLocal();","88","            } else {","89","                try {","90","                    $fixes = await readText({","91","                        url: CONFIG_URLs.inversionFixes.remote,","92","                        timeout: REMOTE_TIMEOUT_MS","93","                    });","94","                } catch (err) {","95","                    console.error('Inversion Fixes remote load error', err);","96","                    $fixes = await readText({url: CONFIG_URLs.inversionFixes.local});","97","                }","98","            }","99","            this.RAW_INVERSION_FIXES = $fixes;","100","            this.handleInversionFixes($fixes);","101","        };","103","        const loadStaticThemes = async () => {","104","            let $themes: string;","105","            const loadLocal = async () => $themes = await readText({url: CONFIG_URLs.staticThemes.local});","106","            if (local) {","107","                await loadLocal();","108","            } else {","109","                try {","110","                    $themes = await readText({","111","                        url: CONFIG_URLs.staticThemes.remote,","112","                        timeout: REMOTE_TIMEOUT_MS","113","                    });","114","                } catch (err) {","115","                    console.error('Static Theme remote load error', err);","116","                    await loadLocal();","117","                }","118","            }","119","            this.RAW_STATIC_THEMES = $themes;","120","            this.handleStaticThemes($themes);","121","        };","124","            loadDarkSites(),","125","            loadDynamicThemeFixes(),","126","            loadInversionFixes(),","127","            loadStaticThemes(),","131","    handleDynamicThemeFixes($fixes: string) {","135","    handleInversionFixes($fixes: string) {","139","    private handleDarkSites($sites: string[]) {","140","        this.DARK_SITES = (Array.isArray($sites) ? $sites : [])","141","            .filter((x) => typeof x === 'string');","142","    }","143","","144","    handleStaticThemes($themes: string) {"]}],"src\/background\/devtools.ts":[{"add":["11","        this.config.overrides.dynamicThemeFixes = this.getSavedDynamicThemeFixes() || null;","12","        this.config.overrides.inversionFixes = this.getSavedInversionFixes() || null;","13","        this.config.overrides.staticThemes = this.getSavedStaticThemes() || null;","26","        const $fixes = this.getSavedDynamicThemeFixes();","27","        const fixes = $fixes ? parseDynamicThemeFixes($fixes) : this.config.DYNAMIC_THEME_FIXES;","28","        return formatDynamicThemeFixes(fixes);","33","        this.config.overrides.dynamicThemeFixes = null;","34","        this.config.handleDynamicThemeFixes();","41","            this.config.overrides.dynamicThemeFixes = formatted;","42","            this.config.handleDynamicThemeFixes();","60","        const $fixes = this.getSavedInversionFixes();","61","        const fixes = $fixes ? parseInversionFixes($fixes) : this.config.INVERSION_FIXES;","62","        return formatInversionFixes(fixes);","67","        this.config.overrides.inversionFixes = null;","68","        this.config.handleInversionFixes();","75","            this.config.overrides.inversionFixes = formatted;","76","            this.config.handleInversionFixes();","94","        const $themes = this.getSavedStaticThemes();","95","        const themes = $themes ? parseStaticThemes($themes) : this.config.STATIC_THEMES;","96","        return formatStaticThemes(themes);","101","        this.config.overrides.staticThemes = null;","102","        this.config.handleStaticThemes();","109","            this.config.overrides.staticThemes = formatted;","110","            this.config.handleStaticThemes();"],"delete":["23","        const {RAW_DYNAMIC_THEME_FIXES} = this.config;","24","        const fixes = this.getSavedDynamicThemeFixes();","25","        return fixes ? formatDynamicThemeFixes(parseDynamicThemeFixes(fixes)) : RAW_DYNAMIC_THEME_FIXES;","29","        const {RAW_DYNAMIC_THEME_FIXES} = this.config;","31","        this.config.handleInversionFixes(RAW_DYNAMIC_THEME_FIXES);","38","            this.config.handleDynamicThemeFixes(formatted);","56","        const {RAW_INVERSION_FIXES} = this.config;","57","        const fixes = this.getSavedInversionFixes();","58","        return fixes ? formatInversionFixes(parseInversionFixes(fixes)) : RAW_INVERSION_FIXES;","62","        const {RAW_INVERSION_FIXES} = this.config;","64","        this.config.handleInversionFixes(RAW_INVERSION_FIXES);","71","            this.config.handleInversionFixes(formatted);","89","        const {RAW_STATIC_THEMES} = this.config;","90","        const themes = this.getSavedStaticThemes();","91","        return themes ? formatStaticThemes(parseStaticThemes(themes)) : RAW_STATIC_THEMES;","95","        const {RAW_STATIC_THEMES} = this.config;","97","        this.config.handleStaticThemes(RAW_STATIC_THEMES);","104","            this.config.handleStaticThemes(formatted);"]}]}},"1e8216361aa81d1e2cf22e030d8327371eace449":{"changes":{"src\/inject\/dynamic-theme\/style-manager.ts":"MODIFY"},"diff":{"src\/inject\/dynamic-theme\/style-manager.ts":[{"add":["211","            if (variables.size > 0 || cssText.includes('var(')) {"],"delete":["211","            if (variables.size > 0) {"]}]}},"9b7d9fd38d8475344f69a3fddaade86843d4be60":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["3940","rubjo.github.io","3941","","3942","CSS","3943","select {","3944","    background-color: var(--darkreader-neutral-background) !important;","3945","}","3946","","3947","================================","3948",""],"delete":[]}]}},"cc688a514c5ccbe600ce99faadb794d54c60d2db":{"changes":{"src\/background\/newsmaker.ts":"MODIFY","src\/background\/extension.ts":"MODIFY","src\/background\/user-storage.ts":"MODIFY","src\/background\/utils\/extension-api.ts":"MODIFY","src\/utils\/debounce.ts":"ADD"},"diff":{"src\/background\/newsmaker.ts":[{"add":["3","import {readSyncStorage, readLocalStorage, writeSyncStorage, writeLocalStorage} from '.\/utils\/extension-api';","29","    private async getReadNews(): Promise<string[]> {","30","        let sync = await readSyncStorage({readNews: []});","31","        let local = await readLocalStorage({readNews: []});","32","        return Array.from(new Set([","33","            ...sync ? sync.readNews : [],","34","            ...local ? local.readNews : [],","35","        ]));","36","    }","37","","42","            const readNews = await this.getReadNews();","43","            const news: News[] = $news.map(({id, date, headline, important}) => {","44","                const url = getBlogPostURL(id);","45","                const read = this.isRead(id, readNews);","46","                return {id, date, headline, url, important, read};","48","            for (let i = 0; i < news.length; i++) {","49","                const date = new Date(news[i].date);","50","                if (isNaN(date.getTime())) {","51","                    throw new Error(`Unable to parse date ${date}`);","52","                }","53","            }","54","            return news;","61","    async markAsRead(...ids: string[]) {","62","        const readNews = await this.getReadNews();","63","        const results = readNews.slice();","64","        let changed = false;","65","        ids.forEach((id) => {","66","            if (readNews.indexOf(id) < 0) {","67","                results.push(id);","68","                changed = true;","69","            }","71","        if (changed) {","72","            this.latest = this.latest.map(({id, date, url, headline, important}) => {","73","                const read = this.isRead(id, results);","74","                return {id, date, url, headline, important, read};","75","            });","76","            this.onUpdate(this.latest);","77","            const obj = {readNews: results};","78","            await writeLocalStorage(obj);","79","            await writeSyncStorage(obj);","80","        }"],"delete":["32","            return new Promise<News[]>((resolve, reject) => {","33","                chrome.storage.sync.get({readNews: []}, ({readNews}) => {","34","                    const news: News[] = $news.map(({id, date, headline, important}) => {","35","                        const url = getBlogPostURL(id);","36","                        const read = this.isRead(id, readNews);","37","                        return {id, date, headline, url, important, read};","38","                    });","39","                    for (let i = 0; i < news.length; i++) {","40","                        const date = new Date(news[i].date);","41","                        if (isNaN(date.getTime())) {","42","                            reject(new Error(`Unable to parse date ${date}`));","43","                            return;","44","                        }","45","                    }","46","                    resolve(news);","47","                });","55","    markAsRead(...ids: string[]) {","56","        return new Promise((resolve) => {","57","            chrome.storage.sync.get({readNews: []}, ({readNews}) => {","58","                const results = readNews.slice();","59","                let changed = false;","60","                ids.forEach((id) => {","61","                    if (readNews.indexOf(id) < 0) {","62","                        results.push(id);","63","                        changed = true;","64","                    }","65","                });","66","                if (changed) {","67","                    this.latest = this.latest.map(({id, date, url, headline, important}) => {","68","                        const read = this.isRead(id, results);","69","                        return {id, date, url, headline, important, read};","70","                    });","71","                    this.onUpdate(this.latest);","72","                    chrome.storage.sync.set({readNews: results}, () => resolve());","73","                } else {","74","                    resolve();","75","                }","76","            });"]}],"src\/background\/extension.ts":[{"add":[],"delete":["105","        this.user.cleanup();"]}],"src\/background\/user-storage.ts":[{"add":["1","import {debounce} from '..\/utils\/debounce';","4","import {readSyncStorage, readLocalStorage, writeSyncStorage, writeLocalStorage} from '.\/utils\/extension-api';","19","    private fillDefaults(settings: UserSettings) {","20","        settings.theme = {...DEFAULT_THEME, ...settings.theme};","21","        settings.time = {...DEFAULT_SETTINGS.time, ...settings.time};","22","        settings.presets.forEach((preset) => {","23","            preset.theme = {...DEFAULT_THEME, ...preset.theme};","24","        });","25","        settings.customThemes.forEach((site) => {","26","            site.theme = {...DEFAULT_THEME, ...site.theme};","27","        });","30","    private async loadSettingsFromStorage() {","31","        const local = await readLocalStorage(DEFAULT_SETTINGS);","32","        if (local.syncSettings == null) {","33","            local.syncSettings = DEFAULT_SETTINGS.syncSettings;","34","        }","35","        if (!local.syncSettings) {","36","            this.fillDefaults(local);","37","            return local;","38","        }","40","        const $sync = await readSyncStorage(DEFAULT_SETTINGS);","41","        if (!$sync) {","42","            console.warn('Sync settings are missing');","43","            local.syncSettings = false;","44","            this.set({syncSettings: false});","45","            this.saveSyncSetting(false);","46","            return local;","47","        }","48","","49","        const sync = await readSyncStorage(DEFAULT_SETTINGS);","50","        this.fillDefaults(sync);","51","        return sync;","55","        await this.saveSettingsIntoStorage();","58","    async saveSyncSetting(sync: boolean) {","59","        const obj = {syncSettings: sync};","60","        await writeLocalStorage(obj);","61","        try {","62","            await writeSyncStorage(obj);","63","        } catch (err) {","64","            console.warn('Settings synchronization was disabled due to error:', chrome.runtime.lastError);","65","            this.set({syncSettings: false});","69","    private saveSettingsIntoStorage = debounce(SAVE_TIMEOUT, async () => {","70","        const settings = this.settings;","71","        if (settings.syncSettings) {","72","            try {","73","                await writeSyncStorage(settings);","74","            } catch (err) {","75","                console.warn('Settings synchronization was disabled due to error:', chrome.runtime.lastError);","76","                this.set({syncSettings: false});","77","                await this.saveSyncSetting(false);","78","                await writeLocalStorage(settings);","79","            }","80","        } else {","81","            await writeLocalStorage(settings);","82","        }","83","    });"],"delete":["17","    cleanup() {","18","        chrome.storage.local.remove(['activationTime', 'deactivationTime']);","19","        chrome.storage.sync.remove(['activationTime', 'deactivationTime']);","22","    private loadSettingsFromStorage() {","23","        return new Promise<UserSettings>((resolve) => {","24","            chrome.storage.local.get(DEFAULT_SETTINGS, (local: UserSettings) => {","25","                local.syncSettings = local.syncSettings || DEFAULT_SETTINGS.syncSettings;","26","                if (!local.syncSettings) {","27","                    local.theme = {...DEFAULT_SETTINGS.theme, ...local.theme};","28","                    local.time = {...DEFAULT_SETTINGS.time, ...local.time};","29","                    local.customThemes.forEach((site) => {","30","                        site.theme = {...DEFAULT_SETTINGS.theme, ...site.theme};","31","                    });","32","                    resolve(local);","33","                    return;","34","                }","36","                chrome.storage.sync.get({...DEFAULT_SETTINGS, config: 'empty'}, ($sync: UserSettings & {config: any}) => {","37","                    let sync: UserSettings;","38","                    if (!$sync) {","39","                        this.saveSyncSetting(false);","40","                        resolve(this.loadSettingsFromStorage());","41","                        return;","42","                    }","43","                    if ($sync.config === 'empty') {","44","                        delete $sync.config;","45","                        sync = $sync;","46","                    } else {","47","                        sync = this.migrateSettings_4_6_2($sync) as UserSettings;","48","                    }","49","                    sync.theme = {...DEFAULT_SETTINGS.theme, ...sync.theme};","50","                    sync.time = {...DEFAULT_SETTINGS.time, ...sync.time};","51","                    sync.presets.forEach((preset) => {","52","                        preset.theme = {...DEFAULT_SETTINGS.theme, ...preset.theme};","53","                    });","54","                    sync.customThemes.forEach((site) => {","55","                        site.theme = {...DEFAULT_SETTINGS.theme, ...site.theme};","56","                    });","57","                    resolve(sync);","58","                });","59","            });","60","        });","64","        const saved = await this.saveSettingsIntoStorage(this.settings);","65","        this.settings = saved;","68","    saveSyncSetting(sync: boolean) {","69","        chrome.storage.sync.set({syncSettings: sync}, () => {","70","            if (chrome.runtime.lastError) {","71","                console.warn('Settings synchronization was disabled due to error:', chrome.runtime.lastError);","72","            }","73","        });","74","        chrome.storage.local.set({syncSettings: sync});","75","    }","76","","77","    private saveSettingsIntoStorage(settings: UserSettings) {","78","        if (this.timeout) {","79","            clearInterval(this.timeout);","81","        return new Promise<UserSettings>((resolve) => {","82","            this.timeout = setTimeout(() => {","83","                this.timeout = null;","84","                if (settings.syncSettings) {","85","                    chrome.storage.sync.set(settings, () => {","86","                        if (chrome.runtime.lastError) {","87","                            console.warn('Settings synchronization was disabled due to error:', chrome.runtime.lastError);","88","                            const local: UserSettings = {...settings, syncSettings: false};","89","                            chrome.storage.local.set(local, () => resolve(local));","90","                        } else {","91","                            resolve(settings);","92","                        }","93","                    });","94","                } else {","95","                    chrome.storage.local.set(settings, () => resolve(settings));","96","                }","97","            }, SAVE_TIMEOUT);","98","        });","101","    private timeout: number = null;","130","","131","    private migrateSettings_4_6_2(settings_4_6_2: any) {","132","        function migrateTheme(filterConfig_4_6_2: any) {","133","            const f = filterConfig_4_6_2;","134","            return {","135","                ...DEFAULT_THEME,","136","                mode: f.mode,","137","                brightness: f.brightness,","138","                contrast: f.contrast,","139","                grayscale: f.grayscale,","140","                sepia: f.sepia,","141","                useFont: f.useFont,","142","                fontFamily: f.fontFamily,","143","                textStroke: f.textStroke,","144","                engine: f.engine,","145","                stylesheet: f.stylesheet,","146","            };","147","        }","148","","149","        try {","150","            const s = settings_4_6_2;","151","            const settings: UserSettings = {","152","                ...DEFAULT_SETTINGS,","153","                enabled: s.enabled,","154","                theme: migrateTheme(s.config),","155","                customThemes: s.config.custom ? s.config.custom.map((c) => {","156","                    return {","157","                        url: c.url,","158","                        theme: migrateTheme(c.config),","159","                    };","160","                }) : [],","161","                siteList: s.config.siteList,","162","                applyToListedOnly: s.config.invertListed,","163","                changeBrowserTheme: s.config.changeBrowserTheme,","164","            };","165","            chrome.storage.sync.remove('config');","166","            chrome.storage.sync.set(settings);","167","            return settings;","168","        } catch (err) {","169","            console.error('Settings migration error:', err, 'Loaded settings:', settings_4_6_2);","170","            return DEFAULT_SETTINGS;","171","        }","172","    }"]}],"src\/background\/utils\/extension-api.ts":[{"add":["33","export function readSyncStorage<T extends {[key: string]: any}>(defaults: T): Promise<T> {","34","    return new Promise<T>((resolve) => {","35","        chrome.storage.sync.get(defaults, (sync: T) => {","36","            resolve(sync);","37","        });","38","    });","39","}","40","","41","export function readLocalStorage<T extends {[key: string]: any}>(defaults: T): Promise<T> {","42","    return new Promise<T>((resolve) => {","43","        chrome.storage.local.get(defaults, (local: T) => {","44","            resolve(local);","45","        });","46","    });","47","}","48","","49","export function writeSyncStorage<T extends {[key: string]: any}>(values: T): Promise<void> {","50","    return new Promise<void>((resolve, reject) => {","51","        chrome.storage.sync.set(values, () => {","52","            if (chrome.runtime.lastError) {","53","                reject(chrome.runtime.lastError);","54","                return;","55","            }","56","            resolve();","57","        });","58","    });","59","}","60","","61","export function writeLocalStorage<T extends {[key: string]: any}>(values: T): Promise<void> {","62","    return new Promise<void>((resolve) => {","63","        chrome.storage.local.set(values, () => {","64","            resolve();","65","        });","66","    });","67","}","68",""],"delete":[]}],"src\/utils\/debounce.ts":[{"add":[],"delete":[]}]}},"69e9a7a01eb2df0593d55c385004ae12c5db3c6d":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["315","coopgames.eu","316","","317","INVERT","318","img[alt=\"Online Co-Op\"]","319","img[alt=\"Local Co-Op\"]","320","img[title=\"PS2\"]","321","img[title=\"PS3\"]","322","img[title=\"PS4\"]","323","img[title=\"PSP\"]","324","img[title=\"PS Vita\"]","325","img[title=\"DS\"]","326","img[title=\"3DS\"]","327","img[title=\"Switch\"]","328","","329","================================","330",""],"delete":[]}]}},"aed675db75ebe9edd51fb9a002382a22584f0808":{"changes":{"src\/inject\/dynamic-theme\/stylesheet-modifier.ts":"MODIFY"},"diff":{"src\/inject\/dynamic-theme\/stylesheet-modifier.ts":[{"add":["164","        const groupRefs = new WeakMap<CSSRule, ReadyGroup>();","166","        function getGroup(rule: CSSRule): ReadyGroup {","167","            if (rule == null) {","168","                return rootReadyGroup;","171","            if (groupRefs.has(rule)) {","172","                return groupRefs.get(rule);","173","            }","174","","175","            const group: ReadyGroup = {rule, rules: [], isGroup: true};","176","            groupRefs.set(rule, group);","177","","178","            const parentGroup = getGroup(rule.parentRule);","179","            parentGroup.rules.push(group);","180","","181","            return group;","182","        }","183","","184","        modRules.filter((r) => r).forEach(({selector, declarations, parentRule}) => {","185","            const group = getGroup(parentRule);"],"delete":["164","        const parentGroupRefs = new WeakMap<CSSRule, ReadyGroup>();","166","        modRules.filter((r) => r).forEach(({selector, declarations, parentRule}) => {","167","            let group: ReadyGroup;","168","            if (parentRule == null) {","169","                group = rootReadyGroup;","170","            } else if (parentGroupRefs.has(parentRule)) {","171","                group = parentGroupRefs.get(parentRule);","172","            } else {","173","                group = {rule: parentRule, rules: [], isGroup: true};","174","                parentGroupRefs.set(parentRule, group);","175","                const grandParent = (parentRule as CSSRule).parentRule;","176","                const parentGroup = grandParent ? parentGroupRefs.get(grandParent) : rootReadyGroup;","177","                parentGroup.rules.push(group);"]}]}},"ce24af38aa674071525693e7c9a503f1384cc3c1":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["864",".docs-text-ui-cursor-blink {","865","    fill: ${black} !important;","866","}"],"delete":[]}]}},"1ad3a6da442c5d7dbc04b1fb5067b3716574efdf":{"changes":{"src\/ui\/popup\/components\/site-list-settings\/index.tsx":"MODIFY","src\/background\/extension.ts":"MODIFY","src\/definitions.d.ts":"MODIFY","src\/ui\/controls\/shortcut\/index.tsx":"MODIFY","src\/ui\/controls\/shortcut\/style.less":"MODIFY","src\/ui\/popup\/components\/header\/index.tsx":"MODIFY","src\/background\/utils\/extension-api.ts":"MODIFY","src\/ui\/popup\/components\/engine-switch\/index.tsx":"MODIFY","src\/ui\/connect\/mock.ts":"MODIFY","src\/ui\/connect\/connector.ts":"MODIFY","src\/background\/messenger.ts":"MODIFY"},"diff":{"src\/ui\/popup\/components\/site-list-settings\/index.tsx":[{"add":["42","                onSetShortcut={(shortcut) => actions.setShortcut('addSite', shortcut)}"],"delete":[]}],"src\/background\/extension.ts":[{"add":["7","import {getFontList, getCommands, setShortcut} from '.\/utils\/extension-api';","86","            setShortcut: ({command, shortcut}) => this.setShortcut(command, shortcut),","130","    setShortcut(command: string, shortcut: string) {","131","        setShortcut(command, shortcut);","132","    }","133",""],"delete":["7","import {getFontList, getCommands} from '.\/utils\/extension-api';"]}],"src\/definitions.d.ts":[{"add":["17","    setShortcut(command: string, shortcut: string);"],"delete":[]}],"src\/ui\/controls\/shortcut\/index.tsx":[{"add":["2","import {isFirefox, isMobile} from '..\/..\/..\/utils\/platform';","10","    onSetShortcut: (shortvut: string) => void;","21","    function startEnteringShortcut(node: HTMLAnchorElement) {","22","        const initialText = node.textContent;","23","        node.textContent = 'type a shortcut';","24","","25","        function onKeyDown(e: KeyboardEvent) {","26","            e.preventDefault();","27","            const ctrl = e.ctrlKey;","28","            const alt = e.altKey;","29","            const command = e.metaKey;","30","            const shift = e.shiftKey;","31","","32","            let key: string = null;","33","            if (e.code.startsWith('Key')) {","34","                key = e.code.substring(3);","35","            } else if (e.code.startsWith('Digit')) {","36","                key = e.code.substring(5);","37","            }","38","","39","            const shortcut = `${ctrl ? 'Ctrl+' : alt ? 'Alt+' : command ? 'Command+' : ''}${shift ? 'Shift+' : ''}${key ? key : ''}`;","40","            node.textContent = shortcut;","41","","42","            if ((ctrl || alt || command || shift) && key) {","43","                removeListeners();","44","                props.onSetShortcut(shortcut);","45","                node.blur();","46","                setTimeout(() => {","47","                    node.classList.remove('shortcut--edit');","48","                    node.textContent = props.textTemplate(shortcut);","49","                }, 500);","50","            }","51","        }","52","","53","        function onBlur() {","54","            removeListeners();","55","            node.classList.remove('shortcut--edit');","56","            node.textContent = initialText;","57","        }","58","","59","        function removeListeners() {","60","            window.removeEventListener('keydown', onKeyDown, true);","61","            window.removeEventListener('blur', onBlur, true);","62","        }","63","","64","        window.addEventListener('keydown', onKeyDown, true);","65","        window.addEventListener('blur', onBlur, true);","66","        node.classList.add('shortcut--edit');","67","    }","68","","71","        if (isFirefox()) {","72","            startEnteringShortcut(e.target as HTMLAnchorElement);","73","            return;","74","        }"],"delete":["2","import {getCommands} from '..\/..\/..\/background\/utils';"]}],"src\/ui\/controls\/shortcut\/style.less":[{"add":["12","    white-space: pre;","18","","19","    &--edit {","20","        color: @color-input-fore-active;","21","    }","22","","23","    &::before {","24","        content: \"\";","25","        direction: rtl;","26","        display: inline-block;","27","        line-height: @size-text-small-height;","28","        visibility: hidden;","29","        width: 0;","30","    }","31","","32","    &:hover,","33","    &:focus,","34","    &--edit {","35","        &::before {","36","            visibility: visible;","37","        }","38","    }"],"delete":[]}],"src\/ui\/popup\/components\/header\/index.tsx":[{"add":["36","                        onSetShortcut={(shortcut) => actions.setShortcut('addSite', shortcut)}","54","                    onSetShortcut={(shortcut) => actions.setShortcut('toggle', shortcut)}"],"delete":[]}],"src\/background\/utils\/extension-api.ts":[{"add":["2","declare const browser: {","3","    commands: {","4","        update({name, shortcut}): void;","5","    }","6","};","7","","59","","60","export function setShortcut(command: string, shortcut: string) {","61","    if (typeof browser !== 'undefined' && browser.commands && browser.commands.update) {","62","        browser.commands.update({name: command, shortcut});","63","    }","64","}"],"delete":[]}],"src\/ui\/popup\/components\/engine-switch\/index.tsx":[{"add":["27","                onSetShortcut={(shortcut) => actions.setShortcut('switchEngine', shortcut)}"],"delete":[]}],"src\/ui\/connect\/mock.ts":[{"add":["71","        setShortcut(command, shortcut) {","72","            Object.assign(data.shortcuts, {[command]: shortcut});","73","            listener(data);","74","        },"],"delete":[]}],"src\/ui\/connect\/connector.ts":[{"add":["55","    setShortcut(command: string, shortcut: string) {","56","        this.port.postMessage({type: 'set-shortcut', data: {command, shortcut}});","57","    }","58",""],"delete":[]}],"src\/background\/messenger.ts":[{"add":["8","    setShortcut: ({command, shortcut}) => void;","62","            case 'set-shortcut': {","63","                this.adapter.setShortcut(data);","64","                break;","65","            }"],"delete":[]}]}},"71e0e40f3cf5732c139fbc165b118bce772ca7f8":{"changes":{"tests\/inject\/utils\/url.tests.ts":"MODIFY","CHANGELOG.md":"MODIFY","src\/utils\/url.ts":"MODIFY"},"diff":{"tests\/inject\/utils\/url.tests.ts":[{"add":["134","    expect(isURLEnabled(","135","        'https:\/\/leetcode.com\/problems\/two-sum\/',","136","        {enableForPDF: false, siteList: ['leetcode.com\/problems\/'], siteListEnabled: [], applyToListedOnly: false} as UserSettings,","137","        {isProtected: false, isInDarkList: false},","138","    )).toBe(false);","139","    expect(isURLEnabled(","140","        'https:\/\/leetcode.com\/problemset\/all\/',","141","        {enableForPDF: false, siteList: ['leetcode.com\/problems\/'], siteListEnabled: [], applyToListedOnly: false} as UserSettings,","142","        {isProtected: false, isInDarkList: false},","143","    )).toBe(true);"],"delete":[]}],"CHANGELOG.md":[{"add":["3","- Be stricter when the user specifies a last slash for a URL in the sitelist."],"delete":[]}],"src\/utils\/url.ts":[{"add":["120","    const hasLastSlash = \/\\\/\\$?$\/.test(urlTemplate);","172","        : `(\\\\\/${hasLastSlash ? '' : '?'}.*?)$` \/\/ All following paths and queries"],"delete":["171","        : '(\\\\\/?.*?)$' \/\/ All following paths and queries"]}]}},"ce6515d3dd8459e81e69fb154546c33f5c97ed84":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["8757","udemy.com","8758","","8759","IGNORE INLINE STYLE","8760","[data-purpose=\"star-rating-mask\"] > rect","8761","","8762","================================","8763",""],"delete":[]}]}},"a281fcde1c97ab38145d92a766a497cea54cbcbe":{"changes":{"src\/ui\/connect\/connector.ts":"MODIFY","src\/background\/messenger.ts":"MODIFY"},"diff":{"src\/ui\/connect\/connector.ts":[{"add":["23","    private async firefoxSendRequestWithResponse<T>(type: string, data?: any) {","35","            data && dataPort.postMessage(data);","94","        if (isFirefox) {","95","            return await this.firefoxSendRequestWithResponse<void>(MessageType.UI_APPLY_DEV_DYNAMIC_THEME_FIXES, {data: text});","96","        }","105","        if (isFirefox) {","106","            return await this.firefoxSendRequestWithResponse<void>(MessageType.UI_APPLY_DEV_INVERSION_FIXES, {data: text});","107","        }","116","        if (isFirefox) {","117","            return await this.firefoxSendRequestWithResponse<void>(MessageType.UI_APPLY_DEV_STATIC_THEMES, {data: text});","118","        }"],"delete":["23","    private async firefoxSendRequestWithResponse<T>(type: string) {"]}],"src\/background\/messenger.ts":[{"add":["29","        const allowedSenderURL = [chrome.runtime.getURL('\/ui\/popup\/index.html'), chrome.runtime.getURL('\/ui\/devtools\/index.html')];","31","            if (allowedSenderURL.includes(sender.url)) {","52","                    \/\/ These types require data, so we need to add a listener to the port.","53","                    case MessageType.UI_APPLY_DEV_DYNAMIC_THEME_FIXES:","54","                    case MessageType.UI_APPLY_DEV_INVERSION_FIXES:","55","                    case MessageType.UI_APPLY_DEV_STATIC_THEMES:","56","                        promise = new Promise((resolve, reject) => {","57","                            port.onMessage.addListener((message: Message) => {","58","                                const {data} = message;","59","                                let error: Error;","60","                                switch (port.name) {","61","                                    case MessageType.UI_APPLY_DEV_DYNAMIC_THEME_FIXES:","62","                                        error = this.adapter.applyDevDynamicThemeFixes(data);","63","                                        break;","64","                                    case MessageType.UI_APPLY_DEV_INVERSION_FIXES:","65","                                        error = this.adapter.applyDevInversionFixes(data);","66","                                        break;","67","                                    case MessageType.UI_APPLY_DEV_STATIC_THEMES:","68","                                        error = this.adapter.applyDevStaticThemes(data);","69","                                        break;","70","                                    default:","71","                                        throw new Error(`Unknown port name: ${port.name}`);","72","                                }","73","                                if (error) {","74","                                    reject(error);","75","                                } else {","76","                                    resolve(null);","77","                                }","78","                            });","79","                        });","80","                        break;"],"delete":["30","            if (sender.url === chrome.runtime.getURL('\/ui\/popup\/index.html')) {"]}]}},"1e223735bac1ea6368d0ff87567278f24bf90e1d":{"changes":{"src\/utils\/url.ts":"MODIFY","tests\/url.tests.ts":"ADD"},"diff":{"src\/utils\/url.ts":[{"add":["99","    if (isProtected) {","100","        return false;","101","    }","103","    if (userSettings.applyToListedOnly) {","104","        return isURLInUserList;","105","    }","106","    return (!isInDarkList && !isURLInUserList);"],"delete":["100","    const isForcedEnable = isURLInUserList && userSettings.applyToListedOnly;","101","    const isForcedDisable = isURLInUserList && !userSettings.applyToListedOnly;","102","    return (","103","        !isProtected && (","104","            isForcedEnable ||","105","            (!isInDarkList && !isForcedDisable)","106","        )","107","    );"]}],"tests\/url.tests.ts":[{"add":[],"delete":[]}]}},"4fe5170a1741547080c28744dd6db5d25fd878f3":{"changes":{"src\/inject\/dynamic-theme\/index.ts":"MODIFY"},"diff":{"src\/inject\/dynamic-theme\/index.ts":[{"add":["132","        ) &&","133","        element.media !== 'print'"],"delete":["132","        )"]}]}},"a7b56d234a8ab7b2c2ef0e3c362c0a697df2c543":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["3810",".md p>a[href=\"#s\"]::after, a[href=\"#s\"]::after {","3811","    color: #000;","3812","}"],"delete":[]}]}},"13c147c0420be70809f4d16581c1d3326d2573d1":{"changes":{"src\/inject\/dynamic-theme\/style-manager.ts":"MODIFY","src\/inject\/dynamic-theme\/css-rules.ts":"MODIFY"},"diff":{"src\/inject\/dynamic-theme\/style-manager.ts":[{"add":["0","import {iterateCSSRules, iterateCSSDeclarations, replaceCSSRelativeURLsWithAbsolute, replaceCSSFontFace, replaceCSSVariables, getCSSURLValue, cssImportRegex} from '.\/css-rules';","5","import {getMatches} from '..\/..\/utils\/text';","368","async function loadCSSText(url: string) {","392","","393","    const importMatches = getMatches(cssImportRegex, cssText);","394","    for (let match of importMatches) {","395","        const importURL = getCSSURLValue(match.substring(8).replace(\/;$\/, ''));","396","        const importedCSS = await loadCSSText(importURL);","397","        cssText = cssText.split(match).join(importedCSS);","398","    }","399","","402","    return cssText;","403","}","404","","405","async function createCORSCopy(link: HTMLLinkElement, isCancelled: () => boolean) {","406","    const url = link.href;","407","    const prevCors = Array.from<HTMLStyleElement>(link.parentElement.querySelectorAll('.darkreader--cors')).find((el) => el.dataset.uri === url);","408","    if (prevCors) {","409","        return prevCors;","410","    }","411","","412","    const cssText = await loadCSSText(url);"],"delete":["0","import {iterateCSSRules, iterateCSSDeclarations, replaceCSSRelativeURLsWithAbsolute, replaceCSSFontFace, replaceCSSVariables} from '.\/css-rules';","367","async function createCORSCopy(link: HTMLLinkElement, isCancelled: () => boolean) {","368","    const url = link.href;","369","    const prevCors = Array.from<HTMLStyleElement>(link.parentElement.querySelectorAll('.darkreader--cors')).find((el) => el.dataset.uri === url);","370","    if (prevCors) {","371","        return prevCors;","372","    }","373",""]}],"src\/inject\/dynamic-theme\/css-rules.ts":[{"add":["27","export const cssImportRegex = \/@import url\\((('.+?')|(\".+?\")|([^\\)]*?))\\);?\/g;"],"delete":[]}]}},"307dea8fad9613bec12c6efb8da45be0c53f36da":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["2904","input.docs-title-input {","2905","    color: var(--darkreader-neutral-text) !important;","2906","}"],"delete":[]}]}},"4e74be67b71530caadeeecaaa4f389f8139d3865":{"changes":{"src\/utils\/time.ts":"MODIFY","CHANGELOG.md":"MODIFY"},"diff":{"src\/utils\/time.ts":[{"add":["59","        date.setMilliseconds(0);","60","        \/\/ Convert into UTC timezone Unix time.","61","        return date.getTime() + date.getTimezoneOffset() * 60 * 1000;","70","        date.setMilliseconds(0);","71","        \/\/ Convert into UTC timezone Unix time.","72","        return date.getTime() + date.getTimezoneOffset() * 60 * 60 * 1000;"],"delete":["59","        return date.getTime();","68","        return date.getTime();"]}],"CHANGELOG.md":[{"add":["3","- Fix time automation when user's time zone is non-UTC."],"delete":[]}]}},"651397ea5c2eda429fcef7b9b095c63ea6057c27":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["895","copitosystem.com","896","","897","CSS","898","body {","899","    background-image: none !important;","900","    background-color: var(--darkreader-neutral-background) !important;","901","}","902","","903","================================","904",""],"delete":[]}]}},"9a4dd447a68e76c7ae794355bf99cdb674d79f24":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["918","    color: ${black} !important;","920","html[hide-scrollbar] ::-webkit-scrollbar {","921","    display: none !important;"],"delete":["917","","919","    color: rgb(255, 255, 255) !important;","921",".policies-page, .copyright-page, .experiences-page {","922","     background-image: none !important;"]}]}},"8ac9221ac485b32bcea3b0bc3b69855d5cb12418":{"changes":{"src\/definitions.d.ts":"MODIFY","src\/ui\/popup\/settings-page\/invert-pdf.tsx":"ADD","src\/background\/user-storage.ts":"MODIFY","src\/ui\/popup\/settings-page\/index.tsx":"MODIFY","src\/background\/utils\/extension-api.ts":"MODIFY","src\/ui\/popup\/settings-page\/devtools.tsx":"MODIFY","src\/config\/dynamic-theme-fixes.config":"MODIFY","src\/utils\/url.ts":"MODIFY","tests\/url.tests.ts":"MODIFY"},"diff":{"src\/definitions.d.ts":[{"add":["72","    enableForPDF: boolean;"],"delete":[]}],"src\/ui\/popup\/settings-page\/invert-pdf.tsx":[{"add":[],"delete":[]}],"src\/background\/user-storage.ts":[{"add":["42","            enableForPDF: true,"],"delete":[]}],"src\/ui\/popup\/settings-page\/index.tsx":[{"add":["5","import InvertPDF from '.\/invert-pdf';","11","            <InvertPDF {...props} \/>"],"delete":[]}],"src\/background\/utils\/extension-api.ts":[{"add":["15","            && !url.endsWith('.pdf')"],"delete":[]}],"src\/ui\/popup\/settings-page\/devtools.tsx":[{"add":["7","","8","function getExistingDevToolsWindow() {","9","    return new Promise<chrome.windows.Window>((resolve) => {","10","        chrome.windows.getAll({","11","            populate: true,","12","            windowTypes: ['popup']","13","        }, (w) => {","14","            for (const window of w) {","15","                if (window.tabs[0].url.endsWith('ui\/devtools\/index.html')) {","16","                    resolve(window);","17","                    return;","18","                }","19","            }","20","            resolve(null);","21","        });","25","async function openDevTools() {","26","    const devToolsWindow = await getExistingDevToolsWindow();","27","    if (devToolsWindow) {","28","        chrome.windows.update(devToolsWindow.id, {'focused': true});","29","    } else {","30","        chrome.windows.create({","31","            type: 'popup',","32","            url: 'ui\/devtools\/index.html',","33","            width: 600,","34","            height: 600,","35","        });","36","    }","37","}","38",""],"delete":["7","function openDevTools() {","8","    \/\/ TODO: Switch to already opened window.","9","    chrome.windows.create({","10","        type: 'panel',","11","        url: 'ui\/devtools\/index.html',","12","        width: 600,","13","        height: 600,"]}],"src\/config\/dynamic-theme-fixes.config":[{"add":["4","embed[type=\"application\/pdf\"]"],"delete":[]}],"src\/utils\/url.ts":[{"add":["98","export function isPDF(url: string) {","99","    if (url.includes('.pdf')) {","100","        if (url.includes('?')) {","101","            url = url.substring(0, url.lastIndexOf('?'));","102","        }","103","        if (url.includes('#')) {","104","            url = url.substring(0, url.lastIndexOf('#'));","105","        }","106","        if (url.endsWith('.pdf')) {","107","            for (let i = url.length; 0 < i; i--) {","108","                if (url[i] === '=') {","109","                    return false;","110","                } else if (url[i] === '\/') {","111","                    return true;","112","                }","113","            }","114","        } else {","115","            return false;","116","        }","117","    }","118","    return false;","119","}","120","","122","    if (isPDF(url) && userSettings.enableForPDF) {","123","        return true;","124","    }","125","    if (isPDF(url) && !userSettings.enableForPDF) {","126","        return false;","127","    }"],"delete":[]}],"tests\/url.tests.ts":[{"add":["0","import {isURLEnabled, isPDF} from '..\/src\/utils\/url';","89","    expect(isURLEnabled(","90","        'https:\/\/www.google.com\/file.pdf',","91","        {enableForPDF: true, siteList: ['darkreader.org'], siteListEnabled: [], applyToListedOnly: true} as UserSettings,","92","        {isProtected: false, isInDarkList: false},","93","    )).toBe(true);","94","    expect(isURLEnabled(","95","        'https:\/\/www.google.com\/file.pdf\/resource',","96","        {enableForPDF: true, siteList: ['darkreader.org'], siteListEnabled: [], applyToListedOnly: true} as UserSettings,","97","        {isProtected: false, isInDarkList: false},","98","    )).toBe(false);","99","    expect(isURLEnabled(","100","        'https:\/\/www.google.com\/file.pdf\/resource',","101","        {enableForPDF: true, siteList: ['darkreader.org'], siteListEnabled: [], applyToListedOnly: false} as UserSettings,","102","        {isProtected: false, isInDarkList: false},","103","    )).toBe(true);","104","    expect(isURLEnabled(","105","        'https:\/\/www.google.com\/very\/good\/hidden\/folder\/pdf#file.pdf',","106","        {enableForPDF: true, siteList: ['https:\/\/www.google.com\/very\/good\/hidden\/folder\/pdf#file.pdf'], siteListEnabled: [], applyToListedOnly: false} as UserSettings,","107","        {isProtected: false, isInDarkList: false},","108","    )).toBe(false);","109","","110","    \/\/ Test for PDF enabling","111","    expect(isPDF(","112","        'https:\/\/www.google.com\/file.pdf'","113","    )).toBe(true);","114","    expect(isPDF(","115","        'https:\/\/www.google.com\/file.pdf?id=2'","116","    )).toBe(true);","117","    expect(isPDF(","118","        'https:\/\/www.google.com\/file.pdf\/resource'","119","    )).toBe(false);","120","    expect(isPDF(","121","        'https:\/\/www.google.com\/resource?file=file.pdf'","122","    )).toBe(false);","123","    expect(isPDF(","124","        'https:\/\/www.google.com\/very\/good\/hidden\/folder\/pdf#file.pdf'","125","    )).toBe(false);"],"delete":["0","import {isURLEnabled} from '..\/src\/utils\/url';"]}]}},"872d9330653c31f78f96b3769fb0f81406dd54f2":{"changes":{"src\/ui\/popup\/body\/style.less":"MODIFY"},"diff":{"src\/ui\/popup\/body\/style.less":[{"add":["134",".mobile {","135","    .darkreader-version {","136","        position: relative;","137","    }","138","}","139",""],"delete":[]}]}},"4395aac97c491128a54a057481f81d50109f05da":{"changes":{"src\/inject\/dynamic-theme\/inline-style.ts":"MODIFY","src\/inject\/dynamic-theme\/index.ts":"MODIFY","src\/inject\/dynamic-theme\/style-manager.ts":"MODIFY","src\/inject\/dynamic-theme\/css-rules.ts":"MODIFY"},"diff":{"src\/inject\/dynamic-theme\/inline-style.ts":[{"add":["1","import {getModifiableCSSDeclaration} from '.\/modify-css';","91","export const INLINE_STYLE_SELECTOR = INLINE_STYLE_ATTRS.map((attr) => `[${attr}]`).join(', ');","118","export function watchForInlineStyles(elementStyleDidChange: (element: HTMLElement) => void) {","126","                createdInlineStyles.forEach((el: HTMLElement) => elementStyleDidChange(el));","129","                if (INLINE_STYLE_ATTRS.includes(m.attributeName)) {","130","                    elementStyleDidChange(m.target as HTMLElement);","153","const inlineStyleCache = new WeakMap<HTMLElement, string>();","154","const filterProps = ['brightness', 'contrast', 'grayscale', 'sepia', 'mode'];","155","","156","function getInlineStyleCacheKey(el: HTMLElement, theme: FilterConfig) {","157","    return INLINE_STYLE_ATTRS","158","        .map((attr) => `${attr}=\"${el.getAttribute(attr)}\"`)","159","        .concat(filterProps.map((prop) => `${prop}=\"${theme[prop]}\"`))","160","        .join(' ');","163","export function overrideInlineStyle(element: HTMLElement, theme: FilterConfig) {","164","    const cacheKey = getInlineStyleCacheKey(element, theme);","165","    if (cacheKey === inlineStyleCache.get(element)) {","166","        return;","167","    }","172","        const {customProp, dataAttr} = overrides[targetCSSProp];","180","            value = value(theme) as string;","231","","237","    inlineStyleCache.set(element, getInlineStyleCacheKey(element, theme));"],"delete":["1","import {getModifiableCSSDeclaration, ModifiableCSSDeclaration} from '.\/modify-css';","91","const INLINE_STYLE_SELECTOR = INLINE_STYLE_ATTRS.map((attr) => `[${attr}]`).join(', ');","103","const inlineStyleElements = new WeakSet<Node>();","106","export function overrideInlineStyles(filter: FilterConfig) {","107","    const elements = Array.from(document.querySelectorAll(INLINE_STYLE_SELECTOR));","108","    elements.forEach((el) => elementDidUpdate(el as HTMLElement, filter));","109","}","110","","124","export function watchForInlineStyles(filter: FilterConfig) {","132","                createdInlineStyles.forEach((el) => elementDidUpdate(el as HTMLElement, filter));","135","                if (INLINE_STYLE_ATTRS.indexOf(m.attributeName) >= 0) {","136","                    elementDidUpdate(m.target as HTMLElement, filter);","152","const elementsChangeKeys = new WeakMap<Element, string>();","153","const filterProps = ['brightness', 'contrast', 'grayscale', 'sepia', 'mode'];","154","","155","function getElementChangeKey(el: Element, filter: FilterConfig) {","156","    return INLINE_STYLE_ATTRS","157","        .map((attr) => `${attr}=\"${el.getAttribute(attr)}\"`)","158","        .concat(filterProps.map((prop) => `${prop}=\"${filter[prop]}\"`))","159","        .join(' ');","160","}","161","","169","function elementDidUpdate(element: HTMLElement, filter: FilterConfig) {","170","    if (elementsChangeKeys.get(element) === getElementChangeKey(element, filter)) {","171","        return;","172","    }","173","    overrideInlineStyle(element, filter);","176","function overrideInlineStyle(element: HTMLElement, filter: FilterConfig) {","181","        const {customProp, dataAttr, store} = overrides[targetCSSProp];","189","            value = value(filter) as string;","245","    elementsChangeKeys.set(element, getElementChangeKey(element, filter));"]}],"src\/inject\/dynamic-theme\/index.ts":[{"add":["0","import {replaceCSSVariables, getElementCSSVariables} from '.\/css-rules';","1","import {overrideInlineStyle, getInlineOverrideStyle, watchForInlineStyles, stopWatchingForInlineStyles, INLINE_STYLE_SELECTOR} from '.\/inline-style';","112","","113","    updateVariables(getElementCSSVariables(document.documentElement));","114","","136","","137","    const inlineStyleElements = Array.from(document.querySelectorAll(INLINE_STYLE_SELECTOR));","138","    inlineStyleElements.forEach((el) => overrideInlineStyle(el as HTMLElement, filter));","282","","283","    watchForInlineStyles((element) => {","284","        overrideInlineStyle(element, filter);","285","        if (element === document.documentElement) {","286","            const rootVariables = getElementCSSVariables(document.documentElement);","287","            if (rootVariables.size > 0) {","288","                updateVariables(rootVariables);","289","                throttledRenderAllStyles();","290","            }","291","        }","292","    });"],"delete":["0","import {replaceCSSVariables} from '.\/css-rules';","1","import {overrideInlineStyles, getInlineOverrideStyle, watchForInlineStyles, stopWatchingForInlineStyles} from '.\/inline-style';","133","    overrideInlineStyles(filter);","277","    watchForInlineStyles(filter);"]}],"src\/inject\/dynamic-theme\/style-manager.ts":[{"add":["0","import {iterateCSSRules, iterateCSSDeclarations, getCSSVariables, replaceCSSRelativeURLsWithAbsolute, removeCSSComments, replaceCSSFontFace, replaceCSSVariables, getCSSURLValue, cssImportRegex, getCSSBaseBath} from '.\/css-rules';","171","        const variables = getCSSVariables(rules);"],"delete":["0","import {iterateCSSRules, iterateCSSDeclarations, replaceCSSRelativeURLsWithAbsolute, removeCSSComments, replaceCSSFontFace, replaceCSSVariables, getCSSURLValue, cssImportRegex, getCSSBaseBath} from '.\/css-rules';","150","    function getVariables(rules: CSSRuleList) {","151","        const variables = new Map<string, string>();","152","        rules && iterateCSSRules(rules, (rule) => {","153","            rule.style && iterateCSSDeclarations(rule.style, (property, value) => {","154","                if (property.startsWith('--')) {","155","                    variables.set(property, value);","156","                }","157","            });","158","        });","159","        return variables;","160","    }","161","","183","        const variables = getVariables(rules);"]}],"src\/inject\/dynamic-theme\/css-rules.ts":[{"add":["4","    Array.from(rules)","35","function isCSSVariable(property: string) {","36","    return property.startsWith('--') && !property.startsWith('--darkreader');","37","}","38","","39","export function getCSSVariables(rules: CSSRuleList) {","40","    const variables = new Map<string, string>();","41","    rules && iterateCSSRules(rules, (rule) => {","42","        rule.style && iterateCSSDeclarations(rule.style, (property, value) => {","43","            if (isCSSVariable(property)) {","44","                variables.set(property, value);","45","            }","46","        });","47","    });","48","    return variables;","49","}","50","","51","export function getElementCSSVariables(element: HTMLElement) {","52","    const variables = new Map<string, string>();","53","    iterateCSSDeclarations(element.style, (property, value) => {","54","        if (isCSSVariable(property)) {","55","            variables.set(property, value);","56","        }","57","    });","58","    return variables;","59","}","60",""],"delete":["4","    Array.from<CSSRule>(rules as any)"]}]}},"bae69f9d86276ddecc6d2f2ffd211e4e5fb5e75f":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["5502","img,","5503",".mocat-item__image,","5504",".primary-nav .nav-item-type-cat-image {"],"delete":["5502","img.listview__image,","5503","img.galleryview__image,","5504",".variant__header__dropdown__item__icon img,","5505",".mocat-item__image  {"]}]}},"e796511d7a673cf4a2cdb5f42592799dcf363d3e":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["2970","div[role=\"dialog\"] div[role=\"slider\"][data-saturation] div:nth-child(2) {","2971","    background-image: linear-gradient(to right,#fff 0%,rgba(255,255,255,0) 100%) !important;","2972","}","2976","div[role=\"gridcell\"] div[role=\"button\"]","2977","div[role=\"dialog\"] div[role=\"slider\"]","2978","div[role=\"dialog\"] div[role=\"slider\"] div[style]","2979","div[role=\"dialog\"] div[role=\"button\"][data-contrast]"],"delete":[]}]}},"829d070bc4dc8faee0e18b088dc948ec47e8fc4e":{"changes":{"src\/inject\/dynamic-theme\/style-manager.ts":"MODIFY","src\/inject\/dynamic-theme\/css-rules.ts":"MODIFY"},"diff":{"src\/inject\/dynamic-theme\/style-manager.ts":[{"add":["0","import {iterateCSSRules, iterateCSSDeclarations, replaceCSSRelativeURLsWithAbsolute, removeCSSComments, replaceCSSFontFace, replaceCSSVariables, getCSSURLValue, cssImportRegex, getCSSBaseBath} from '.\/css-rules';","514","    cssText = removeCSSComments(cssText);"],"delete":["0","import {iterateCSSRules, iterateCSSDeclarations, replaceCSSRelativeURLsWithAbsolute, replaceCSSFontFace, replaceCSSVariables, getCSSURLValue, cssImportRegex, getCSSBaseBath} from '.\/css-rules';"]}],"src\/inject\/dynamic-theme\/css-rules.ts":[{"add":["54","const cssCommentsRegex = \/\\\/\\*[\\s\\S]*?\\*\\\/\/g;","55","","56","export function removeCSSComments($css: string) {","57","    return $css.replace(cssCommentsRegex, '');","58","}","59",""],"delete":[]}]}},"31bb8a1b94024bdb19193c4a341da0a0150cae33":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["234","CSS","235",".markdown-body code,","236",".markdown-body pre {","237","    background-color: ${rgba(27, 31, 35, 0.1)} !important;","238","}","239",".markdown-body pre code {","240","    background-color: transparent !important;","241","}","242",""],"delete":[]}]}},"b8457d1bcc4ca44f34138e7464449253bdeab3db":{"changes":{"src\/background\/extension.ts":"MODIFY","src\/background\/tab-manager.ts":"MODIFY","src\/ui\/popup\/components\/site-toggle\/index.tsx":"MODIFY","src\/inject\/index.ts":"MODIFY"},"diff":{"src\/background\/extension.ts":[{"add":["43","            getConnectionMessage: ({url, frameURL, unsupportedSender}) => {","44","                if (unsupportedSender) {","45","                    return this.getUnsupportedSenderMessage();","46","                }","47","                return this.getConnectionMessage(url, frameURL);","48","            },","224","    private getUnsupportedSenderMessage() {","225","        return {type: 'unsupported-sender'};","226","    }","227",""],"delete":["43","            getConnectionMessage: (url, frameURL) => this.getConnectionMessage(url, frameURL),"]}],"src\/background\/tab-manager.ts":[{"add":["10","interface ConnectionMessageOptions {","11","    url: string;","12","    frameURL: string;","13","    unsupportedSender?: boolean;","14","}","15","","17","    getConnectionMessage: (options: ConnectionMessageOptions) => any;","33","                const reply = (options: ConnectionMessageOptions) => {","34","                    const message = getConnectionMessage(options);","35","                    if (message instanceof Promise) {","36","                        message.then((asyncMessage) => asyncMessage && port.postMessage(asyncMessage));","37","                    } else if (message) {","38","                        port.postMessage(message);","39","                    }","40","                };","41","","42","                const isPanel = port.sender.tab == null;","43","                if (isPanel) {","44","                    \/\/ NOTE: Vivaldi and Opera can show a page in a side panel,","45","                    \/\/ but it is not possible to handle messaging correctly (no tab ID, frame ID).","46","                    reply({url: port.sender.url, frameURL: null, unsupportedSender: true});","47","                    return;","48","                }","49","","51","                const {frameId} = port.sender;","52","                const senderURL = port.sender.url;","53","                const tabURL = port.sender.tab.url;","54","","62","                framesPorts.set(frameId, {url: senderURL, port});","70","                reply({","71","                    url: tabURL,","72","                    frameURL: frameId === 0 ? null : senderURL,","73","                });"],"delete":["11","    getConnectionMessage: (url: string, frameUrl: string) => any;","28","                const frameId = port.sender.frameId;","29","                const url = port.sender.url;","37","                framesPorts.set(frameId, {url, port});","45","                const message = getConnectionMessage(port.sender.tab.url, frameId === 0 ? null : url);","46","                if (message instanceof Promise) {","47","                    message.then((asyncMessage) => asyncMessage && port.postMessage(asyncMessage));","48","                } else if (message) {","49","                    port.postMessage(message);","50","                }"]}],"src\/ui\/popup\/components\/site-toggle\/index.tsx":[{"add":["16","        data.settings.enableForProtectedPages ||"],"delete":["16","        data.settings.enableForProtectedPages || "]}],"src\/inject\/index.ts":[{"add":["33","        case 'unsupported-sender':"],"delete":[]}]}},"39a9569cca3c689a42d6a72a6bd4d0c0379de38c":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["2781","maps.metager.de","2782","","2783","INVERT","2784",".map canvas","2785","","2786","================================","2787",""],"delete":[]}]}},"d3a6a540e0bdea7162c01183f148e766eab5babe":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["274","answers.unity.com","275","","276","CSS","277","header.section-header div.shard:before {","278","    background: url(\/\/unity3d.com\/profiles\/unity3d\/themes\/unity\/images\/assets\/layout\/shard.png) 0 0 no-repeat !important;","279","}","280","","281","================================","282",""],"delete":[]}]}},"8d4ee65ef3a0878309d8d7de5f5b20f169f6f5bf":{"changes":{"src\/background\/extension.ts":"MODIFY","src\/inject\/dynamic-theme\/index.ts":"MODIFY","tasks\/bundle-js.js":"MODIFY","src\/manifest.json":"MODIFY","src\/inject\/dynamic-theme\/css-collection.ts":"MODIFY","src\/inject\/fallback.ts":"ADD"},"diff":{"src\/background\/extension.ts":[{"add":["209","            return this.getTabMessage(url, frameURL);","213","                    resolve(this.getTabMessage(url, frameURL));","428","","429","        console.log(`Site is not inverted: ${url}`);"],"delete":["209","            return this.isEnabled() && this.getTabMessage(url, frameURL);","213","                    resolve(this.isEnabled() && this.getTabMessage(url, frameURL));","427","        } else {","428","            console.log(`Site is not inverted: ${url}`);"]}],"src\/inject\/dynamic-theme\/index.ts":[{"add":["51","    const fallbackStyle = createOrUpdateStyle('darkreader--fallback', document);","133","    const fallback = document.querySelector('.darkreader--fallback');"],"delete":["51","    const fallbackStyle = createOrUpdateStyle('darkreader--fallback');","133","    const fallback = document.head.querySelector('.darkreader--fallback');"]}],"tasks\/bundle-js.js":[{"add":["62","        src: 'src\/inject\/fallback.ts',","63","        dest: 'inject\/fallback.js',","64","        reloadType: reload.FULL,","65","        async postBuild({debug}) {","66","            await copyToFF({cwdPath: this.dest, debug});","67","        },","68","        watchFiles: null,","69","    },","70","    {"],"delete":[]}],"src\/manifest.json":[{"add":["30","                \"inject\/fallback.js\","],"delete":[]}],"src\/inject\/dynamic-theme\/css-collection.ts":[{"add":["41","        const staticStyle = document.querySelector(selector);"],"delete":["41","        const staticStyle = document.head.querySelector(selector);"]}],"src\/inject\/fallback.ts":[{"add":[],"delete":[]}]}},"db60d03f0a7c7fa9004d87aa2106f95c9a947f37":{"changes":{"package-lock.json":"MODIFY","src\/utils\/ipv6.ts":"MODIFY","src\/inject\/dynamic-theme\/index.ts":"MODIFY","src\/generators\/modify-colors.ts":"MODIFY","src\/utils\/url.ts":"MODIFY","tests\/url.tests.ts":"MODIFY"},"diff":{"package-lock.json":[{"add":["5770","      \"resolved\": \"https:\/\/registry.npmjs.org\/safe-regex\/-\/safe-regex-1.1.0.tgz\",","6366","      \"resolved\": \"https:\/\/registry.npmjs.org\/strip-eof\/-\/strip-eof-1.0.0.tgz\","],"delete":["5770","      \"resolved\": \"http:\/\/registry.npmjs.org\/safe-regex\/-\/safe-regex-1.1.0.tgz\",","6366","      \"resolved\": \"http:\/\/registry.npmjs.org\/strip-eof\/-\/strip-eof-1.0.0.tgz\","]}],"src\/utils\/ipv6.ts":[{"add":["0","export function isIPV6(url: string) {","1","    const openingBracketIndex = url.indexOf('[');","2","    if (openingBracketIndex < 0) {","3","        return false;","4","    }","5","    const queryIndex = url.indexOf('?');","6","    if (queryIndex >= 0 && openingBracketIndex > queryIndex) {","7","        return false;","8","    }","9","    return true;","10","}","11","","12","const ipV6HostRegex = \/\\[.*?\\](\\:\\d+)?\/;","13","","14","export function compareIPV6(firstURL: string, secondURL: string) {","15","    const firstHost = firstURL.match(ipV6HostRegex)[0];","16","    const secondHost = secondURL.match(ipV6HostRegex)[0];","17","    return firstHost === secondHost;"],"delete":["0","\/**","1"," * Compares if IPV6 addresses are the same.","2"," * @param firstIP First IP to compare with","3"," * @param secondIP Second IP to compare with","4"," *\/","5","export function compareIPV6(firstIP: string, secondIP: string) {","6","    firstIP = (firstIP","7","        .replace(\/^\\^\/, '') \/\/ Remove ^ at start","8","        .replace(\/\\$$\/, '') \/\/ Remove $ at end","9","        .replace(\/^.*?\\\/{2,3}\/, '') \/\/ Remove scheme","10","        .replace(\/\\?.*$\/, '') \/\/ Remove query","11","        .replace(\/\\\/$\/, '') \/\/ Remove last slash","12","    );","13","    const ip = secondIP.toLowerCase();","14","    const ip2 = firstIP.toLowerCase();","15","    return ip === ip2;"]}],"src\/inject\/dynamic-theme\/index.ts":[{"add":["288","    if (Array.isArray(node.adoptedStyleSheets)) {","289","        if (node.adoptedStyleSheets.length > 0) {","290","            const newManger = createAdoptedStyleSheetOverride(node);","291","            adoptedStyleManagers.push(newManger);","292","            newManger.render(filter, variables);","293","        }"],"delete":["288","    if (node.adoptedStyleSheets.length > 0) {","289","        const newManger = createAdoptedStyleSheetOverride(node);","290","        adoptedStyleManagers.push(newManger);","291","        newManger.render(filter, variables);"]}],"src\/generators\/modify-colors.ts":[{"add":[],"delete":["0","import {DEFAULT_COLORS} from '..\/defaults';"]}],"src\/utils\/url.ts":[{"add":["1","import {isIPV6, compareIPV6} from '.\/ipv6';","31","    const isFirstIPV6 = isIPV6(url);","32","    const isSecondIPV6 = isIPV6(urlTemplate);","35","    } else if (!isSecondIPV6 && !isSecondIPV6) {"],"delete":["1","import {compareIPV6} from '.\/ipv6';","31","    const isFirstIPV6 = url.includes('[');","32","    const isSecondIPV6 = urlTemplate.includes('[');","35","    } else if (!isFirstIPV6 && ! isSecondIPV6){"]}],"tests\/url.tests.ts":[{"add":["0","import {isURLEnabled, isURLMatched, isPDF} from '..\/src\/utils\/url';","169","    \/\/ Some URLs can have unescaped [] in query","170","    expect(isURLMatched(","171","        'google.co.uk\/order.php?bar=[foo]',","172","        'google.co.uk',","173","    )).toEqual(true);","174","    expect(isURLMatched(","175","        '[2001:4860:4860::8844]\/order.php?bar=foo',","176","        '[2001:4860:4860::8844]',","177","    )).toEqual(true);","178","    expect(isURLMatched(","179","        '[2001:4860:4860::8844]\/order.php?bar=[foo]',","180","        '[2001:4860:4860::8844]',","181","    )).toEqual(true);","182","    expect(isURLMatched(","183","        'google.co.uk\/order.php?bar=[foo]',","184","        '[2001:4860:4860::8844]',","185","    )).toEqual(false);","186",""],"delete":["0","import {isURLEnabled, isPDF} from '..\/src\/utils\/url';"]}]}},"5607a55eaca5a3ce39106ed306579db24626c9c1":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["1100","IGNORE INLINE STYLE","1101","div[role=\"presentation\"] svg","1102",""],"delete":[]}]}},"ea332df58f73717ba8e1b7e50b7616c24d21a5ea":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["78","google.*\/maps","79","google.*.*\/maps"],"delete":["78","google.com\/maps"]}]}},"eed3b5516c5e321b509c69e313a60992833182f4":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["11697","body:not(.dark-mode) .web-navigation__logo-link.button-reset.ember-view","11698","body:not(.dark-mode) .native-upsell__logo","11699","body:not(.dark-mode) .native-upsell__action","11700","body:not(.dark-mode) .dt-search-box__icon"],"delete":["11697",".web-navigation__logo-link.button-reset.ember-view","11698",".native-upsell__logo","11699",".native-upsell__action","11700",".dt-search-box__icon"]}]}},"609550a2597eb3275ae6d1b9a51cb5d016290248":{"changes":{"src\/ui\/controls\/toggle\/index.tsx":"MODIFY"},"diff":{"src\/ui\/controls\/toggle\/index.tsx":[{"add":["16","        props.class,"],"delete":["16","        [props.class],"]}]}},"5305b90936aecb79c648865f16278bd11301aea9":{"changes":{"src\/background\/tab-manager.ts":"MODIFY"},"diff":{"src\/background\/tab-manager.ts":[{"add":["104","                        return true;","213","            sendResponse({type: '\\\\_()_\/'});","214","            return true;"],"delete":["104","                        return;"]}]}},"dc863668e8388ad26af9beff0c9fcd007ae4d742":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["5829","shop.dr-rath.com","5830","","5831","CSS","5832",".colored-header-desktop {","5833","    background-color: var(--darkreader-neutral-background) !important;","5834","}","5835","","5836","================================","5837",""],"delete":[]}]}},"48f947aeca74b2e04059144c2cfaef35e139aba5":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["5122","div[data-label=\"nd\"] > div > div > svg > path[fill=\"#000000\"]"],"delete":[]}]}},"eee9109f0f8f7c6ac2718ddcfd4f43bd4f545a32":{"changes":{"src\/utils\/ipv6.ts":"MODIFY","tests\/inject\/utils\/url.tests.ts":"MODIFY"},"diff":{"src\/utils\/ipv6.ts":[{"add":["0","const simpleIPV6Regex = \/\\[[0-9:a-zA-Z]*?\\]\/;","1","","3","    const openingBracketIndex = simpleIPV6Regex.exec(url);","4","    if (!openingBracketIndex) {","8","    if (queryIndex >= 0 && openingBracketIndex.index > queryIndex) {"],"delete":["1","    const openingBracketIndex = url.indexOf('[');","2","    if (openingBracketIndex < 0) {","6","    if (queryIndex >= 0 && openingBracketIndex > queryIndex) {"]}],"tests\/inject\/utils\/url.tests.ts":[{"add":["2","import {isIPV6} from '..\/..\/..\/src\/utils\/ipv6';","253","    expect(isIPV6('file:\/\/\/C:\/[\/test.html')).toEqual(false);","254","    expect(isIPV6('file:\/\/\/C:\/[\/test.html]')).toEqual(false);","255","    expect(isIPV6('[2001:4860:4860::8844]')).toEqual(true);"],"delete":[]}]}},"a2f4a644f9fea4a85fe940e9d43ddb46af89a56a":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["7863","iron-input.paper-input > input.paper-input,","7864",".input-content.paper-input-container > label, ","7865",".input-content.paper-input-container > .paper-input-label {","7866","    color: var(--paper-input-container-shared-input-style_-_color) !important;","7867","}"],"delete":[]}]}},"d37c078b3746b1e749cd9846c39c6fd5b23f509a":{"changes":{"src\/utils\/time.ts":"MODIFY"},"diff":{"src\/utils\/time.ts":[{"add":["58","        date.setSeconds(0);","67","        date.setSeconds(0);"],"delete":[]}]}},"1e5033705840e205f4de6121b5c2f02590cd06a2":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["4097","sony.*","4098","","4099","IGNORE INLINE STYLE","4100",".brand-logo-svg > g","4101","","4102","================================","4103",""],"delete":[]}]}},"69239a955b7ff8ba0cb7272d55201dba2a50e16c":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":[],"delete":["338",".gb_cf"]}]}},"bc90f1c46f7e76b01900c678a53c9649e3e7b29b":{"changes":{"src\/background\/extension.ts":"MODIFY"},"diff":{"src\/background\/extension.ts":[{"add":["11","import {isURLInList, getURLHostOrProtocol, isURLEnabled, isPDF} from '..\/utils\/url';","150","        chrome.commands.onCommand.addListener(async (command) => {","160","                const url = await this.tabs.getActiveTabURL();","161","                if (isPDF(url)) {","162","                    this.changeSettings({enableForPDF: !this.user.settings.enableForPDF});","163","                } else {","164","                    this.toggleURL(url);","165","                }"],"delete":["11","import {isURLInList, getURLHostOrProtocol, isURLEnabled} from '..\/utils\/url';","150","        chrome.commands.onCommand.addListener((command) => {","160","                this.toggleCurrentSite();"]}]}},"f50d5d585a35cb228e821b3398ab93b971d9a15b":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["705","chilkatsoft.com","706","","707","CSS","708","body {","709","    background-image: none !important;","710","    background-color: var(--darkreader-neutral-background) !important;   ","711","}","712","","713","================================","714",""],"delete":[]}]}},"a88980d1385bd897a15498f1059b38a01daf17f0":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["778","INVERT","779",".bclogo.white","780",""],"delete":[]}]}},"83a8ba340251d7d09f8da8762f08dc6e4e71e8e9":{"changes":{"src\/background\/utils\/tab.ts":"ADD","src\/background\/tab-manager.ts":"MODIFY","src\/background\/make-chromium-happy.ts":"MODIFY"},"diff":{"src\/background\/utils\/tab.ts":[{"add":[],"delete":[]}],"src\/background\/tab-manager.ts":[{"add":["9","import {isPanel} from '.\/utils\/tab';","80","                    if (isPanel(sender)) {"],"delete":["79","                    \/\/ Workaround for Thunderbird and Vivaldi.","80","                    \/\/ On Thunderbird, sometimes sender.tab is undefined but accessing it will throw a very nice error.","81","                    \/\/ On Vivaldi, sometimes sender.tab is undefined as well, but error is not very helpful.","82","                    \/\/ On Opera, sender.tab.index === -1.","83","                    const isPanel = typeof sender === 'undefined' || typeof sender.tab === 'undefined' || (isOpera && sender.tab.index === -1);","84","                    if (isPanel) {"]}],"src\/background\/make-chromium-happy.ts":[{"add":["3","import {isPanel} from '.\/utils\/tab';","14","    chrome.runtime.onMessage.addListener((message: Message, sender, sendResponse) => {","21","        ].includes(message.type) &&","22","            (message.type !== MessageType.CS_FRAME_CONNECT || !isPanel(sender))) {"],"delete":["13","    chrome.runtime.onMessage.addListener((message: Message, _, sendResponse) => {","20","        ].includes(message.type)) {"]}]}},"597e93ac552995ffc972ccbb101f84b5ec90dda7":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["3186","CSS","3187","[class^=question-picker-detail] {","3188","    background: none !important;","3189","}","3190",""],"delete":[]}]}},"d2adc6c3e7a81b60356f7a987f1d010afc85345e":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["1217","IGNORE INLINE STYLE","1218",".ak-editor-panel","1219",".ak-editor-panel *","1220",""],"delete":[]}]}},"1996c12dc22ec14e28d2db9bc2f2b3718bc6ac25":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":[],"delete":["17581","#backgroundFrontLayer.tp-yt-app-header {","17582","    background-image: var(--app-header-background-front-layer_-_background-image) !important;","17583","}"]}]}},"becf4fe145c6fb593aa9f48392e9ab8c249c9aa6":{"changes":{"src\/inject\/dynamic-theme\/css-rules.ts":"MODIFY"},"diff":{"src\/inject\/dynamic-theme\/css-rules.ts":[{"add":["6","            if (rule instanceof CSSMediaRule && Array.from(rule.media).includes('screen')) {","7","                iterateCSSRules(rule.cssRules, iterate);","12","                    iterateCSSRules(rule.styleSheet.cssRules, iterate);","33","export const cssImportRegex = \/@import (url\\()?(('.+?')|(\".+?\")|([^\\)]*?))\\)?;?\/g;"],"delete":["6","            if (rule instanceof CSSMediaRule) {","7","                Array.from(rule.cssRules).forEach((mediaRule) => iterate(mediaRule as CSSStyleRule));","12","                    Array.from(rule.styleSheet.cssRules).forEach((importedRule) => iterate(importedRule as CSSStyleRule));","33","export const cssImportRegex = \/@import url\\((('.+?')|(\".+?\")|([^\\)]*?))\\);?\/g;"]}]}},"33285f275ebd129b23e32457cf619956b1c787e4":{"changes":{"src\/inject\/dynamic-theme\/style-manager.ts":"MODIFY","tests\/inject\/dynamic\/style-override.tests.ts":"MODIFY"},"diff":{"src\/inject\/dynamic-theme\/style-manager.ts":[{"add":["96","    let isOverrideEmpty = true;","297","            isOverrideEmpty = syncStyle.sheet.cssRules.length === 0;","451","        if (!isOverrideEmpty) {"],"delete":["446","        const shouldForceRender = syncStyle.sheet == null || syncStyle.sheet.cssRules.length > 0;","450","        if (shouldForceRender) {"]}],"tests\/inject\/dynamic\/style-override.tests.ts":[{"add":["109","        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(141, 141, 141)');","110","        expect(getComputedStyle(container.querySelector('h1 strong')).color).toBe('rgb(255, 26, 26)');","122","        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(102, 102, 102)');","123","        expect(getComputedStyle(container.querySelector('h1 strong')).color).toBe('rgb(255, 26, 26)');","124","","129","        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(102, 102, 102)');","130","        expect(getComputedStyle(container.querySelector('h1 strong')).color).toBe('rgb(255, 26, 26)');","146","        expect(sibling.isConnected).toBe(false);","147","        expect(document.querySelector('.darkreader--sync')).toBe(null);","148","        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(255, 255, 255)');","149","        expect(getComputedStyle(container.querySelector('h1 strong')).color).toBe('rgb(255, 255, 255)');","159","","163","        style.sheet.insertRule('body { background-color: pink }');","165","        expect((style.nextSibling as HTMLStyleElement).sheet.cssRules[0].cssText).toBe('body { background-color: rgb(50, 0, 9); }');","166","        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(141, 141, 141)');","167","        expect(getComputedStyle(container.querySelector('h1 strong')).color).toBe('rgb(255, 26, 26)');","168","        expect(getComputedStyle(document.body).backgroundColor).toBe('rgb(50, 0, 9)');","201","        const nextSibling = newStyle.nextSibling as HTMLStyleElement;","202","        expect(nextSibling.sheet.cssRules.length).toBe(2);","203","        expect(nextSibling.classList.contains('darkreader--sync')).toBe(true);","204","        expect(getComputedStyle(document.querySelector('h1')).color).toBe('rgb(255, 198, 208)');","205","        expect(getComputedStyle(document.querySelector('h1 strong')).color).toBe('rgb(255, 174, 26)');","208","    it('should restore override after container move', async () => {","209","        container.innerHTML = multiline(","210","            '<div class=\"style-container\">',","211","            '    <style class=\"testcase-style\">',","212","            '        h1 { background: gray; }',","213","            '        h1 { color: green; }',","214","            '    <\/style>',","215","            '<\/div>',","216","            '<h1>Moving container<\/h1>',","217","        );","218","        createOrUpdateDynamicTheme(theme, null, false);","219","        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(102, 102, 102)');","220","        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(140, 255, 140)');","221","","222","        const styleContainer = document.querySelector('.style-container');","223","        const style = styleContainer.querySelector('.testcase-style');","224","        const override = style.nextElementSibling as HTMLStyleElement;","225","        container.append(styleContainer);","226","        await timeout(0);","227","        expect(style.nextElementSibling).toBe(override);","228","        expect(override.sheet.cssRules.length).toBe(2);","229","        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(102, 102, 102)');","230","        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(140, 255, 140)');","231","    });","232","","233","    \/\/ What is this test for?","242","    \/\/ What is this test for?"],"delete":["109","","123","","141","        expect(sibling.isConnected && !((sibling as HTMLStyleElement).classList.contains('darkreader--sync'))).toBe(false);","154","","155","        (style as HTMLStyleElement).sheet.insertRule('html { background-color: pink }');","157","        expect((style.nextSibling as HTMLStyleElement).sheet.cssRules[0].cssText).toBe('html { background-color: rgb(50, 0, 9); }');","158","","191","        expect((newStyle.nextSibling as HTMLStyleElement).sheet.cssRules.length === 2 &&","192","            (newStyle.nextSibling as HTMLStyleElement).classList.contains('darkreader--sync'))","193","            .toBe(true);","216",""]}]}},"a3fc901a158d6f0d9a6f8269611c0e13e25f13fb":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["9275","img[alt=\"Aksara Sunda.png\"]","9276","img[alt=\"Aksara kawi name.png\"]"],"delete":[]}]}},"129e874f7ad9a9e7d31d0c29b5fd6aed25238ce6":{"changes":{"src\/utils\/platform.ts":"MODIFY"},"diff":{"src\/utils\/platform.ts":[{"add":["60","    return el.style && el.style.colorScheme === 'dark';"],"delete":["60","    return el.style.colorScheme === 'dark';"]}]}},"00a81796aa98e3ab5d24f8c52b29b55960e85d01":{"changes":{"src\/inject\/dynamic-theme\/modify-css.ts":"MODIFY","src\/inject\/dynamic-theme\/css-rules.ts":"MODIFY"},"diff":{"src\/inject\/dynamic-theme\/modify-css.ts":[{"add":["163","const gradientRegex = \/[\\-a-z]+gradient\\(([^\\(\\)]*(\\(([^\\(\\)]*(\\(.*?\\)))*[^\\(\\)]*\\)))*[^\\(\\)]*\\)\/g;","194","            const partsRegex = \/([^\\(\\),]+(\\([^\\(\\)]*(\\([^\\(\\)]*\\)*[^\\(\\)]*)?\\))?[^\\(\\),]*),?\/g;","195","            const colorStopRegex = \/^(from|color-stop|to)\\(([^\\(\\)]*?,\\s*)?(.*?)\\)$\/;","198","                part = part.trim();","199","","204","","210","","211","                const colorStopMatch = part.match(colorStopRegex);","212","                if (colorStopMatch) {","213","                    rgb = tryParseColor(colorStopMatch[3]);","214","                    if (rgb) {","215","                        return (filter: FilterConfig) => `${colorStopMatch[1]}(${colorStopMatch[2] ? `${colorStopMatch[2]}, ` : ''}${modifyGradientColor(rgb, filter)})`;","216","                    }","217","                }","218",""],"delete":["163","const gradientRegex = \/[\\-a-z]+gradient\\(([^\\(\\)]*(\\(.*?\\)))*[^\\(\\)]*\\)\/g;","194","            const partsRegex = \/([^\\(\\),]+(\\([^\\(\\)]*\\))?[^\\(\\),]*),?\/g;"]}],"src\/inject\/dynamic-theme\/css-rules.ts":[{"add":["6","            if (rule instanceof CSSMediaRule) {","7","                if (Array.from(rule.media).includes('screen')) {","8","                    iterateCSSRules(rule.cssRules, iterate);","9","                }"],"delete":["6","            if (rule instanceof CSSMediaRule && Array.from(rule.media).includes('screen')) {","7","                iterateCSSRules(rule.cssRules, iterate);"]}]}},"f8985a550914e1145b46c230dec2efa1425f6cf5":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["4770",".infobox > tbody > tr > td[style*=\"background-color\"]"],"delete":[]}]}},"c9897479e2791ddf0e35c3a37859ea38aed843f9":{"changes":{"src\/config\/inversion-fixes.config":"MODIFY"},"diff":{"src\/config\/inversion-fixes.config":[{"add":["2483","youtube.com\/embed","2487","div[style*=\"https:\/\/i.ytimg.com\"]"],"delete":[]}]}},"8ebdb220bdaee709e18a9b2a1e525caf69e10480":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["7664","tv.yandex.*","7665","","7666","INVERT","7667",".icon_location::after","7668",".icon_location::before","7669",".button_arrow_down::after","7670","","7671","IGNORE IMAGE ANALYSIS","7672",".icon_location::after","7673",".icon_location::before","7674",".button_arrow_down::after","7675","","7676","================================","7677",""],"delete":[]}]}},"c57a3217fd90ee136487b134456dc936ad332962":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":[],"delete":["4021","","4022","INVERT","4023",".global-footer__logo","4024","","4025","CSS","4026",".brand-link.pull-left {","4027","    filter: invert(1) hue-rotate(170deg) brightness(4);","4028","}","4029","","4030","================================","4031","","4032","nvidia.com"]}]}},"9b24e3d0c4e1d4eb1c7cf94c5a149fab3afb5aa4":{"changes":{"src\/inject\/utils\/dom.ts":"MODIFY","src\/inject\/dynamic-theme\/index.ts":"MODIFY","src\/inject\/dynamic-theme\/style-manager.ts":"MODIFY","src\/inject\/dynamic-theme\/watch.ts":"MODIFY"},"diff":{"src\/inject\/utils\/dom.ts":[{"add":["66","export function watchForNodePosition<T extends Node>(node: T, onRestore?: () => void) {","89","        onRestore && onRestore();"],"delete":["66","export function watchForNodePosition<T extends Node>(node: T) {"]}],"src\/inject\/dynamic-theme\/index.ts":[{"add":["240","        const createdStyles = new Set(created);","241","        const movedStyles = new Set(removed.filter((style) => createdStyles.has(style)));","242","        removed","243","            .filter((style) => !movedStyles.has(style))","244","            .forEach((style) => removeManager(style));"],"delete":["240","        removed.forEach((style) => removeManager(style));"]}],"src\/inject\/dynamic-theme\/style-manager.ts":[{"add":["353","            syncStylePositionWatcher = syncStylePositionWatcher || watchForNodePosition(syncStyle, buildStyleSheet);"],"delete":["353","            syncStylePositionWatcher = watchForNodePosition(syncStyle);"]}],"src\/inject\/dynamic-theme\/watch.ts":[{"add":["45","        const createdStyles = mutations.reduce((nodes, m) => nodes.concat(getAllManageableStyles(m.addedNodes)), []);"],"delete":["45","        const createdStylesSet = new Set(mutations.reduce((nodes, m) => nodes.concat(getAllManageableStyles(m.addedNodes)), []));","54","        for (let i = removedStyles.length - 1; i >= 0; i--) {","55","            if (createdStylesSet.has(removedStyles[i])) {","56","                createdStylesSet.delete(removedStyles[i]);","57","                removedStyles.splice(i, 1);","58","            }","59","        }","60","        const createdStyles = Array.from(createdStylesSet);","61",""]}]}},"cd16bfd8e7f13e8dac1d3202219e521200670772":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["3981","ros.org","3982","","3983","CSS","3984",".bg-ros-dots-grid {","3985","    background-image: none !important;","3986","}","3987","","3988","================================","3989",""],"delete":[]}]}},"da755551f9d379943c9ecd13c25d4e7e84f22734":{"changes":{"src\/utils\/mutex.ts":"ADD","src\/background\/utils\/extension-api.ts":"MODIFY"},"diff":{"src\/utils\/mutex.ts":[{"add":[],"delete":[]}],"src\/background\/utils\/extension-api.ts":[{"add":["2","import {Mutex} from '..\/..\/utils\/mutex';","40","const mutexStorageWriting = new Mutex();","69","    return new Promise<void>(async (resolve, reject) => {","70","        await mutexStorageWriting.lock();","74","                mutexStorageWriting.unlock();","78","            setTimeout(() => mutexStorageWriting.unlock(), 500);","84","    return new Promise<void>(async (resolve) => {","85","        await mutexStorageWriting.lock();","88","            setTimeout(() => mutexStorageWriting.unlock(), 500);","95","        if (!mutexStorageWriting.isLocked()) {"],"delete":["39","let isWriting = false;","68","    return new Promise<void>((resolve, reject) => {","69","        isWriting = true;","76","            setTimeout(() => isWriting = false);","82","    return new Promise<void>((resolve) => {","83","        isWriting = true;","86","            setTimeout(() => isWriting = false);","93","        if (!isWriting) {"]}]}},"381025bd7bc2537bd9424270dbff5207c8ccfb24":{"changes":{"src\/background\/utils\/extension-api.ts":"MODIFY"},"diff":{"src\/background\/utils\/extension-api.ts":[{"add":["52","                \/\/ Just to be sure: https:\/\/github.com\/darkreader\/darkreader\/issues\/7270","53","                \/\/ The value of sync[key] shouldn't be null.","54","                if (!sync[key]) {","55","                    continue;","56","                }"],"delete":[]}]}},"06514e2954cdf92d875fcf188d0399cf25943e40":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["2582","electrical4u.com","2583","","2584","INVERT","2585","img[src*=\"equation\"]","2586","","2587","================================","2588",""],"delete":[]}]}},"05f90f5dfcfb5eb44aa5af79d1bc51388dd02e11":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["9532",".md-spoiler-text:not([data-revealed])::selection {","9533","    color: transparent !important;","9534","    background-color: var(--darkreader-bg--newCommunityTheme-metaText) !important;","9535","}"],"delete":[]}]}},"802aeca988b1cdd0076001e76d56103924ef896d":{"changes":{"src\/definitions.d.ts":"MODIFY","src\/generators\/dynamic-theme.ts":"MODIFY","src\/inject\/dynamic-theme\/modify-css.ts":"MODIFY","src\/inject\/dynamic-theme\/index.ts":"MODIFY","src\/config\/dynamic-theme-fixes.config":"MODIFY","src\/generators\/modify-colors.ts":"MODIFY","README.md":"MODIFY","tests\/config.tests.ts":"MODIFY"},"diff":{"src\/definitions.d.ts":[{"add":["88","    invert: string[];","89","    css: string;"],"delete":["88","    invert?: string[];"]}],"src\/generators\/dynamic-theme.ts":[{"add":["8","    'CSS': 'css',","15","        parseCommandValue: (command, value) => {","16","            if (command === 'CSS') {","17","                return value.trim();","18","            }","19","            return parseArray(value);","20","        },","30","        formatPropValue: (prop, value) => {","31","            if (prop === 'css') {","32","                return value.trim();","33","            }","34","            return formatArray(value).trim();","35","        },","36","        shouldIgnoreProp: (prop, value) => {","37","            if (prop === 'css') {","38","                return !value;","39","            }","40","            return !(Array.isArray(value) && value.length > 0);","41","        },","46","    if (fixes.length === 0 || fixes[0].url[0] !== '*') {","47","        return null;","48","    }","49","","50","    const common = {","51","        url: fixes[0].url,","52","        invert: fixes[0].invert || [],","53","        css: fixes[0].css || [],","54","    };","55","","57","        .slice(1)","68","        return common;","71","    const match = sortedBySpecificity[0].theme;","72","","73","    return {","74","        url: match.url,","75","        invert: common.invert.concat(match.invert || []),","76","        css: [common.css, match.css].filter((s) => s).join('\\n'),","77","    };"],"delete":["14","        parseCommandValue: (command, value) => parseArray(value),","24","        formatPropValue: (prop, value) => formatArray(value).trim(),","25","        shouldIgnoreProp: (prop, value) => !(Array.isArray(value) && value.length > 0),","41","        return null;","44","    return sortedBySpecificity[0].theme;"]}],"src\/inject\/dynamic-theme\/modify-css.ts":[{"add":["131","export function parseColorWithCache($color: string) {"],"delete":["121","\/\/ TODO: Move CSS fixes to config.","122","const commonOverride = (theme: FilterConfig) => {","123","    return [","124","        `.jfk-bubble { background-color: ${modifyBackgroundColor({r: 255, g: 255, b: 255}, theme)} !important; }`,","125","    ].join('\\n');","126","};","127","const websiteOverride: {[host: string]: (string | ((theme: FilterConfig) => string))} = {","128","    'arstechnica.com': (theme) => theme.mode === 1 ? [","129","        '.listing, .video-thumbnail { background-blend-mode: initial !important; }',","130","        '.article-single figure img { mix-blend-mode: initial !important; }',","131","    ].join('\\n') : '',","132","    'www.ebay.co.uk': 'html, body { background-image: none !important; }',","133","    'www.ebay.com': 'html, body { background-image: none !important; }',","134","    'www.ebay.de': 'html, body { background-image: none !important; }',","135","    'www.youtube.com': (theme) => `#textarea { color: ${modifyForegroundColor({r: 0, g: 0, b: 0}, theme)} !important; }`,","136","};","137","","138","export function getSiteOverride(host: string, theme: FilterConfig) {","139","    const common = commonOverride(theme);","140","    let special = '';","141","    if (websiteOverride.hasOwnProperty(host)) {","142","        const override = websiteOverride[host];","143","        if (typeof override === 'function') {","144","            special = override(theme);","145","        } else {","146","            special = override;","147","        }","148","    }","149","    return `${common}${special ? `\\n${special}` : ''}`;","150","}","151","","162","function parseColorWithCache($color: string) {"]}],"src\/inject\/dynamic-theme\/index.ts":[{"add":["2","import {getModifiedUserAgentStyle, getModifiedFallbackStyle, cleanModificationCache, parseColorWithCache} from '.\/modify-css';","6","import {logWarn} from '..\/utils\/log';","11","import {modifyColor} from '..\/..\/generators\/modify-colors';","87","    overrideStyle.textContent = fixes && fixes.css ? replaceCSSTemplates(fixes.css) : '';","91","function replaceCSSTemplates($cssText: string) {","92","    return $cssText.replace(\/\\${(.+?)}\/g, (m0, $color) => {","93","        try {","94","            const color = parseColorWithCache($color);","95","            return modifyColor(color, filter);","96","        } catch (err) {","97","            logWarn(err);","98","            return $color;","99","        }","100","    });","101","}","102",""],"delete":["2","import {getModifiedUserAgentStyle, getModifiedFallbackStyle, getSiteOverride, cleanModificationCache} from '.\/modify-css';","85","    overrideStyle.textContent = getSiteOverride(location.host, filter);"]}],"src\/config\/dynamic-theme-fixes.config":[{"add":["0","*","1","","2","CSS","3",".jfk-bubble {","4","    background-color: ${white} !important;","5","}","6","","7","================================","8","","9","arstechnica.com","10","","11","CSS","12",".listing, .video-thumbnail {","13","    background-blend-mode: initial !important;","14","}","15",".article-single figure img {","16","    mix-blend-mode: initial !important;","17","}","18","","19","================================","20","","442","www.ebay.*","443","www.ebay.*.*","444","","445","CSS","446","html, body {","447","    background-image: none !important;","448","}","449","","450","================================","451","","461","CSS","462",".RNNXgb {","463","    box-shadow: 0 0 2px 0 ${rgba(0,0,0,0.16)}, 0 0 0 1px ${rgba(0,0,0,0.08)} !important;","464","}","465","","479","CSS","480","#textarea, paper-button {","481","    color: ${black} !important;","482","}","483",""],"delete":[]}],"src\/generators\/modify-colors.ts":[{"add":["30","    const matrix = createFilterMatrix(filter)","41","function noopHSL(hsl: HSLA) {","42","    return hsl;","43","}","44","","45","export function modifyColor(rgb: RGBA, theme: FilterConfig) {","46","    return modifyColorWithCache(rgb, theme, noopHSL);","47","}","48","","107","    return modifyColorWithCache(rgb, {...filter, mode: 0}, modifyBgHSL);","151","    return modifyColorWithCache(rgb, {...filter, mode: 0}, modifyFgHSL);","171","    return modifyColorWithCache(rgb, {...filter, mode: 0}, modifyBorderHSL);"],"delete":["30","    const matrix = createFilterMatrix({...filter, mode: 0})","99","    return modifyColorWithCache(rgb, filter, modifyBgHSL);","143","    return modifyColorWithCache(rgb, filter, modifyFgHSL);","163","    return modifyColorWithCache(rgb, filter, modifyBorderHSL);"]}],"README.md":[{"add":["0","# Dark Reader for Google Chrome and Mozilla Firefox","30","Please note, that merged changes to these files are automatically delivered to all users **within 15 minutes**.","34","Dev Tools should be used to **fix minor issues** on a web page","35","*(like dark icon on dark background, removing bright background, adding white background to transparent image etc.)*.","36","If page looks partially dark and bright in **Dynamic mode**, it should be considered as a bug.","37","For **Filter mode** it is a common practice to invert already dark page parts.","38","","47","dynamic-theme-fixes.config","55","CSS","56",".wrong-element-colors {","57","    background-color: ${white} !important;","58","    color: ${black} !important;","59","}","60","","62","- `INVERT` rule inverts specified elements.","63","For **Dynamic mode** use `INVERT` only for dark images, that are invisible on dark backgrounds (icons, diagrams, charts, `<img>` and `<svg>` elements).","64","- `CSS` rule adds custom CSS to a web page.","65","`!important` keyword should be specified for each CSS property to prevent overrides by other stylesheets.","66","**Dynamic mode** supports `${COLOR}` template, where `COLOR` is a color value before the inversion (`white` will become `black` in dark mode).","67","- **Special notice for Filter and Filter+ config**.","68","It works by inverting the whole web page and reverting necessary parts (images, videos etc.) back, listed in `INVERT` section.","69","If inverted element contains images or other content that becomes wrongly displayed, `NO INVERT` rule can be used.","70","`REMOVE BG` removes background image from element and forces black background.","72","inversion-fixes.config","137","## Building for use","138","You can install the extension from a file.","139","Install [Node.js LTS](https:\/\/nodejs.org\/en\/). Download the source code (or checkout from git).","140","Open terminal in root folder and run:","141","- `npm install`","142","- `npm run release`","143","","144","This will generate `build.zip` for use in Chromium browsers and `build-firefox.xpi` for use in Firefox.","145",""],"delete":["0","Dark Reader for Google Chrome and Mozilla Firefox","1","================","31","Notice that merged changes to these files are automatically delivered to all users **within 15 minutes**.","51","- *WARNING:* For **Dynamic Theme mode** use `INVERT` only for dark images, that are invisible on dark backgrounds (icons, diagrams, charts, `<img>` and `<svg>` elements).","52","Image analysis will be improved in future and this rule should become unnecessary.","53","- **For Filter and Filter+ config** it is also possible to specify custom CSS rules. If chosen element contains images or other content that becomes wrongly displayed, `NO INVERT` rule can be used. `REMOVE BG` removes background image from element.","54","*IMPORTANT: When Dark mode is on, the whole page (root `<html>` element) is inverted by filter. To revert the images, videos etc. `INVERT` selectors are used, so the inversion will be applied to these elements twice. If inverted elements contain other elements that match the `INVERT` selectors, then these elements will be inverted 3 or more times. To prevent it `NO INVERT` selectors are used.*"]}],"tests\/config.tests.ts":[{"add":["54","    \/\/ there is a common fix","55","    expect(fixes[0].url[0]).toEqual('*');","56","","77","        'CSS', '.x { color: white !important; }',","84","        {url: ['inbox.google.com', 'mail.google.com'], invert: ['a', 'b'], css: '.x { color: white !important; }'},"],"delete":["80","        {url: ['inbox.google.com', 'mail.google.com'], invert: ['a', 'b']},"]}]}},"910d97a6fb51724334845ddbdfcf0a3e650615e3":{"changes":{"src\/inject\/dynamic-theme\/modify-css.ts":"MODIFY","CHANGELOG.md":"MODIFY"},"diff":{"src\/inject\/dynamic-theme\/modify-css.ts":[{"add":["255","            (rule.style.webkitMaskImage && rule.style.webkitMaskImage !== 'none') ||","256","            (rule.style.webkitMask && rule.style.webkitMask !== 'none') ||","257","            (rule.style.mask && rule.style.mask !== 'none') ||","258","            (rule.style.getPropertyValue('mask-image') && rule.style.getPropertyValue('mask-image') !== 'none')"],"delete":["255","            rule.style.webkitMaskImage ||","256","            rule.style.webkitMask ||","257","            rule.style.mask ||","258","            rule.style.getPropertyValue('mask-image')"]}],"CHANGELOG.md":[{"add":["4","- Fix incorrect inline background colors when `mask` is explicitly disabled."],"delete":[]}]}},"bc7567415c6bb87230020efda7183f4676f74ae7":{"changes":{"src\/background\/extension.ts":"MODIFY","src\/generators\/dynamic-theme.ts":"MODIFY","src\/config\/inversion-fixes.config":"MODIFY","src\/generators\/svg-filter.ts":"MODIFY","src\/background\/tab-manager.ts":"MODIFY","src\/ui\/popup\/components\/site-toggle\/index.tsx":"MODIFY","src\/generators\/css-filter.ts":"MODIFY","src\/generators\/static-theme.ts":"MODIFY","src\/manifest.json":"MODIFY","src\/utils\/url.ts":"MODIFY"},"diff":{"src\/background\/extension.ts":[{"add":["10","import {isURLInList, getURLHost} from '..\/utils\/url';","49","            getConnectionMessage: (url, frameURL) => {","51","                    return this.enabled && this.getTabMessage(url, frameURL);","55","                            resolve(this.enabled && this.getTabMessage(url, frameURL));","214","        const host = getURLHost(url);","256","    private getTabMessage = (url: string, frameURL: string) => {","258","        const isUrlInDarkList = isURLInList(url, DARK_SITES);","259","        const isUrlInUserList = isURLInList(url, this.filterConfig.siteList);","270","                        data: createCSSFilterStylesheet(this.filterConfig, url, frameURL, this.config.INVERSION_FIXES),","277","                            data: createSVGFilterStylesheet(this.filterConfig, url, frameURL, this.config.INVERSION_FIXES),","283","                            css: createSVGFilterStylesheet(this.filterConfig, url, frameURL, this.config.INVERSION_FIXES),","292","                        data: createStaticStylesheet(this.filterConfig, url, frameURL, this.config.STATIC_THEMES),","297","                    const fixes = getDynamicThemeFixesFor(url, frameURL, this.config.DYNAMIC_THEME_FIXES);"],"delete":["10","import {isUrlInList, getUrlHost} from '..\/utils\/url';","49","            getConnectionMessage: (url) => {","51","                    return this.enabled && this.getTabMessage(url);","55","                            resolve(this.enabled && this.getTabMessage(url));","214","        const host = getUrlHost(url);","256","    private getTabMessage = (url: string) => {","258","        const isUrlInDarkList = isUrlInList(url, DARK_SITES);","259","        const isUrlInUserList = isUrlInList(url, this.filterConfig.siteList);","270","                        data: createCSSFilterStylesheet(this.filterConfig, url, this.config.INVERSION_FIXES),","277","                            data: createSVGFilterStylesheet(this.filterConfig, url, this.config.INVERSION_FIXES),","283","                            css: createSVGFilterStylesheet(this.filterConfig, url, this.config.INVERSION_FIXES),","292","                        data: createStaticStylesheet(this.filterConfig, url, this.config.STATIC_THEMES),","297","                    const fixes = getDynamicThemeFixesFor(url, this.config.DYNAMIC_THEME_FIXES);"]}],"src\/generators\/dynamic-theme.ts":[{"add":["3","import {compareURLPatterns, isURLInList} from '..\/utils\/url';","29","export function getDynamicThemeFixesFor(url: string, frameURL: string, fixes: DynamicThemeFix[]) {","33","                specificity: isURLInList(frameURL || url, theme.url) ? theme.url[0].length : 0,"],"delete":["3","import {compareURLPatterns, isUrlInList} from '..\/utils\/url';","29","export function getDynamicThemeFixesFor(url: string, fixes: DynamicThemeFix[]) {","33","                specificity: isUrlInList(url, theme.url) ? theme.url[0].length : 0,"]}],"src\/config\/inversion-fixes.config":[{"add":["226","disqus.com\/embed\/","227","","228","INVERT","229","body.dark","230","","231","NO INVERT","232","body.dark *","233","","234","================================","235",""],"delete":["7","iframe","24","REMOVE BG","25","iframe:not([title=\"Disqus\"]):not([src*=\"ihlenndgcmojhcghmfjfneahoeklbjjh\"])","26","","27","CSS","28","#disqus_thread > :first-child {","29","    background: black !important;","30","}","31","","79",".ap-iframe-container","333","evernote.com","334","","335","NO INVERT","336","iframe","337","","338","================================","339","","574","iframe","913","mp.weixin.qq.com\/wiki","914","","915","NO INVERT","916",".res_iframe","917","","918","================================","919","","1343","sharepoint.com","1344","","1345","NO INVERT","1346","iframe","1347","","1348","================================","1349","","1391","iframe","1604","velocimetro.virtua.com.br","1605","","1606","NO INVERT","1607","iframe","1608","","1609","================================","1610","","1852","","1853","================================","1854","","1855","zendesk.com","1856","","1857","NO INVERT","1858","iframe"]}],"src\/generators\/svg-filter.ts":[{"add":["5","export function createSVGFilterStylesheet(config: FilterConfig, url: string, frameURL: string, inversionFixes: InversionFix[]) {","16","    return cssFilterStyleheetTemplate(filterValue, reverseFilterValue, config, url, frameURL, inversionFixes);"],"delete":["5","export function createSVGFilterStylesheet(config: FilterConfig, url: string, inversionFixes: InversionFix[]) {","16","    return cssFilterStyleheetTemplate(filterValue, reverseFilterValue, config, url, inversionFixes);"]}],"src\/background\/tab-manager.ts":[{"add":["0","import {isURLInList} from '..\/utils\/url';","12","    getConnectionMessage: (url: string, frameUrl: string) => any;","13","}","14","","15","interface PortInfo {","16","    url: string;","17","    port: chrome.runtime.Port;","21","    private ports: Map<number, Map<number, PortInfo>>;","28","                const frameId = port.sender.frameId;","29","                const url = port.sender.url;","30","                let framesPorts: Map<number, PortInfo>;","31","                if (this.ports.has(tabId)) {","32","                    framesPorts = this.ports.get(tabId);","33","                } else {","34","                    framesPorts = new Map();","35","                    this.ports.set(tabId, framesPorts);","36","                }","37","                framesPorts.set(frameId, {url, port});","38","                port.onDisconnect.addListener(() => {","39","                    framesPorts.delete(frameId);","40","                    if (framesPorts.size === 0) {","41","                        this.ports.delete(tabId);","42","                    }","43","                });","45","                const message = getConnectionMessage(port.sender.tab.url, frameId === 0 ? null : url);","94","                allFrames: true,","98","    async sendMessage(getMessage: (url: string, frameUrl: string) => any) {","102","                const framesPorts = this.ports.get(tab.id);","103","                framesPorts.forEach(({url, port}, frameId) => {","104","                    const message = getMessage(tab.url, frameId === 0 ? null : url);","105","                    if (tab.active) {","106","                        port.postMessage(message);","107","                    } else {","108","                        setTimeout(() => port.postMessage(message));","109","                    }","110","                });","124","            isInDarkList: isURLInList(url, DARK_SITES),"],"delete":["0","import {isUrlInList} from '..\/utils\/url';","12","    getConnectionMessage: (url?: string) => any;","16","    private ports: Map<number, chrome.runtime.Port>;","23","                this.ports.set(tabId, port);","24","                port.onDisconnect.addListener(() => this.ports.delete(tabId));","26","                const message = getConnectionMessage(port.sender.tab.url);","78","    async sendMessage(getMessage: (url?: string) => any) {","82","                const message = getMessage(tab.url);","83","                const port = this.ports.get(tab.id);","84","                if (tab.active) {","85","                    port.postMessage(message);","86","                } else {","87","                    setTimeout(() => port.postMessage(message));","88","                }","102","            isInDarkList: isUrlInList(url, DARK_SITES),"]}],"src\/ui\/popup\/components\/site-toggle\/index.tsx":[{"add":["2","import {getURLHost} from '..\/..\/..\/..\/utils\/url';","12","    const host = getURLHost(tab.url || '');"],"delete":["2","import {getUrlHost} from '..\/..\/..\/..\/utils\/url';","12","    const host = getUrlHost(tab.url || '');"]}],"src\/generators\/css-filter.ts":[{"add":["4","import {compareURLPatterns, isURLInList} from '..\/utils\/url';","13","export default function createCSSFilterStyleheet(config: FilterConfig, url: string, frameURL: string, inversionFixes: InversionFix[]) {","16","    return cssFilterStyleheetTemplate(filterValue, reverseFilterValue, config, url, frameURL, inversionFixes);","19","export function cssFilterStyleheetTemplate(filterValue: string, reverseFilterValue: string, config: FilterConfig, url: string, frameURL: string, inversionFixes: InversionFix[]) {","20","    const fix = getInversionFixesFor(frameURL || url, inversionFixes);","27","    if (filterValue && !frameURL) {","64","    if (!frameURL) {","65","        const [r, g, b] = applyColorMatrix([255, 255, 255], createFilterMatrix(config));","66","        const bgColor = {","67","            r: Math.round(r),","68","            g: Math.round(g),","69","            b: Math.round(b),","70","            toString() {","71","                return `rgb(${this.r},${this.g},${this.b})`;","72","            },","73","        };","74","        lines.push('');","75","        lines.push('\/* Page background *\/');","76","        lines.push('html {');","77","        lines.push(`  background: ${bgColor} !important;`);","78","        lines.push('}');","79","    }","165","    const common = {","166","        url: inversionFixes[0].url,","167","        invert: inversionFixes[0].invert || [],","168","        noinvert: inversionFixes[0].noinvert || [],","169","        removebg: inversionFixes[0].removebg || [],","170","        css: inversionFixes[0].css || '',","171","    };","177","            .filter((s) => isURLInList(url, s.url))","184","                invert: common.invert.concat(found.invert || []),","185","                noinvert: common.noinvert.concat(found.noinvert || []),","186","                removebg: common.removebg.concat(found.removebg || []),","191","    return common;"],"delete":["4","import {compareURLPatterns, isUrlInList} from '..\/utils\/url';","13","export default function createCSSFilterStyleheet(config: FilterConfig, url: string, inversionFixes: InversionFix[]) {","16","    return cssFilterStyleheetTemplate(filterValue, reverseFilterValue, config, url, inversionFixes);","19","export function cssFilterStyleheetTemplate(filterValue: string, reverseFilterValue: string, config: FilterConfig, url: string, inversionFixes: InversionFix[]) {","20","    const fix = getInversionFixesFor(url, inversionFixes);","27","    if (filterValue) {","64","    const [r, g, b] = applyColorMatrix([255, 255, 255], createFilterMatrix(config));","65","    const bgColor = {","66","        r: Math.round(r),","67","        g: Math.round(g),","68","        b: Math.round(b),","69","        toString() {","70","            return `rgb(${this.r},${this.g},${this.b})`;","71","        },","72","    };","73","    lines.push('');","74","    lines.push('\/* Page background *\/');","75","    lines.push('html {');","76","    lines.push(`  background: ${bgColor} !important;`);","77","    lines.push('}');","163","    const common = inversionFixes[0];","169","            .filter((s) => isUrlInList(url, s.url))","176","                invert: (common.invert || []).concat(found.invert || []),","177","                noinvert: (common.noinvert || []).concat(found.noinvert || []),","178","                removebg: (common.removebg || []).concat(found.removebg || []),","183","    return {...common};"]}],"src\/generators\/static-theme.ts":[{"add":["0","import {isURLInList} from '..\/utils\/url';","60","export default function createStaticStylesheet(config: FilterConfig, url: string, frameURL: string, staticThemes: StaticTheme[]) {","68","    const siteTheme = getThemeFor(frameURL || url, staticThemes);","269","                specificity: isURLInList(url, theme.url) ? theme.url[0].length : 0,"],"delete":["0","import {isUrlInList} from '..\/utils\/url';","60","export default function createStaticStylesheet(config: FilterConfig, url: string, staticThemes: StaticTheme[]) {","68","    const siteTheme = getThemeFor(url, staticThemes);","269","                specificity: isUrlInList(url, theme.url) ? theme.url[0].length : 0,"]}],"src\/manifest.json":[{"add":["31","            \"run_at\": \"document_start\",","32","            \"all_frames\": true"],"delete":["31","            \"run_at\": \"document_start\""]}],"src\/utils\/url.ts":[{"add":["0","export function getURLHost(url: string) {","13","export function isURLInList(url: string, list: string[]) {","15","        if (isURLMatched(url, list[i])) {","28","export function isURLMatched(url: string, urlTemplate: string): boolean {"],"delete":["0","export function getUrlHost(url: string) {","13","export function isUrlInList(url: string, list: string[]) {","15","        if (isUrlMatched(url, list[i])) {","28","export function isUrlMatched(url: string, urlTemplate: string): boolean {"]}]}},"f03fe04bd2b4eac8329435603787ba51c185c8ab":{"changes":{"src\/inject\/dynamic-theme\/index.ts":"MODIFY"},"diff":{"src\/inject\/dynamic-theme\/index.ts":[{"add":["144","        const changedStyles = mutations","145","            .filter(({target}) => target && shouldManageStyle(target))","146","            .reduce((styles, {target}) => {","147","                styles.push(target as HTMLStyleElement | HTMLLinkElement);","148","                return styles;","149","            }, [] as (HTMLStyleElement | HTMLLinkElement)[]);","150","","151","        Array.from(new Set(changedStyles.concat(addedStyles)))","152","            .filter((el) => !styleManagers.has(el))","153","            .forEach((el) => createManager(el));","155","","156","        if (addedStyles.length + removedStyles.length + changedStyles.length > 0) {","160","    styleChangeObserver.observe(document.documentElement, {childList: true, subtree: true, attributes: true, attributeFilter: ['rel']});"],"delete":["143","        addedStyles.forEach((el) => createManager(el));","146","        if (","147","            (addedStyles.length + removedStyles.length > 0) ||","148","            mutations.some((m) => m.target && shouldManageStyle(m.target))","149","        ) {","153","    styleChangeObserver.observe(document.documentElement, {childList: true, subtree: true, characterData: true});"]}]}},"42fa3c1951792839d27b00ce20bbbdd50c6a5f2e":{"changes":{"src\/background\/user-storage.ts":"MODIFY"},"diff":{"src\/background\/user-storage.ts":[{"add":["21","            if (this.settings.syncSettings) {","22","                await this.loadSettings();","23","                onRemoteSettingsChange();","24","            }"],"delete":["21","            await this.loadSettings();","22","            onRemoteSettingsChange();"]}]}},"e7218a3c343b64385005ccb0d3d180af1452c8c1":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["3521","projectstream.it","3522","","3523","CSS","3524","body {","3525","    background: none !important;","3526","}","3527","","3528","================================","3529",""],"delete":[]}]}},"637e612d509f1ad575f613fd95bd9e939a4c3762":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["1297","CSS","1298",".ndfHFb-c4YZDc.ndfHFb-c4YZDc-i5oIFb .ndfHFb-c4YZDc-Bz112c:not([onclick]):not(:link):not(:visited) {","1299","    background-image: url('\/\/ssl.gstatic.com\/docs\/common\/viewer\/v3\/v-sprite26.svg') !important;","1300","}","1301",""],"delete":[]}]}},"9d1fcf4712b25b79840616258c40d4c9a452cb10":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["3786","redgamingtech.com","3787","","3788","CSS","3789","body {","3790","    background-image: none !important;                                                                                                                                                                                                                                                                    ","3791","}","3792","","3793","================================","3794",""],"delete":[]}]}},"a4dfe88bb55753b3f7d2c22daceb2c9258f599d2":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["2526","::selection {","2527","    background-color: var(--darkreader-selection-background) !important;","2528","}"],"delete":[]}]}},"a130a922d5f325b6651094a2af3ff38cf75f3594":{"changes":{"src\/inject\/dynamic-theme\/inline-style.ts":"MODIFY"},"diff":{"src\/inject\/dynamic-theme\/inline-style.ts":[{"add":["95","        if (property === 'background-image' && value.indexOf('url') >= 0) {"],"delete":["95","        if (property === 'background-image') {"]}]}},"593f078f12172aa1c579ddf5c476d90db438f47a":{"changes":{"src\/config\/inversion-fixes.config":"MODIFY"},"diff":{"src\/config\/inversion-fixes.config":[{"add":["2444","youtube-nocookie.com","2445","","2446","NO INVERT","2447","video","2448","","2449","================================","2450",""],"delete":[]}]}},"1136323ca795ddb800da01c078737896f7fbaad9":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":[],"delete":["10983","#dimg_15"]}]}},"712b181c7c9b44a2c5af6eddd3455bf8c4127483":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["4677","wakamaifondue.com","4678","","4679","CSS","4680",".upload-button > strong, .upload-button > span {","4681","    color: ${white} !important;","4682","}","4683","","4684","================================","4685",""],"delete":[]}]}},"5c7dbae0e35102e5c9cf076117d257e5091a135f":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["3585","peonaviveu.blogspot.com","3586","","3587","CSS","3588","body {","3589","    background-image: none !important;    ","3590","    background-color: var(--darkreader-neutral-background) !important;                                                                                                                                                                                                                                                                     ","3591","}","3592","","3593","================================","3594",""],"delete":[]}]}},"cb7f3c86806a147983803c83304789946913c699":{"changes":{"tasks\/bundle-js.js":"MODIFY","tasks\/build.js":"MODIFY"},"diff":{"tasks\/bundle-js.js":[{"add":["146","                    cacheRoot: debug ? `${fs.realpathSync(os.tmpdir())}\/darkreader_typescript_cache\/${rollupPluginTypesctiptInstanceKey}` : undefined,"],"delete":["146","                    cacheDir: debug ? `${fs.realpathSync(os.tmpdir())}\/darkreader_typescript_cache` : undefined,"]}],"tasks\/build.js":[{"add":["50","        console.log(err);"],"delete":[]}]}},"4dd68b7b1b34e42d6f4af4a1e385705dc9d5b11c":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["14894","body::before {","14895","    z-index: 0 !important;","14896","}"],"delete":[]}]}},"12af0403a706050a8684f0c23fd9fed255582cdb":{"changes":{"src\/background\/extension.ts":"MODIFY","CHANGELOG.md":"MODIFY"},"diff":{"src\/background\/extension.ts":[{"add":["517","        }","518","","519","        if (UserStorage.settings.changeBrowserTheme) {","520","            if (this.isExtensionSwitchedOn() && this.autoState !== 'scheme-light') {","521","                setWindowTheme(UserStorage.settings.theme);","522","            } else {"],"delete":["512","            if (UserStorage.settings.changeBrowserTheme) {","513","                setWindowTheme(UserStorage.settings.theme);","514","            }","520","            if (UserStorage.settings.changeBrowserTheme) {"]}],"CHANGELOG.md":[{"add":["0","## Unreleased","1","","2","- Fix browser theme not changing when automation + scheme behavior was enabled.","3",""],"delete":[]}]}},"68d3fd691ddf2550f565d10ba2ccaa04d59c2dc8":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["13252","www.adjust.com","13253","","13254","INVERT","13255",".homepage .a-section:first-child::before","13256","","13257","CSS","13258",".a-section.bg-gradient {","13259","    --bg-gradient-end: ${white} !important;","13260","    --bg-gradient-start: var(--darkreader-neutral-background) !important;","13261","}","13262","","13263","================================","13264",""],"delete":[]}]}},"6a0a5d9e8c192d5c8904cb06c9e337cfa7feba15":{"changes":{"src\/ui\/popup\/components\/site-list-settings\/index.tsx":"MODIFY","src\/background\/extension.ts":"MODIFY","src\/ui\/popup\/components\/body.tsx":"MODIFY","src\/ui\/popup\/components\/header\/index.tsx":"MODIFY","src\/ui\/popup\/components\/filter-settings\/index.tsx":"MODIFY","src\/ui\/connect\/mock.ts":"MODIFY","src\/ui\/popup\/components\/filter-settings\/mode-toggle.tsx":"MODIFY","src\/ui\/stylesheet-editor\/components\/body.tsx":"MODIFY","src\/ui\/popup\/components\/custom-settings-toggle\/index.tsx":"MODIFY","src\/definitions.d.ts":"MODIFY","src\/ui\/devtools\/components\/body.tsx":"MODIFY","src\/utils\/time.ts":"ADD","src\/background\/user-storage.ts":"MODIFY","src\/ui\/popup\/components\/more-settings\/index.tsx":"MODIFY","src\/ui\/popup\/components\/site-toggle\/index.tsx":"MODIFY","src\/ui\/connect\/connector.ts":"MODIFY","src\/ui\/popup\/components\/font-settings\/index.tsx":"MODIFY","src\/background\/messenger.ts":"MODIFY"},"diff":{"src\/ui\/popup\/components\/site-list-settings\/index.tsx":[{"add":["19","                checked={data.settings.applyToListedOnly}","22","                onChange={(value) => actions.changeSettings({applyToListedOnly: value})}","27","                values={data.settings.siteList}","31","                        actions.changeSettings({siteList: values});"],"delete":["19","                checked={data.filterConfig.invertListed}","22","                onChange={(value) => actions.setConfig({invertListed: value})}","27","                values={data.filterConfig.siteList}","31","                        actions.setConfig({siteList: values});"]}],"src\/background\/extension.ts":[{"add":["9","import {isFirefox} from '..\/utils\/platform';","10","import {isInTimeInterval} from '..\/utils\/time';","11","import {isURLInList, getURLHost} from '..\/utils\/url';","17","import {FilterConfig, ExtensionData, Shortcuts, UserSettings} from '..\/definitions';","36","        this.devtools = new DevTools(this.config, () => this.onSettingsChanged());","40","            if (unread.length > 0 && this.user.settings.notifyOfNews) {","49","                    return this.isEnabled() && this.getTabMessage(url, frameURL);","53","                            resolve(this.isEnabled() && this.getTabMessage(url, frameURL));","63","    isEnabled() {","64","        if (this.user.settings.enabled === 'auto') {","65","            const now = new Date();","66","            return isInTimeInterval(now, this.user.settings.activationTime, this.user.settings.deactivationTime);","67","        }","68","        return this.user.settings.enabled;","69","    }","70","","77","        await this.user.loadSettings();","78","        this.onAppToggle();","79","        this.changeSettings(this.user.settings);","80","        console.log('loaded', this.user.settings);","109","            changeSettings: (settings) => this.changeSettings(settings),","110","            setTheme: (theme) => this.setTheme(theme),","132","                this.changeSettings({enabled: !this.isEnabled()});","141","                const index = engines.indexOf(this.user.settings.theme.engine);","143","                this.setTheme({engine: next});","159","            isEnabled: this.isEnabled(),","160","            isReady: this.ready,","161","            settings: this.user.settings,","171","    changeSettings($settings: Partial<UserSettings>) {","172","        const prev = {...this.user.settings};","174","        this.user.set($settings);","176","        if (prev.enabled !== this.user.settings.enabled) {","177","            this.onAppToggle();","179","","180","        if (this.isEnabled() && $settings.changeBrowserTheme != null && prev.changeBrowserTheme !== $settings.changeBrowserTheme) {","181","            if ($settings.changeBrowserTheme) {","182","                setWindowTheme(this.user.settings.theme);","183","            } else {","187","","188","        this.onSettingsChanged();","189","    }","190","","191","    setTheme($theme: Partial<FilterConfig>) {","192","        this.user.set({theme: {...this.user.settings.theme, ...$theme}});","193","","194","        if (this.isEnabled() && this.user.settings.changeBrowserTheme) {","195","            setWindowTheme(this.user.settings.theme);","196","        }","197","","198","        this.onSettingsChanged();","207","        const siteList = this.user.settings.siteList.slice();","214","        this.changeSettings({siteList});","233","    private onAppToggle() {","234","        if (this.isEnabled()) {","236","            if (this.user.settings.changeBrowserTheme) {","237","                setWindowTheme(this.user.settings.theme);","238","            }","241","            if (this.user.settings.changeBrowserTheme) {","242","                resetWindowTheme();","243","            }","247","    private onSettingsChanged() {","251","","252","        this.tabs.sendMessage(this.getTabMessage);","266","        const isURLInDarkList = isURLInList(url, DARK_SITES);","267","        const isURLInUserList = isURLInList(url, this.user.settings.siteList);","269","        if (this.isEnabled() && (","270","            (isURLInUserList && this.user.settings.applyToListedOnly) ||","271","            (!isURLInDarkList && !this.user.settings.applyToListedOnly && !isURLInUserList)","273","            const custom = this.user.settings.customThemes.find(({url: urlList}) => isURLInList(url, urlList));","274","            const filterConfig = custom ? custom.theme : this.user.settings.theme;","309","                    const {engine, ...filter} = filterConfig;","334","        await this.user.saveSettings();","335","        console.log('saved', this.user.settings);"],"delete":["9","import {isFirefox, isMobile} from '..\/utils\/platform';","10","import {isURLInList, getURLHost, isURLMatched} from '..\/utils\/url';","16","import {FilterConfig, ExtensionData, Shortcuts} from '..\/definitions';","19","","20","    enabled: boolean;","25","    filterConfig: FilterConfig;","38","        this.devtools = new DevTools(this.config, () => this.onConfigPropChanged());","41","            const shouldNotify = false; \/\/ TODO: Suggest an option for that.","43","            if (unread.length > 0 && shouldNotify) {","52","                    return this.enabled && this.getTabMessage(url, frameURL);","56","                            resolve(this.enabled && this.getTabMessage(url, frameURL));","72","        const settings = await this.user.loadSettings();","73","        if (settings.enabled) {","74","            this.enable();","75","        } else {","76","            this.disable();","77","        }","78","        this.setConfig(settings.config);","79","        console.log('loaded', settings);","108","            enable: () => this.enable(),","109","            disable: () => this.disable(),","110","            setConfig: (config) => this.setConfig(config),","132","                if (this.enabled) {","133","                    this.disable();","134","                } else {","135","                    this.enable();","136","                }","145","                const index = engines.indexOf(this.filterConfig.engine);","147","                this.setConfig({engine: next});","163","            enabled: this.enabled,","164","            filterConfig: this.filterConfig,","165","            ready: this.ready,","175","    enable() {","176","        this.enabled = true;","177","        if (this.filterConfig && this.filterConfig.changeBrowserTheme) {","178","            setWindowTheme(this.filterConfig);","179","        }","180","        this.onAppToggle();","181","    }","183","    disable() {","184","        this.enabled = false;","185","        if (this.filterConfig && this.filterConfig.changeBrowserTheme) {","186","            resetWindowTheme();","187","        }","188","        this.onAppToggle();","189","    }","191","    setConfig(config: FilterConfig) {","192","        const prevConfig = {...this.filterConfig};","193","        let siteList: string[] = prevConfig.siteList;","194","        if (config.siteList) {","195","            siteList = config.siteList.filter((pattern) => {","196","                let isOK = false;","197","                try {","198","                    isURLMatched('https:\/\/google.com\/', pattern);","199","                    isOK = true;","200","                } catch (err) {","201","                    console.warn(`Pattern \"${pattern}\" excluded`);","202","                }","203","                return isOK && pattern !== '\/';","204","            });","206","        this.filterConfig = {...prevConfig, ...config, siteList};","207","        if (this.enabled) {","208","            if (!this.filterConfig.changeBrowserTheme && prevConfig.changeBrowserTheme) {","210","            } else if (this.filterConfig.changeBrowserTheme && (","211","                !prevConfig.changeBrowserTheme ||","212","                (this.filterConfig.mode !== prevConfig.mode) ||","213","                (this.filterConfig.brightness !== prevConfig.brightness) ||","214","                (this.filterConfig.contrast !== prevConfig.contrast) ||","215","                (this.filterConfig.sepia !== prevConfig.sepia) ||","216","                (this.filterConfig.grayscale !== prevConfig.grayscale)","217","            )) {","218","                setWindowTheme(this.filterConfig);","221","        this.onConfigPropChanged();","230","        const siteList = this.filterConfig.siteList.slice();","237","        this.setConfig(Object.assign({}, this.filterConfig, {siteList}));","256","    protected onAppToggle() {","257","        if (this.enabled) {","262","        if (!this.ready) {","263","            return;","264","        }","265","        this.tabs.sendMessage(this.getTabMessage);","266","        this.saveUserSettings();","267","        this.reportChanges();","270","    protected onConfigPropChanged() {","274","        if (this.enabled) {","275","            this.tabs.sendMessage(this.getTabMessage);","276","        }","290","        const isUrlInDarkList = isURLInList(url, DARK_SITES);","291","        const isUrlInUserList = isURLInList(url, this.filterConfig.siteList);","293","        if (this.enabled && (","294","            (isUrlInUserList && this.filterConfig.invertListed) ||","295","            (!isUrlInDarkList && !this.filterConfig.invertListed && !isUrlInUserList)","297","            const custom = this.filterConfig.custom.find(({url: urlList}) => isURLInList(url, urlList));","298","            const filterConfig = custom ? custom.config : this.filterConfig;","333","                    const {siteList, invertListed, engine, ...filter} = filterConfig;","358","        const saved = await this.user.saveSetting({","359","            enabled: this.enabled,","360","            config: this.filterConfig,","361","        });","362","        console.log('saved', saved);"]}],"src\/ui\/popup\/components\/body.tsx":[{"add":["3","import {TabPanel, Button} from '..\/..\/controls';","41","    if (!props.data.isReady) {","66","        <body class={{'ext-disabled': !props.data.isEnabled}}>"],"delete":["3","import {TabPanel, Button, CheckBox} from '..\/..\/controls';","13","import {compileMarkdown} from '..\/utils\/markdown';","42","    if (!props.data.ready) {","67","        <body class={{'ext-disabled': !props.data.enabled}}>"]}],"src\/ui\/popup\/components\/header\/index.tsx":[{"add":["13","        actions.changeSettings({enabled});","46","                <Toggle checked={data.isEnabled} labelOn={getLocalMessage('on')} labelOff={getLocalMessage('off')} onChange={toggleExtension} \/>"],"delete":["13","        if (enabled) {","14","            actions.enable();","15","        } else {","16","            actions.disable();","17","        }","50","                <Toggle checked={data.enabled} labelOn={getLocalMessage('on')} labelOff={getLocalMessage('off')} onChange={toggleExtension} \/>"]}],"src\/ui\/popup\/components\/filter-settings\/index.tsx":[{"add":["1","import {UpDown} from '..\/..\/..\/controls';","10","    const custom = data.settings.customThemes.find(({url}) => isURLInList(tab.url, url));","11","    const filterConfig = custom ? custom.theme : data.settings.theme;","13","    function setConfig(config: Partial<FilterConfig>) {","15","            custom.theme = {...custom.theme, ...config};","16","            actions.changeSettings({customThemes: data.settings.customThemes});","18","            actions.setTheme(config)"],"delete":["1","import {UpDown, Button} from '..\/..\/..\/controls';","3","import EngineSwitch from '..\/engine-switch';","11","    const custom = data.filterConfig.custom.find(({url}) => isURLInList(tab.url, url));","12","    const filterConfig = custom ? custom.config : data.filterConfig;","14","    function setConfig(config: FilterConfig) {","16","            custom.config = {...custom.config, ...config};","17","            actions.setConfig({custom: data.filterConfig.custom});","19","            actions.setConfig(config)"]}],"src\/ui\/connect\/mock.ts":[{"add":["0","import {ExtensionData, TabInfo, UserSettings} from '..\/..\/definitions';","4","        isEnabled: true,","5","        isReady: true,","6","        settings: {","7","            enabled: true,","8","            theme: {","9","                mode: 1,","10","                brightness: 110,","11","                contrast: 90,","12","                grayscale: 20,","13","                sepia: 10,","14","                useFont: false,","15","                fontFamily: 'Segoe UI',","16","                textStroke: 0,","17","                engine: 'cssFilter',","18","                stylesheet: '',","19","            },","20","            customThemes: [],","22","            applyToListedOnly: false,","23","            changeBrowserTheme: false,","24","            activationTime: '18:00',","25","            deactivationTime: '9:00',","26","            notifyOfNews: false,","27","            syncSettings: true,","28","        } as UserSettings,","70","        changeSettings(settings) {","71","            Object.assign(data.settings, settings);","74","        setTheme(theme) {","75","            Object.assign(data.settings.theme, theme);","83","            const index = data.settings.siteList.indexOf(pattern);","85","                data.settings.siteList.splice(pattern, 1);","87","                data.settings.siteList.push(pattern);"],"delete":["0","import {ExtensionData, TabInfo} from '..\/..\/definitions';","4","        enabled: true,","5","        ready: true,","6","        filterConfig: {","7","            mode: 1,","8","            brightness: 110,","9","            contrast: 90,","10","            grayscale: 20,","11","            sepia: 10,","12","            useFont: false,","13","            fontFamily: 'Segoe UI',","14","            textStroke: 0,","15","            invertListed: false,","16","            engine: 'cssFilter',","18","            custom: [],","19","        },","61","        enable() {","62","            data.enabled = true;","65","        disable() {","66","            data.enabled = false;","67","            listener(data);","68","        },","69","        setConfig(config) {","70","            Object.assign(data.filterConfig, config);","78","            const index = data.filterConfig.siteList.indexOf(pattern);","80","                data.filterConfig.siteList.splice(pattern, 1);","82","                data.filterConfig.siteList.push(pattern);"]}],"src\/ui\/popup\/components\/filter-settings\/mode-toggle.tsx":[{"add":[],"delete":["3","import {ExtWrapper} from '..\/..\/..\/..\/definitions';"]}],"src\/ui\/stylesheet-editor\/components\/body.tsx":[{"add":["12","    const custom = data.settings.customThemes.find(({url}) => isURLInList(tab.url, url));","25","        textNode.value = (custom ? custom.theme.stylesheet : data.settings.theme.stylesheet) || '';","33","            custom.theme = {...custom.theme, ...{stylesheet: css}};","34","            actions.changeSettings({customThemes: data.settings.customThemes});","36","            actions.setTheme({stylesheet: css});"],"delete":["12","    const custom = data.filterConfig.custom.find(({url}) => isURLInList(tab.url, url));","25","        textNode.value = (custom ? custom.config.stylesheet : data.filterConfig.stylesheet) || '';","33","            custom.config = {...custom.config, ...{stylesheet: css}};","34","            actions.setConfig({custom: data.filterConfig.custom});","36","            actions.setConfig({stylesheet: css});"]}],"src\/ui\/popup\/components\/custom-settings-toggle\/index.tsx":[{"add":["0","import {html} from 'malevic';","9","    const isCustom = data.settings.customThemes.some(({url}) => isURLInList(tab.url, url));","25","                'custom-settings-toggle--disabled': tab.isProtected || (tab.isInDarkList && !data.settings.applyToListedOnly),","29","                    const filtered = data.settings.customThemes.filter(({url}) => !isURLInList(tab.url, url));","30","                    actions.changeSettings({customThemes: filtered});","32","                    const extended = data.settings.customThemes.concat({","34","                        theme: {...data.settings.theme},","36","                    actions.changeSettings({customThemes: extended});"],"delete":["0","import {html, render} from 'malevic';","9","    const isCustom = data.filterConfig.custom.some(({url}) => isURLInList(tab.url, url));","25","                'custom-settings-toggle--disabled': tab.isProtected || (tab.isInDarkList && !data.filterConfig.invertListed),","29","                    const filtered = data.filterConfig.custom.filter(({url}) => !isURLInList(tab.url, url));","30","                    actions.setConfig({custom: filtered});","32","                    const {mode, brightness, contrast, grayscale, sepia, useFont, fontFamily, textStroke, engine} = data.filterConfig;","33","                    const extended = data.filterConfig.custom.concat({","35","                        config: {mode, brightness, contrast, grayscale, sepia, useFont, fontFamily, textStroke, engine},","37","                    actions.setConfig({custom: extended});"]}],"src\/definitions.d.ts":[{"add":["3","    isEnabled: boolean;","4","    isReady: boolean;","5","    settings: UserSettings;","15","    changeSettings(settings: Partial<UserSettings>);","16","    setTheme(theme: Partial<FilterConfig>);","34","    mode: FilterMode;","35","    brightness: number;","36","    contrast: number;","37","    grayscale: number;","38","    sepia: number;","39","    useFont: boolean;","40","    fontFamily: string;","41","    textStroke: number;","42","    engine: string;","43","    stylesheet: string;","48","    theme: FilterConfig;","52","    enabled: boolean | 'auto';","53","    theme: FilterConfig;","54","    customThemes: CustomSiteConfig[];","55","    siteList: string[];","56","    applyToListedOnly: boolean;","57","    changeBrowserTheme: boolean;","58","    activationTime: string;","59","    deactivationTime: string;","60","    notifyOfNews: boolean;","61","    syncSettings: boolean;"],"delete":["3","    enabled: boolean;","4","    ready: boolean;","5","    filterConfig: FilterConfig;","15","    enable();","16","    disable();","17","    setConfig(config: FilterConfig);","35","    mode?: FilterMode;","36","    brightness?: number;","37","    contrast?: number;","38","    grayscale?: number;","39","    sepia?: number;","40","    useFont?: boolean;","41","    fontFamily?: string;","42","    textStroke?: number;","43","    siteList?: string[];","44","    invertListed?: boolean;","45","    engine?: string;","46","    stylesheet?: string;","47","    custom?: CustomSiteConfig[];","48","    changeBrowserTheme?: boolean;","53","    config: FilterConfig;","57","    enabled: boolean;","58","    config: FilterConfig;"]}],"src\/ui\/devtools\/components\/body.tsx":[{"add":["15","    const wrapper = (data.settings.theme.engine === ThemeEngines.staticTheme","21","        } : data.settings.theme.engine === ThemeEngines.cssFilter || data.settings.theme.engine === ThemeEngines.svgFilter ? {"],"delete":["7","const initialTexts = new WeakSet<Element>();","8","","17","    const wrapper = (data.filterConfig.engine === ThemeEngines.staticTheme","23","        } : data.filterConfig.engine === ThemeEngines.cssFilter || data.filterConfig.engine === ThemeEngines.svgFilter ? {"]}],"src\/utils\/time.ts":[{"add":[],"delete":[]}],"src\/background\/user-storage.ts":[{"add":["2","import {isURLMatched} from '..\/utils\/url';","3","import {UserSettings} from '..\/definitions';","13","            theme: {","25","            customThemes: [],","26","            siteList: [],","27","            applyToListedOnly: false,","28","            changeBrowserTheme: false,","29","            activationTime: '18:00',","30","            deactivationTime: '9:00',","31","            notifyOfNews: false,","32","            syncSettings: true,","34","        this.settings = null;","36","","37","    settings: Readonly<UserSettings>;","38","","39","    async loadSettings() {","40","        this.settings = await this.loadSettingsFromStorage();","41","    }","42","","43","    private loadSettingsFromStorage() {","45","            chrome.storage.local.get(this.defaultSettings, (local: UserSettings) => {","46","                if (!local.syncSettings) {","47","                    local.theme = {...this.defaultSettings.theme, ...local.theme};","48","                    resolve(local);","49","                    return;","51","","52","                chrome.storage.sync.get({...this.defaultSettings, config: 'empty'}, ($sync: UserSettings & {config: any}) => {","53","                    let sync: UserSettings;","54","                    if ($sync.config === 'empty') {","55","                        delete $sync.config;","56","                        sync = $sync;","57","                    } else {","58","                        sync = this.migrateSettings_4_6_2($sync) as UserSettings;","59","                    }","60","                    sync.theme = {...this.defaultSettings.theme, ...sync.theme};","61","                    resolve(sync);","62","                });","67","    async saveSettings() {","68","        const saved = await this.saveSettingsIntoStorage(this.settings);","69","        this.settings = saved;","70","    }","71","","72","    private saveSettingsIntoStorage(settings: UserSettings) {","78","                this.timeout = null;","79","                if (settings.syncSettings) {","80","                    chrome.storage.sync.set(settings, () => {","81","                        if (chrome.runtime.lastError) {","82","                            console.warn('Settings synchronization was disabled due to error:', chrome.runtime.lastError);","83","                            const local: UserSettings = {...settings, syncSettings: false};","84","                            chrome.storage.local.set(local, () => resolve(local));","85","                        } else {","86","                            resolve(settings);","87","                        }","88","                    });","89","                } else {","90","                    chrome.storage.local.set(settings, () => resolve(settings));","91","                }","97","","98","    set($settings: Partial<UserSettings>) {","99","        if ($settings.siteList) {","100","            const siteList = $settings.siteList.filter((pattern) => {","101","                let isOK = false;","102","                try {","103","                    isURLMatched('https:\/\/google.com\/', pattern);","104","                    isOK = true;","105","                } catch (err) {","106","                    console.warn(`Pattern \"${pattern}\" excluded`);","107","                }","108","                return isOK && pattern !== '\/';","109","            });","110","            $settings = {...$settings, siteList};","111","        }","112","        this.settings = {...this.settings, ...$settings};","113","    }","114","","115","    private migrateSettings_4_6_2(settings_4_6_2: any) {","116","        function migrateTheme(filterConfig_4_6_2: any) {","117","            const f = filterConfig_4_6_2;","118","            return {","119","                mode: f.mode,","120","                brightness: f.brightness,","121","                contrast: f.contrast,","122","                grayscale: f.grayscale,","123","                sepia: f.sepia,","124","                useFont: f.useFont,","125","                fontFamily: f.fontFamily,","126","                textStroke: f.textStroke,","127","                engine: f.engine,","128","                stylesheet: f.stylesheet,","129","            };","130","        }","131","","132","        try {","133","            const s = settings_4_6_2;","134","            const settings: UserSettings = {","135","                enabled: s.enabled,","136","                ...this.defaultSettings,","137","                theme: migrateTheme(s.config),","138","                customThemes: s.config.custom ? s.config.custom.map((c) => {","139","                    return {","140","                        url: c.url,","141","                        theme: migrateTheme(c.config),","142","                    };","143","                }) : [],","144","                siteList: s.config.siteList,","145","                applyToListedOnly: s.config.invertListed,","146","                changeBrowserTheme: s.config.changeBrowserTheme,","147","            };","148","            chrome.storage.sync.remove('config');","149","            chrome.storage.sync.set(settings);","150","            return settings;","151","        } catch (err) {","152","            console.error('Settings migration error:', err, 'Loaded settings:', settings_4_6_2);","153","            return this.defaultSettings;","154","        }","155","    }"],"delete":["2","import {UserSettings, FilterConfig} from '..\/definitions';","12","            config: {","21","                invertListed: false,","24","                siteList: [],","25","                custom: [],","26","                changeBrowserTheme: false,","30","    loadSettings() {","32","            chrome.storage.sync.get(this.defaultSettings, ($s: UserSettings) => {","33","                $s.config = {...this.defaultSettings.config, ...$s.config};","34","                if (!Array.isArray($s.config.siteList)) {","35","                    const arr = [];","36","                    for (let key in $s.config.siteList as any) {","37","                        arr[key] = $s.config.siteList[key];","38","                    }","39","                    $s.config.siteList = arr;","41","                resolve({","42","                    enabled: $s.enabled,","43","                    config: $s.config,","44","                } as UserSettings);","49","    saveSetting(settings: UserSettings) {","55","                const $s: UserSettings = {","56","                    enabled: settings.enabled,","57","                    config: settings.config,","58","                };","59","                chrome.storage.sync.set($s, () => {","60","                    this.timeout = null;","61","                    resolve($s);","62","                });"]}],"src\/ui\/popup\/components\/more-settings\/index.tsx":[{"add":["4","import {Toggle} from '..\/..\/..\/controls';","13","    const custom = data.settings.customThemes.find(({url}) => isURLInList(tab.url, url));","14","    const filterConfig = custom ? custom.theme : data.settings.theme;","16","    function setConfig(config: Partial<FilterConfig>) {","18","            custom.theme = {...custom.theme, ...config};","19","            actions.changeSettings({customThemes: data.settings.customThemes});","21","            actions.setTheme(config)","47","                            <p class=\"more-settings__description\">","48","                                {getLocalMessage('only_for_description')}","49","                            <\/p>","50","                        )}","55","                        checked={data.settings.changeBrowserTheme}","58","                        onChange={(checked) => actions.changeSettings({changeBrowserTheme: checked})}"],"delete":["4","import {Toggle, UpDown} from '..\/..\/..\/controls';","13","    const custom = data.filterConfig.custom.find(({url}) => isURLInList(tab.url, url));","14","    const filterConfig = custom ? custom.config : data.filterConfig;","16","    function setConfig(config: FilterConfig) {","18","            custom.config = {...custom.config, ...config};","19","            actions.setConfig({custom: data.filterConfig.custom});","21","            actions.setConfig(config)","47","                    <p class=\"more-settings__description\">","48","                        {getLocalMessage('only_for_description')}","49","                    <\/p>","50","                )}","55","                        checked={data.filterConfig.changeBrowserTheme}","58","                        onChange={(checked) => actions.setConfig({changeBrowserTheme: checked})}"]}],"src\/ui\/popup\/components\/site-toggle\/index.tsx":[{"add":["8","        data.isEnabled &&","10","        (data.settings.applyToListedOnly || !tab.isInDarkList)"],"delete":["8","        data.enabled &&","10","        (data.filterConfig.invertListed || !tab.isInDarkList)"]}],"src\/ui\/connect\/connector.ts":[{"add":["0","import {ExtensionData, ExtensionActions, FilterConfig, TabInfo, Message, UserSettings} from '..\/..\/definitions';","59","    changeSettings(settings: Partial<UserSettings>) {","60","        this.port.postMessage({type: 'change-settings', data: settings});","61","    }","62","","63","    setTheme(theme: Partial<FilterConfig>) {","64","        this.port.postMessage({type: 'set-theme', data: theme});"],"delete":["0","import {ExtensionData, ExtensionActions, FilterConfig, TabInfo, Message} from '..\/..\/definitions';","59","    setConfig(config: FilterConfig) {","60","        this.port.postMessage({type: 'set-config', data: config});"]}],"src\/ui\/popup\/components\/font-settings\/index.tsx":[{"add":["8","    onChange: (config: Partial<FilterConfig>) => void;"],"delete":["8","    onChange: (config: FilterConfig) => void;"]}],"src\/background\/messenger.ts":[{"add":["0","import {ExtensionData, FilterConfig, TabInfo, Message, UserSettings} from '..\/definitions';","5","    changeSettings: (settings: Partial<UserSettings>) => void;","6","    setTheme: (theme: Partial<FilterConfig>) => void;","52","            case 'change-settings': {","53","                this.adapter.changeSettings(data);","56","            case 'set-theme': {","57","                this.adapter.setTheme(data);"],"delete":["0","import {ExtensionData, FilterConfig, TabInfo, Message} from '..\/definitions';","5","    enable: () => void;","6","    disable: () => void;","7","    setConfig: (config: FilterConfig) => void;","53","            case 'enable': {","54","                this.adapter.enable();","57","            case 'disable': {","58","                this.adapter.disable();","59","                break;","60","            }","61","            case 'set-config': {","62","                this.adapter.setConfig(data);"]}]}},"34e858e825b6f9e33321a17a17a4045037ae081b":{"changes":{"src\/inject\/dynamic-theme\/index.ts":"MODIFY"},"diff":{"src\/inject\/dynamic-theme\/index.ts":[{"add":["185","    if (document.head) {","186","        removeNode(document.head.querySelector('.darkreader--user-agent'));","187","        removeNode(document.head.querySelector('.darkreader--text'));","188","        removeNode(document.head.querySelector('.darkreader--invert'));","189","        removeNode(document.head.querySelector('.darkreader--inline'));","190","    }"],"delete":["185","    removeNode(document.head.querySelector('.darkreader--user-agent'));","186","    removeNode(document.head.querySelector('.darkreader--text'));","187","    removeNode(document.head.querySelector('.darkreader--invert'));","188","    removeNode(document.head.querySelector('.darkreader--inline'));"]}]}},"0045b52dda1426159f1bd10bab4f1b19ae5fc5eb":{"changes":{"src\/ui\/popup\/components\/news\/index.tsx":"MODIFY"},"diff":{"src\/ui\/popup\/components\/news\/index.tsx":[{"add":["25","                    const date = new Date(event.date);","26","                    let formattedDate: string;","27","                    try {","28","                        \/\/ Workaround for https:\/\/bugs.chromium.org\/p\/chromium\/issues\/detail?id=811403","29","                        const locale = getUILanguage();","30","                        formattedDate = date.toLocaleDateString(locale, {month: 'short', day: 'numeric'});","31","                    } catch (err) {","32","                        formattedDate = date.toISOString().substring(0, 10);","33","                    }"],"delete":["25","                    const locale = getUILanguage();","26","                    const formattedDate = new Date(event.date).toLocaleDateString(locale, {month: 'short', day: 'numeric'});"]}]}},"0beac7510575fdddc089cedc9bd7c1334ed81a17":{"changes":{"src\/utils\/url.ts":"MODIFY"},"diff":{"src\/utils\/url.ts":[{"add":["55","","56","    if (url.protocol !== location.protocol) {","59","    if (url.hostname !== location.hostname) {","62","    if (url.port !== location.port) {","67","    return url.pathname === location.pathname;"],"delete":["55","    const base = parseURL(location.href);","56","    if (url.protocol !== base.protocol) {","59","    if (url.hostname !== base.hostname) {","62","    if (url.port !== base.port) {","67","    const path = \/.*\\\/\/.exec(url.pathname)[0];","68","    const basePath = \/.*\\\/\/.exec(base.pathname)[0];","69","    return path === basePath;"]}]}},"c08b61f7b16688d66db962a95c5535023844cbf7":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["1553","emacswiki.org","1554","","1555","CSS","1556","body {","1557","    background-color: var(--darkreader-neutral-background) !important;","1558","}","1559","","1560","================================","1561",""],"delete":[]}]}},"f3926cbebf10d170aff4b76fefe30387f899358f":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["764","bandcamp.com","765","","766","CSS","767",".ui-dialog {","768","    background-image: none !important;","769","}","770","","771","================================","772",""],"delete":[]}]}},"8e5b467da66928325a5b07359a2e5feecc655597":{"changes":{"src\/inject\/dynamic-theme\/stylesheet-proxy.ts":"MODIFY"},"diff":{"src\/inject\/dynamic-theme\/stylesheet-proxy.ts":[{"add":["14","    \/\/ Reference:","15","    \/\/ https:\/\/github.com\/darkreader\/darkreader\/issues\/6480#issuecomment-897696175","16","    const shouldWrapHTMLElement = location.hostname.endsWith('baidu.com');","17","","18","    const getElementsByTagNameDescriptor = shouldWrapHTMLElement ?","19","        Object.getOwnPropertyDescriptor(Element.prototype, 'getElementsByTagName') : null;","20","","31","        if (shouldWrapHTMLElement) {","32","            Object.defineProperty(Element.prototype, 'getElementsByTagName', getElementsByTagNameDescriptor);","33","        }","86","    function proxyGetElementsByTagName(tagName: string): NodeListOf<HTMLElement> {","87","        const getCurrentElementValue = () => {","88","            let elements: NodeListOf<HTMLElement> = getElementsByTagNameDescriptor.value.call(this, tagName);","89","            if (tagName === 'style') {","90","                elements = Object.setPrototypeOf([...elements].filter((element: HTMLElement) => {","91","                    return !element.classList.contains('darkreader');","92","                }), NodeList.prototype);","93","            }","94","            return elements;","95","        };","96","","97","        let elements = getCurrentElementValue();","98","        \/\/ Don't ask just trust me.","99","        \/\/ Because NodeListOf and HTMLCollection are so called \"live objects\".","100","        \/\/ Every time you access them, it will return all tagnames from","101","        \/\/ current situation of the DOM. Instead of a static list.","102","        const NodeListBehavior: ProxyHandler<NodeListOf<HTMLElement>> = {","103","            get: function (_: NodeListOf<HTMLElement>, property: string) {","104","                return getCurrentElementValue()[property];","105","            }","106","        };","107","        elements = new Proxy(elements, NodeListBehavior);","108","        return elements;","109","    }","110","","118","    if (shouldWrapHTMLElement) {","119","        Object.defineProperty(Element.prototype, 'getElementsByTagName', Object.assign({}, getElementsByTagNameDescriptor, {value: proxyGetElementsByTagName}));","120","    }"],"delete":[]}]}},"fabc530b6cdaa8bca66dfefa3719532a50aeec94":{"changes":{"src\/definitions.d.ts":"MODIFY","src\/generators\/dynamic-theme.ts":"MODIFY","src\/inject\/dynamic-theme\/inline-style.ts":"MODIFY","src\/inject\/dynamic-theme\/index.ts":"MODIFY","src\/config\/dynamic-theme-fixes.config":"MODIFY","tests\/config.tests.ts":"MODIFY"},"diff":{"src\/definitions.d.ts":[{"add":["104","    ignoreInlineStyle: string[];"],"delete":[]}],"src\/generators\/dynamic-theme.ts":[{"add":["7","    'IGNORE INLINE STYLE': 'ignoreInlineStyle',","53","        ignoreInlineStyle: fixes[0].ignoreInlineStyle || [],","77","        ignoreInlineStyle: common.ignoreInlineStyle.concat(match.ignoreInlineStyle || []),"],"delete":[]}],"src\/inject\/dynamic-theme\/inline-style.ts":[{"add":["187","function shouldIgnoreInlineStyle (element: HTMLElement, selectors: string[]) {","188","    for (const ingnoredSelector of selectors) {","189","        if (element.matches(ingnoredSelector)) {","190","            return true;","191","        }","192","    }","193","    return false;","194","}","195","","196","export function overrideInlineStyle(element: HTMLElement, theme: FilterConfig, ignoreSelectors: string[]) {","222","    if (ignoreSelectors.length > 0) {","223","        if (shouldIgnoreInlineStyle(element, ignoreSelectors)) {","224","            unsetProps.forEach((cssProp) => {","225","                const {store, dataAttr} = overrides[cssProp];","226","                store.delete(element);","227","                element.removeAttribute(dataAttr);","228","            });","229","            return;","230","        }","231","    }","232",""],"delete":["187","export function overrideInlineStyle(element: HTMLElement, theme: FilterConfig) {"]}],"src\/inject\/dynamic-theme\/index.ts":[{"add":["163","    inlineStyleElements.forEach((el) => overrideInlineStyle(el as HTMLElement, filter, fixes.ignoreInlineStyle));","315","        overrideInlineStyle(element, filter, fixes.ignoreInlineStyle);","327","            inlineStyleElements.forEach((el) => overrideInlineStyle(el as HTMLElement, filter, fixes.ignoreInlineStyle));"],"delete":["163","    inlineStyleElements.forEach((el) => overrideInlineStyle(el as HTMLElement, filter));","315","        overrideInlineStyle(element, filter);","327","            inlineStyleElements.forEach((el) => overrideInlineStyle(el as HTMLElement, filter));"]}],"src\/config\/dynamic-theme-fixes.config":[{"add":["3376","IGNORE INLINE STYLE","3377",".legend-color","3378",""],"delete":[]}],"tests\/config.tests.ts":[{"add":["64","    expect(fixes.every(({invert, ignoreInlineStyle}) => (invert || []).concat(ignoreInlineStyle || []).every((s) => s.indexOf(',') < 0))).toBe(true);","83","        '========',","84","        'wikipedia.org',","85","        'IGNORE INLINE STYLE', 'a', 'b',","89","        {url: ['wikipedia.org'], ignoreInlineStyle: ['a', 'b']},"],"delete":["64","    expect(fixes.every(({invert}) => (invert || []).every((s) => s.indexOf(',') < 0))).toBe(true);"]}]}},"8454d290bee3d6892fa73bfbb7d1d3dbe4b916d8":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["1464","apple.com\/leadership\/","1465","","1466","IGNORE IMAGE ANALYSIS","1467","*","1468","","1469","================================","1470",""],"delete":[]}]}},"3317a7e4fbde5c9a352f3c9819b13a9e418de723":{"changes":{"src\/config\/inversion-fixes.config":"MODIFY"},"diff":{"src\/config\/inversion-fixes.config":[{"add":[],"delete":["943","msdn.microsoft.com","944","","945","INVERT","946",".codeSnippetContainerCodeContainer","947","","948","================================","949",""]}]}},"99997dc61fb0d981e4b565a8e9d4c982fa2d927a":{"changes":{"src\/background\/tab-manager.ts":"MODIFY"},"diff":{"src\/background\/tab-manager.ts":[{"add":["4","import {isFirefox, isMV3, isOpera, isThunderbird} from '..\/utils\/platform';","95","                    \/\/ On Opera, sender.tab.index === -1.","96","                    const isPanel = typeof sender === 'undefined' || typeof sender.tab === 'undefined' || (isOpera && sender.tab.index === -1);"],"delete":["4","import {isFirefox, isMV3, isThunderbird} from '..\/utils\/platform';","95","                    const isPanel = typeof sender === 'undefined' || typeof sender.tab === 'undefined';"]}]}},"76439b9cc9112581cfe1cb16c29517f6a4615ff7":{"changes":{"src\/inject\/dynamic-theme\/style-manager.ts":"MODIFY"},"diff":{"src\/inject\/dynamic-theme\/style-manager.ts":[{"add":["25","export const STYLE_SELECTOR = 'link[rel*=\"stylesheet\" i], style';","31","            (element instanceof HTMLLinkElement && element.rel && element.rel.toLowerCase().includes('stylesheet'))"],"delete":["25","export const STYLE_SELECTOR = 'link[rel=\"stylesheet\" i], style';","31","            (element instanceof HTMLLinkElement && element.rel && element.rel.toLowerCase() === 'stylesheet')"]}]}},"55b104e493c239edbf06a20cb7c7f9656d0db414":{"changes":{"src\/utils\/platform.ts":"MODIFY","src\/generators\/css-filter.ts":"MODIFY","CHANGELOG.md":"MODIFY"},"diff":{"src\/utils\/platform.ts":[{"add":["49","export const firefoxVersion = (() => {","50","    const m = userAgent.match(\/(?:firefox|librewolf)(?:\\\/| )([^ ]+)\/);","51","    if (m && m[1]) {","52","        return m[1];","53","    }","54","    return '';","55","})();","56",""],"delete":[]}],"src\/generators\/css-filter.ts":[{"add":["8","import {compareChromeVersions, chromiumVersion, isChromium, isFirefox, firefoxVersion} from '..\/utils\/platform';","29","\/**","30"," * Since Firefox v102.0, they have changed to the new root behavior.","31"," * This was already the case for Chromium v81.0.4035.0 and Firefox now","32"," * switched over as well.","33"," *\/","34","export function hasFirefoxNewRootBehavior() {","35","    return Boolean(","36","        isFirefox &&","37","        compareChromeVersions(firefoxVersion, '102.0') >= 0","38","    );","39","}","40","","95","        \/\/ Or if browser is Firefox v102+","96","        const bgColor = (!hasPatchForChromiumIssue501582() && !hasFirefoxNewRootBehavior()) && config.mode === FilterMode.dark ?"],"delete":["8","import {compareChromeVersions, chromiumVersion, isChromium} from '..\/utils\/platform';","83","        const bgColor = !hasPatchForChromiumIssue501582() && config.mode === FilterMode.dark ?"]}],"CHANGELOG.md":[{"add":["5","- Fix filter theme for Firefox v102+"],"delete":[]}]}},"4f4400551c19b7d95dd2cd458609575326df4426":{"changes":{"src\/inject\/dynamic-theme\/style-manager.ts":"MODIFY"},"diff":{"src\/inject\/dynamic-theme\/style-manager.ts":[{"add":["9","import {isShadowDomSupported, isSafari, isThunderbird, isChromium, isFirefox} from '..\/..\/utils\/platform';","46","                !element.disabled &&","47","                (isFirefox ? !element.href.startsWith('moz-extension:\/\/') : true)"],"delete":["9","import {isShadowDomSupported, isSafari, isThunderbird, isChromium} from '..\/..\/utils\/platform';","46","                !element.disabled"]}]}},"4174787286580d06b11eb849f87850ac7c3d6229":{"changes":{"src\/inject\/dynamic-theme\/modify-css.ts":"MODIFY","src\/ui\/popup\/settings-page\/index.tsx":"MODIFY","src\/ui\/controls\/style.less":"MODIFY","src\/ui\/controls\/textbox\/index.tsx":"MODIFY","src\/ui\/connect\/mock.ts":"MODIFY","src\/ui\/controls\/color-dropdown\/index.tsx":"ADD","src\/defaults.ts":"MODIFY","src\/ui\/controls\/index.ts":"MODIFY","src\/definitions.d.ts":"MODIFY","src\/ui\/icons.less":"MODIFY","src\/ui\/popup\/theme\/page\/index.tsx":"MODIFY","src\/ui\/popup\/theme\/controls\/index.tsx":"MODIFY","src\/background\/user-storage.ts":"MODIFY","src\/ui\/controls\/color-picker\/style.less":"ADD","src\/ui\/controls\/color-picker\/index.tsx":"ADD","src\/ui\/popup\/theme\/controls\/scrollbar.tsx":"ADD","src\/ui\/controls\/color-dropdown\/style.less":"ADD"},"diff":{"src\/inject\/dynamic-theme\/modify-css.ts":[{"add":["0","import {parse, RGBA, rgbToHSL, hslToString} from '..\/..\/utils\/color';","8","import {FilterConfig, Theme} from '..\/..\/definitions';","88","    if (filter.scrollbarColor) {","89","        lines.push(getModifiedScrollbarStyle(filter));","94","function getModifiedScrollbarStyle(theme: Theme) {","95","    const lines: string[] = [];","96","    let colorTrack: string;","97","    let colorIcons: string;","98","    let colorThumb: string;","99","    let colorThumbHover: string;","100","    let colorThumbActive: string;","101","    let colorCorner: string;","102","    if (theme.scrollbarColor === 'auto') {","103","        colorTrack = modifyBackgroundColor({r: 241, g: 241, b: 241}, theme);","104","        colorIcons = modifyForegroundColor({r: 96, g: 96, b: 96}, theme);","105","        colorThumb = modifyBackgroundColor({r: 176, g: 176, b: 176}, theme);","106","        colorThumbHover = modifyBackgroundColor({r: 144, g: 144, b: 144}, theme);","107","        colorThumbActive = modifyBackgroundColor({r: 96, g: 96, b: 96}, theme);","108","        colorCorner = modifyBackgroundColor({r: 255, g: 255, b: 255}, theme);","109","    } else {","110","        const rgb = parse(theme.scrollbarColor);","111","        const hsl = rgbToHSL(rgb);","112","        const isLight = hsl.l > 0.5;","113","        const lighten = (lighter: number) => ({...hsl, l: clamp(hsl.l + lighter, 0, 1)});","114","        const darken = (darker: number) => ({...hsl, l: clamp(hsl.l - darker, 0, 1)});","115","        colorTrack = hslToString(darken(0.4));","116","        colorIcons = hslToString(isLight ? darken(0.4) : lighten(0.4));","117","        colorThumb = hslToString(hsl);","118","        colorThumbHover = hslToString(lighten(0.1));","119","        colorThumbActive = hslToString(lighten(0.2));","120","    }","121","    lines.push('::-webkit-scrollbar {');","122","    lines.push(`    background-color: ${colorTrack};`);","123","    lines.push(`    color: ${colorIcons};`);","124","    lines.push('}');","125","    lines.push('::-webkit-scrollbar-thumb {');","126","    lines.push(`    background-color: ${colorThumb};`);","127","    lines.push('}');","128","    lines.push('::-webkit-scrollbar-thumb:hover {');","129","    lines.push(`    background-color: ${colorThumbHover};`);","130","    lines.push('}');","131","    lines.push('::-webkit-scrollbar-thumb:active {');;","132","    lines.push(`    background-color: ${colorThumbActive};`);","133","    lines.push('}');","134","    lines.push('::-webkit-scrollbar-corner {');","135","    lines.push(`    background-color: ${colorCorner};`);","136","    lines.push('}');","137","    lines.push('* {');","138","    lines.push(`    scrollbar-color: ${colorTrack} ${colorThumb};`);","139","    lines.push('}');","140","    return lines.join('\\n');","141","}","142",""],"delete":["0","import {parse, RGBA} from '..\/..\/utils\/color';","2","import {isMacOS} from '..\/..\/utils\/platform';","9","import {FilterConfig} from '..\/..\/definitions';","89","    if (!isMacOS()) {","90","        lines.push('::-webkit-scrollbar {');","91","        lines.push(`    background-color: ${modifyBackgroundColor({r: 241, g: 241, b: 241}, filter)};`);","92","        lines.push(`    color: ${modifyForegroundColor({r: 96, g: 96, b: 96}, filter)};`);","93","        lines.push('}');","94","        lines.push('::-webkit-scrollbar-thumb {');","95","        lines.push(`    background-color: ${modifyBackgroundColor({r: 193, g: 193, b: 193}, filter)};`);","96","        lines.push('}');","97","        lines.push('::-webkit-scrollbar-thumb:hover {');","98","        lines.push(`    background-color: ${modifyBackgroundColor({r: 166, g: 166, b: 166}, filter)};`);","99","        lines.push('}');","100","        lines.push('::-webkit-scrollbar-thumb:active {');;","101","        lines.push(`    background-color: ${modifyBackgroundColor({r: 96, g: 96, b: 96}, filter)};`);","102","        lines.push('}');","103","        lines.push('::-webkit-scrollbar-corner {');","104","        lines.push(`    background-color: ${modifyBackgroundColor({r: 255, g: 255, b: 255}, filter)};`);","105","        lines.push('}');","106","        lines.push('* {');","107","        lines.push(`    scrollbar-color: ${modifyBackgroundColor({r: 193, g: 193, b: 193}, filter)} ${modifyBackgroundColor({r: 241, g: 241, b: 241}, filter)};`);","108","        lines.push('}');"]}],"src\/ui\/popup\/settings-page\/index.tsx":[{"add":["6","import {isFirefox} from '..\/..\/..\/utils\/platform';","13","            {isFirefox() ? null : <InvertPDF {...props} \/>}"],"delete":["12","            <InvertPDF {...props} \/>"]}],"src\/ui\/controls\/style.less":[{"add":["13","","14","@import \".\/color-picker\/style\";","15","@import \".\/color-dropdown\/style\";"],"delete":[]}],"src\/ui\/controls\/textbox\/index.tsx":[{"add":["3","interface TextBoxProps extends Malevic.NodeAttrs {","4","    oninput?: (e: Event & {target: HTMLInputElement}) => void;","5","    onchange?: (e: Event & {target: HTMLInputElement}) => void;","6","}","7","","8","export default function TextBox(props: TextBoxProps) {"],"delete":["3","export default function TextBox(props: Malevic.NodeAttrs) {"]}],"src\/ui\/connect\/mock.ts":[{"add":["1","import {ExtensionData, TabInfo, Theme, UserSettings} from '..\/..\/definitions';","3","export function getMockData(override = {} as Partial<ExtensionData>): ExtensionData {","4","    return Object.assign(<ExtensionData>{","7","        settings: <UserSettings>{","9","            theme: <Theme>{","20","                scrollbarColor: 'auto',","27","            enableForPDF: true,","39","        },"],"delete":["1","import {ExtensionData, TabInfo, UserSettings} from '..\/..\/definitions';","3","export function getMockData(override = {}): ExtensionData {","4","    return Object.assign({","7","        settings: {","9","            theme: {","37","        } as UserSettings,"]}],"src\/ui\/controls\/color-dropdown\/index.tsx":[{"add":[],"delete":[]}],"src\/defaults.ts":[{"add":["15","    scrollbarColor: isMacOS() ? '' : 'auto',"],"delete":[]}],"src\/ui\/controls\/index.ts":[{"add":["2","import ColorDropDown from '.\/color-dropdown';","3","import ColorPicker from '.\/color-picker';","19","    ColorDropDown,","20","    ColorPicker,"],"delete":[]}],"src\/definitions.d.ts":[{"add":["49","    scrollbarColor: '' | 'auto' | string;"],"delete":[]}],"src\/ui\/icons.less":[{"add":["2","@icon-reset: url('data:image\/svg+xml;utf8,<svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" viewBox=\"0 0 8 8\"><path fill=\"white\" d=\"M4,1 v-1 l1.5,1.5 l-1.5,1.5 v-1 a2,2 0 1 0 2,2 h1 a3,3 0 1 1 -3,-3 z\"\/><\/svg>');"],"delete":[]}],"src\/ui\/popup\/theme\/page\/index.tsx":[{"add":["1","import {DEFAULT_SETTINGS} from '..\/..\/..\/..\/defaults';","3","import {Brightness, Contrast, Grayscale, Mode, Scheme, Sepia, Scrollbar} from '..\/controls';","38","            <Scrollbar","39","                value={theme.scrollbarColor}","40","                onChange={(v) => props.actions.setTheme({scrollbarColor: v})}","41","                onReset={() => props.actions.setTheme({scrollbarColor: DEFAULT_SETTINGS.theme.scrollbarColor})}","42","            \/>","43","            <ResetButton {...props} \/>"],"delete":["2","import {Brightness, Contrast, Grayscale, Mode, Scheme, Sepia} from '..\/controls';","37","            <ResetButton {...props}\/>"]}],"src\/ui\/popup\/theme\/controls\/index.tsx":[{"add":["6","import Scrollbar from '.\/scrollbar';","15","    Scrollbar,"],"delete":[]}],"src\/background\/user-storage.ts":[{"add":["120","                scrollbarColor: f.scrollbarColor,"],"delete":[]}],"src\/ui\/controls\/color-picker\/style.less":[{"add":[],"delete":[]}],"src\/ui\/controls\/color-picker\/index.tsx":[{"add":[],"delete":[]}],"src\/ui\/popup\/theme\/controls\/scrollbar.tsx":[{"add":[],"delete":[]}],"src\/ui\/controls\/color-dropdown\/style.less":[{"add":[],"delete":[]}]}},"2d5bc8feaa0e262814d404284006805462c0c088":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["729","anytype.io","730","","731","IGNORE IMAGE ANALYSIS","732",".img.home","733","","734","================================","735",""],"delete":[]}]}},"aea56dc6b1de5ea20d72e9419714e5feee6d1fec":{"changes":{"src\/inject\/dynamic-theme\/modify-css.ts":"MODIFY"},"diff":{"src\/inject\/dynamic-theme\/modify-css.ts":[{"add":["208","    const isMicrosoft = location.hostname.endsWith('microsoft.com');","209","    lines.push(`html, body, ${strict ? `body :not(iframe)${isMicrosoft ? ':not(div[style^=\"position:absolute;top:0;left:-\"]' : ''}` : 'body > :not(iframe)'} {`);"],"delete":["208","    lines.push(`html, body, ${strict ? 'body :not(iframe):not(div[style^=\"position:absolute;top:0;left:-\"]' : 'body > :not(iframe)'} {`);"]}]}},"e14753838398c83a21549071e5c546e223fb5f8a":{"changes":{"src\/inject\/utils\/dom.ts":"MODIFY"},"diff":{"src\/inject\/utils\/dom.ts":[{"add":["185","        if (node.classList.contains('surfingkeys_hints_host')) {","186","            continue;","187","        }","188",""],"delete":[]}]}},"ba4299a784da12f45fbe3b3551b9b8d809215f2e":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["1945","flowkey.com","1946","","1947","INVERT","1948","body.front #zone-branding-wrapper","1949","","1950","CSS","1951","body.html #page.page #subslogan {","1952","    color: ${white} !important;","1953","}","1954","","1955","================================","1956",""],"delete":[]}]}},"f1ae2150f0dd448e4ea3c63d58420c64151d15fd":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["972",".mwe-math-element"],"delete":["972","span>img[alt^=\"CDel\"]"]}]}},"042165fbaab5e33b969e3242e0f1171bc8a93df6":{"changes":{"src\/background\/devtools.ts":"MODIFY"},"diff":{"src\/background\/devtools.ts":[{"add":["56","                    this.cache = data;"],"delete":[]}]}},"75950b82b384dd2308ca5f14d6995bf108299fed":{"changes":{"src\/background\/window-theme.ts":"MODIFY"},"diff":{"src\/background\/window-theme.ts":[{"add":[],"delete":["61","    tab_line: '#23aeff',"]}]}},"b117f94491401335b0164b434af3708691965d27":{"changes":{"src\/inject\/dynamic-theme\/modify-css.ts":"MODIFY"},"diff":{"src\/inject\/dynamic-theme\/modify-css.ts":[{"add":["49","    if (filter.mode === 1) {","50","        lines.push('html {');","51","        lines.push(`    background-color: ${modifyBackgroundColor({r: 255, g: 255, b: 255}, filter)} !important;`);","52","        lines.push('}');","53","    }"],"delete":[]}]}},"ae5065e6aa94eb22ba8fdd74ad3ae161f13cc256":{"changes":{"src\/inject\/dynamic-theme\/index.ts":"MODIFY"},"diff":{"src\/inject\/dynamic-theme\/index.ts":[{"add":["337","    try {","338","        if (Array.isArray(node.adoptedStyleSheets)) {","339","            if (node.adoptedStyleSheets.length > 0) {","340","                const newManger = createAdoptedStyleSheetOverride(node);","342","                adoptedStyleManagers.push(newManger);","343","                newManger.render(filter, ignoredImageAnalysisSelectors);","344","            }","346","    } catch (err) {","347","        \/\/ For future readers, Dark Reader typically does not use 'try\/catch' in its code but,","348","        \/\/ due to a problem in Firefox Nightly, this is an exception. Allowing this exception","349","        \/\/ to occur causes no consequence.","350","        \/\/ Ref: https:\/\/github.com\/darkreader\/darkreader\/issues\/8789#issuecomment-1114210080","351","        logWarn('Error occured in handleAdoptedStyleSheets: ', err);"],"delete":["337","    if (Array.isArray(node.adoptedStyleSheets)) {","338","        if (node.adoptedStyleSheets.length > 0) {","339","            const newManger = createAdoptedStyleSheetOverride(node);","341","            adoptedStyleManagers.push(newManger);","342","            newManger.render(filter, ignoredImageAnalysisSelectors);"]}]}},"d1699684e34af2df64b010ab7ae6c911cdebbbb3":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["12653","t.bilibili.com","12654","","12655","CSS","12656","#app {","12657","    background-image: none !important;","12658","}","12659","","12660","================================","12661",""],"delete":[]}]}},"632d74d307427108fcacdab2bdf11d90e39f01be":{"changes":{"src\/inject\/dynamic-theme\/index.ts":"MODIFY","src\/inject\/dynamic-theme\/style-manager.ts":"MODIFY"},"diff":{"src\/inject\/dynamic-theme\/index.ts":[{"add":["48","    document.head.insertBefore(fallbackStyle, document.head.firstChild);","53","    document.head.insertBefore(userAgentStyle, fallbackStyle.nextSibling);","62","    document.head.insertBefore(textStyle, fallbackStyle.nextSibling);","78","    document.head.insertBefore(invertStyle, textStyle.nextSibling);","83","    document.head.insertBefore(inlineStyle, invertStyle.nextSibling);","88","    document.head.appendChild(overrideStyle);","97","    root.insertBefore(inlineStyle, root.firstChild);"],"delete":["47","    document.head.insertBefore(fallbackStyle, document.head.firstChild);","52","    document.head.insertBefore(userAgentStyle, fallbackStyle.nextSibling);","57","    document.head.insertBefore(textStyle, fallbackStyle.nextSibling);","66","    document.head.insertBefore(invertStyle, textStyle.nextSibling);","82","    document.head.insertBefore(inlineStyle, invertStyle.nextSibling);","87","    document.head.appendChild(overrideStyle);","96","    root.insertBefore(inlineStyle, root.firstChild);"]}],"src\/inject\/dynamic-theme\/style-manager.ts":[{"add":["119","    function fixFirefoxCSPIssue() {","120","        \/\/ Some websites get CSP warning,","121","        \/\/ when `textContent` is not set","122","        if (corsCopy && !corsCopy.textContent) {","123","            corsCopy.textContent = '';","124","        }","125","        if (!syncStyle.textContent) {","126","            syncStyle.textContent = '';","127","        }","128","    }","129","","131","        fixFirefoxCSPIssue();"],"delete":[]}]}},"dede90f516cec1fbdc5822115b38be6c2c2baf75":{"changes":{"src\/inject\/dynamic-theme\/modify-css.ts":"MODIFY"},"diff":{"src\/inject\/dynamic-theme\/modify-css.ts":[{"add":["219","            const {isDark, isLight, isTransparent, isLarge, width} = imageDetails;","221","            if (isDark && isTransparent && filter.mode === 1 && !isLarge && width > 2) {"],"delete":["219","            const {isDark, isLight, isTransparent, isLarge} = imageDetails;","221","            if (isDark && isTransparent && filter.mode === 1 && !isLarge) {"]}]}},"59b55fadc8a50a8eb2d25dd213d94d37bf22aa95":{"changes":{"tests\/jest.config.js":"MODIFY","tests\/inject\/dynamic.tests.ts":"ADD","package.json":"MODIFY","tests\/inject\/tsconfig.json":"ADD","src\/inject\/dynamic-theme\/url.ts":"MODIFY","tests\/inject\/jest.config.js":"ADD"},"diff":{"tests\/jest.config.js":[{"add":["6","    testRegex: 'tests\/[^\/]*\\\\.tests\\\\.ts(x?)$',"],"delete":["6","    testRegex: 'tests\/.*\\\\.tests\\\\.ts(x?)$',"]}],"tests\/inject\/dynamic.tests.ts":[{"add":[],"delete":[]}],"package.json":[{"add":["10","    \"test\": \"jest --config=tests\/jest.config.js\",","11","    \"test:inject\": \"jest --config=tests\/inject\/jest.config.js\""],"delete":["10","    \"test\": \"jest --config=tests\/jest.config.js\""]}],"tests\/inject\/tsconfig.json":[{"add":[],"delete":[]}],"src\/inject\/dynamic-theme\/url.ts":[{"add":["18","    let pathParts = b.pathname.split('\/');","19","    const lastPathPart = pathParts[pathParts.length - 1];","20","    if (lastPathPart.match(\/\\.[a-z]+$\/i)) {","21","        pathParts.pop();","22","    }","23","    pathParts = pathParts.concat(...$relative.split('\/')).filter((p) => p);"],"delete":["18","    const pathParts = b.pathname.split('\/').concat($relative.split('\/')).filter((p) => p);"]}],"tests\/inject\/jest.config.js":[{"add":[],"delete":[]}]}},"c38552d00f066a0edfaeffbef6a686fc3c09ed03":{"changes":{"src\/background\/extension.ts":"MODIFY","src\/background\/icon-manager.ts":"MODIFY","tests\/utils\/promise-barrier.tests.ts":"MODIFY","src\/utils\/promise-barrier.ts":"MODIFY"},"diff":{"src\/background\/extension.ts":[{"add":["22","import {PromiseBarrier} from '..\/utils\/promise-barrier';","38","    private startBarrier: PromiseBarrier = null;","57","        this.startBarrier = new PromiseBarrier();","131","        this.startBarrier.resolve();","165","        if (this.startBarrier.isPending()) {","166","            await this.startBarrier.entry();"],"delete":["161","        if (!this.user.settings) {","162","            await this.user.loadSettings();"]}],"src\/background\/icon-manager.ts":[{"add":[],"delete":["10","    constructor() {","11","        this.setActive();","12","    }","13",""]}],"tests\/utils\/promise-barrier.tests.ts":[{"add":["0","import {PromiseBarrier} from '..\/..\/src\/utils\/promise-barrier';","14","    expect(barrier.isPending()).toBe(true);","15","    expect(barrier.isFulfilled()).toBe(false);","16","    expect(barrier.isRejected()).toBe(false);","18","    expect(barrier.isFulfilled()).toBe(true);","19","    expect(barrier.isPending()).toBe(false);","20","    expect(barrier.isRejected()).toBe(false);","26","    const barrierFulfilled = new PromiseBarrier();","27","    expect(barrierFulfilled.isPending()).toBe(true);","28","    expect(barrierFulfilled.isFulfilled()).toBe(false);","29","    expect(barrierFulfilled.isRejected()).toBe(false);","30","    const promise1 = barrierFulfilled.resolve('Hello World!');","31","    expect(barrierFulfilled.isFulfilled()).toBe(true);","32","    expect(barrierFulfilled.isPending()).toBe(false);","33","    expect(barrierFulfilled.isRejected()).toBe(false);","35","    (async () => fn1(await barrierFulfilled.entry()))();","54","    const barrierFulfilled = new PromiseBarrier();","55","    expect(barrierFulfilled.isPending()).toBe(true);","56","    expect(barrierFulfilled.isFulfilled()).toBe(false);","57","    expect(barrierFulfilled.isRejected()).toBe(false);","58","    barrierFulfilled.resolve('Hello World!');","59","    expect(barrierFulfilled.isFulfilled()).toBe(true);","60","    expect(barrierFulfilled.isPending()).toBe(false);","61","    expect(barrierFulfilled.isRejected()).toBe(false);","62","    barrierFulfilled.resolve('Hello World 2!');","63","    expect(barrierFulfilled.isFulfilled()).toBe(true);","64","    expect(barrierFulfilled.isPending()).toBe(false);","65","    expect(barrierFulfilled.isRejected()).toBe(false);","67","    (async () => fn1(await barrierFulfilled.entry()))();","71","    expect(barrierRejected.isPending()).toBe(true);","72","    expect(barrierRejected.isFulfilled()).toBe(false);","73","    expect(barrierRejected.isRejected()).toBe(false);","75","    expect(barrierRejected.isRejected()).toBe(true);","76","    expect(barrierRejected.isPending()).toBe(false);","77","    expect(barrierRejected.isFulfilled()).toBe(false);"],"delete":["0","import {PromiseBarrier, PromiseBarrierState} from '..\/..\/src\/utils\/promise-barrier';","14","    expect(barrier.state).toBe(PromiseBarrierState.PENDING);","16","    expect(barrier.state).toBe(PromiseBarrierState.FULFILLED);","22","    const barrierResolved = new PromiseBarrier();","23","    expect(barrierResolved.state).toBe(PromiseBarrierState.PENDING);","24","    const promise1 = barrierResolved.resolve('Hello World!');","25","    expect(barrierResolved.state).toBe(PromiseBarrierState.FULFILLED);","27","    (async () => fn1(await barrierResolved.entry()))();","46","    const barrierResolved = new PromiseBarrier();","47","    expect(barrierResolved.state).toBe(PromiseBarrierState.PENDING);","48","    barrierResolved.resolve('Hello World!');","49","    expect(barrierResolved.state).toBe(PromiseBarrierState.FULFILLED);","50","    barrierResolved.resolve('Hello World 2!');","51","    expect(barrierResolved.state).toBe(PromiseBarrierState.FULFILLED);","53","    (async () => fn1(await barrierResolved.entry()))();","57","    expect(barrierRejected.state).toBe(PromiseBarrierState.PENDING);","59","    expect(barrierRejected.state).toBe(PromiseBarrierState.REJECTED);"]}],"src\/utils\/promise-barrier.ts":[{"add":["44","    isPending(): boolean {","45","        return !this.wasResolved && !this.wasRejected;","46","    }","47","","48","    isFulfilled(): boolean {","49","        return this.wasResolved;","50","    }","51","","52","    isRejected(): boolean {","53","        return this.wasRejected;"],"delete":["0","export const PromiseBarrierState = {","1","    PENDING: 'pending',","2","    FULFILLED: 'fulfilled',","3","    REJECTED: 'rejected',","4","};","5","","50","    get state() {","51","        if (this.wasResolved) {","52","            return PromiseBarrierState.FULFILLED;","53","        } else if (this.wasRejected) {","54","            return PromiseBarrierState.REJECTED;","55","        }","56","        return PromiseBarrierState.PENDING;"]}]}},"975f0be3dbe4cd7323b14b4eb8e8b308e45215cc":{"changes":{"tests\/utils\/url.tests.ts":"MODIFY","src\/utils\/url.ts":"MODIFY"},"diff":{"tests\/utils\/url.tests.ts":[{"add":["237","    expect(isURLEnabled(","238","        'https:\/\/netflix.com',","239","        {enableForPDF: true, siteList: [''], siteListEnabled: ['netflix.com'], applyToListedOnly: true} as UserSettings,","240","        {isProtected: false, isInDarkList: true},","241","    )).toBe(true);","242","    expect(isURLEnabled(","243","        'https:\/\/netflix.com',","244","        {enableForPDF: true, siteList: [''], siteListEnabled: ['netflix.com'], applyToListedOnly: false} as UserSettings,","245","        {isProtected: false, isInDarkList: true},","246","    )).toBe(true);"],"delete":[]}],"src\/utils\/url.ts":[{"add":["183","    const isURLInEnabledList = isURLInList(url, userSettings.siteListEnabled);","184","","185","    if (userSettings.applyToListedOnly && !isURLInEnabledList) {","188",""],"delete":["183","    if (userSettings.applyToListedOnly) {","186","    \/\/ TODO: Use `siteListEnabled`, `siteListDisabled`, `enabledByDefault` options.","187","    \/\/ Delete `siteList` and `applyToListedOnly` options, transfer user's values.","188","    const isURLInEnabledList = isURLInList(url, userSettings.siteListEnabled);"]}]}},"f97f565f9469471e3c22d3b105ca7d9dccfa6317":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["336",".cell-input","337","","338","CSS","339",".cell-input {","340","  background-color: ${black} !important;","341","  color: ${white} !important;","342","}","343","","344",".cell-input > span, .cell-input > font {","345","  --darkreader-inline-color: ${white} !important;","346","}"],"delete":[]}]}},"145bfcf5d9f620464f8710820aff91aefffcfeb7":{"changes":{"src\/config\/dynamic-theme-fixes.config":"MODIFY"},"diff":{"src\/config\/dynamic-theme-fixes.config":[{"add":["7674","freesound.org","7675","","7676","CSS","7677","#search input:not(#search_submit) {","7678","    background-color: var(--darkreader-neutral-background) !important;","7679","}","7680","","7681","================================","7682",""],"delete":[]}]}},"31f3b5dabea1c68a25a5168d51003d3f4713f89b":{"changes":{"src\/inject\/dynamic-theme\/index.ts":"MODIFY"},"diff":{"src\/inject\/dynamic-theme\/index.ts":[{"add":["208","    inlineStyleElements.forEach((el) => overrideInlineStyle(el as HTMLElement, filter, ignoredInlineSelectors, getIgnoreImageAnalysisSelectors()));","383","            forEach(inlineStyleElements, (el) => overrideInlineStyle(el as HTMLElement, filter, ignoredInlineSelectors, getIgnoreImageAnalysisSelectors()));"],"delete":["208","    inlineStyleElements.forEach((el) => overrideInlineStyle(el as HTMLElement, filter, getIgnoreImageAnalysisSelectors(), ignoredInlineSelectors));","383","            forEach(inlineStyleElements, (el) => overrideInlineStyle(el as HTMLElement, filter, getIgnoreImageAnalysisSelectors(), ignoredInlineSelectors));"]}]}},"d8c211c88de734cc84ecd38a605cf721fbd885ba":{"changes":{"src\/background\/extension.ts":"MODIFY","src\/background\/tab-manager.ts":"MODIFY","CHANGELOG.md":"MODIFY"},"diff":{"src\/background\/extension.ts":[{"add":["461","    changeSettings($settings: Partial<UserSettings>, onlyUpdateActiveTab = false) {","500","        this.onSettingsChanged(onlyUpdateActiveTab);","539","            this.changeSettings({siteListEnabled: toggledList}, true);","544","        this.changeSettings({siteList: toggledList}, true);","570","    private async onSettingsChanged(onlyUpdateActiveTab = false) {","576","        this.tabs.sendMessage(onlyUpdateActiveTab);"],"delete":["461","    changeSettings($settings: Partial<UserSettings>) {","500","        this.onSettingsChanged();","539","            this.changeSettings({siteListEnabled: toggledList});","544","        this.changeSettings({siteList: toggledList});","570","    private async onSettingsChanged() {","576","        this.tabs.sendMessage();"]}],"src\/background\/tab-manager.ts":[{"add":["8","import {getURLHostOrProtocol} from '..\/utils\/url';","289","    \/\/ sendMessage will send a tab messages to all active tabs and their frames.","290","    \/\/ If onlyUpdateActiveTab is specified, it will only send a new message to any","291","    \/\/ tab that matches the active tab's hostname. This is to ensure that when a user","292","    \/\/ has multiple tabs of the same website, it will ensure that every tab will receive","293","    \/\/ the new message and not just that tab as Dark Reader currently doesn't have per-tab","294","    \/\/ operations, this should be the expected behavior.","295","    async sendMessage(onlyUpdateActiveTab = false) {","298","        const activeTabHostname = onlyUpdateActiveTab ? getURLHostOrProtocol(await this.getActiveTabURL()) : null;","299","","307","                        const tabURL = this.getTabURL(tab);","308","                        \/\/ Check if hostname are equal when we only want to update active tab.","309","                        if (onlyUpdateActiveTab && getURLHostOrProtocol(tabURL) !== activeTabHostname) {","310","                            return;","311","                        }","312","","313","                        const message = this.getTabMessage(tabURL, frameId === 0 ? null : url);"],"delete":["288","    async sendMessage() {","298","                        const message = this.getTabMessage(this.getTabURL(tab), frameId === 0 ? null : url);"]}],"CHANGELOG.md":[{"add":["10","- Only send updates to the affected tabs when toggling sites."],"delete":[]}]}},"71fb947c36d23876739bc030535092b0f2e078e2":{"changes":{"src\/background\/extension.ts":"MODIFY","src\/ui\/popup\/components\/site-toggle\/index.tsx":"MODIFY","tests\/utils\/url.tests.ts":"MODIFY","src\/utils\/url.ts":"MODIFY"},"diff":{"src\/background\/extension.ts":[{"add":["366","        const isProtected = !canInjectScript(url);"],"delete":["366","        const isProtected = !(this.user.settings.enableForProtectedPages || canInjectScript(url));"]}],"src\/ui\/popup\/components\/site-toggle\/index.tsx":[{"add":["16","        data.settings.enableForProtectedPages || "],"delete":["16","        data.isEnabled &&"]}],"tests\/utils\/url.tests.ts":[{"add":["68","    )).toBe(true);","73","    )).toBe(false);","88","    )).toBe(true);"],"delete":["68","    )).toBe(false);","73","    )).toBe(true);","88","    )).toBe(false);"]}],"src\/utils\/url.ts":[{"add":["139","    if (isProtected && !userSettings.enableForProtectedPages) {"],"delete":["139","    if (isProtected && userSettings.enableForProtectedPages) {"]}]}},"1f70e6192d292211d1c51687c48ff3197902d098":{"changes":{"src\/background\/extension.ts":"MODIFY","src\/background\/index.ts":"MODIFY"},"diff":{"src\/background\/extension.ts":[{"add":["200","    onCommand = async (command: string, frameURL?: string) => {","215","                const url = frameURL || await this.tabs.getActiveTabURL();","234","        const onCommandToggle = async () => this.onCommand('toggle');","236","        const onCommandSwitchEngine = async () => this.onCommand('switchEngine');"],"delete":["200","    onCommand = async (command: string, url: string) => {","233","        const onCommandToggle = async () => this.onCommand('toggle', null);","235","        const onCommandSwitchEngine = async () => this.onCommand('switchEngine', null);"]}],"src\/background\/index.ts":[{"add":["11","    chrome.commands.onCommand.addListener(async (command) => extension.onCommand(command));"],"delete":["11","    chrome.commands.onCommand.addListener(async (command, tab) => extension.onCommand(command, tab.url));"]}]}}}